{"version":3,"sources":["extensions/default/Phoenix-live-preview/utils.js"],"names":["define","require","exports","module","ProjectManager","brackets","getModule","DocumentManager","FileSystem","getExtension","filePath","pathSplit","split","length","_isPreviewableFile","extension","includes","toLowerCase","_isMarkdownFile","getNoPreviewURL","window","Phoenix","baseURL","async","_getDefaultPreviewDetails","Promise","resolve","reject","projectRoot","getProjectRoot","fullPath","projectRootUrl","fsServerUrl","indexFiles","indexFile","file","getFileForPath","existsAsync","relativePath","path","relative","URL","e","getPreviewDetails","currentDocument","getCurrentDocument","currentFile","getSelectedItem","httpFilePath","startsWith","isMarkdownFile"],"mappings":"AAyCAA,OAAO,SAAUC,QAASC,QAASC,QAC/B,MAAMC,eAA0BC,SAASC,UAAU,0BAC/CC,gBAAsBF,SAASC,UAAU,4BACzCE,WAAqBH,SAASC,UAAU,yBAE5C,SAASG,aAAaC,UAElB,IAAIC,WADJD,SAAWA,UAAY,IACEE,MAAM,KAC/B,OAAOD,WAAaA,UAAUE,OAAO,EAAIF,UAAUA,UAAUE,OAAO,GAAK,GAG7E,SAASC,mBAAmBJ,UACxB,IAAIK,UAAYN,aAAaC,UAC7B,MAAO,CAAC,OAAQ,MAAO,MAAO,OAAQ,MAAO,MAAO,MAAO,KAAM,YAAYM,SAASD,UAAUE,eAGpG,SAASC,gBAAgBR,UACrB,IAAIK,UAAYN,aAAaC,UAC7B,MAAO,CAAC,KAAM,YAAYM,SAASD,UAAUE,eAGjD,SAASE,kBACL,SAAUC,OAAOC,QAAQC,+CAG7BC,eAAeC,4BACX,OAAO,IAAIC,QAAQF,MAAOG,QAASC,UAE/B,IACI,IAAIC,YAAcxB,eAAeyB,iBAAiBC,SAClD,MAAMC,kBAAoBX,OAAOY,cAAcJ,cAC/C,IAAIK,WAAa,CAAC,aAAc,aAChC,IAAI,IAAIC,aAAaD,WAAW,CAC5B,IAAIE,KAAO3B,WAAW4B,kBAAkBR,cAAcM,aACtD,SAASC,KAAKE,cAAc,CACxB,MAAMC,aAAeC,KAAKC,SAASZ,YAAaO,KAAKL,UAKrD,YAJAJ,QAAQ,CACJe,OAAQV,iBAAiBO,eACzB5B,SAAU4B,gBAKtBZ,QAAQ,CAACe,IAAKtB,oBAChB,MAAOuB,GACLf,OAAOe,MAUnBnB,eAAeoB,oBACX,OAAO,IAAIlB,QAAQF,MAAOG,QAASC,UAE/B,IACI,MAAMC,YAAcxB,eAAeyB,iBAAiBC,SAC9CC,kBAAoBX,OAAOY,cAAcJ,cACzCgB,gBAAkBrC,gBAAgBsC,qBAClCC,YAAcF,gBAAiBA,gBAAgBT,KAAO/B,eAAe2C,kBAC3E,GAAGD,YAAY,CACX,IAAIhB,SAAWgB,YAAYhB,SACvBkB,aAAe,KAInB,IAHGlB,SAASmB,WAAW,YAAcnB,SAASmB,WAAW,eACrDD,aAAelB,UAEhBhB,mBAAmBgB,UAAU,CAC5B,MAAMpB,SAAWsC,cAAgBT,KAAKC,SAASZ,YAAaE,UAC5DJ,QAAQ,CACJe,IAAKO,iBAAmBjB,iBAAiBrB,WACzCA,SAAUA,SACVoB,SAAUA,SACVoB,eAAgBhC,gBAAgBY,iBAGpCJ,QAAQ,IAGhBA,cAAcF,6BACjB,MAAOkB,GACJf,OAAOe,MAKnBxC,QAAQyC,kBAAoBA,kBAC5BzC,QAAQiB,gBAAkBA,gBAC1BjB,QAAQO,aAAeA","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, regexp: true, indent: 4, maxerr: 50 */\n/*global define, brackets, fs, Phoenix, path */\n//jshint-ignore:no-start\n\ndefine(function (require, exports, module) {\n    const ProjectManager          = brackets.getModule(\"project/ProjectManager\"),\n        DocumentManager     = brackets.getModule(\"document/DocumentManager\"),\n        FileSystem         = brackets.getModule(\"filesystem/FileSystem\");\n\n    function getExtension(filePath) {\n        filePath = filePath || '';\n        let pathSplit = filePath.split('.');\n        return pathSplit && pathSplit.length>1 ? pathSplit[pathSplit.length-1] : '';\n    }\n\n    function _isPreviewableFile(filePath) {\n        let extension = getExtension(filePath);\n        return ['html', 'htm', 'jpg', 'jpeg', 'png', 'svg', 'pdf', 'md', 'markdown'].includes(extension.toLowerCase());\n    }\n\n    function _isMarkdownFile(filePath) {\n        let extension = getExtension(filePath);\n        return ['md', 'markdown'].includes(extension.toLowerCase());\n    }\n\n    function getNoPreviewURL(){\n        return `${window.Phoenix.baseURL}assets/phoenix-splash/no-preview.html`;\n    }\n\n    async function _getDefaultPreviewDetails() {\n        return new Promise(async (resolve, reject)=>{ // eslint-disable-line\n            // async is explicitly caught\n            try{\n                let projectRoot = ProjectManager.getProjectRoot().fullPath;\n                const projectRootUrl = `${window.fsServerUrl}${projectRoot}`;\n                let indexFiles = ['index.html', \"index.htm\"];\n                for(let indexFile of indexFiles){\n                    let file = FileSystem.getFileForPath(`${projectRoot}${indexFile}`);\n                    if(await file.existsAsync()){\n                        const relativePath = path.relative(projectRoot, file.fullPath);\n                        resolve({\n                            URL: `${projectRootUrl}${relativePath}`,\n                            filePath: relativePath\n                        });\n                        return;\n                    }\n                }\n                resolve({URL: getNoPreviewURL()});\n            } catch (e) {\n                reject(e);\n            }\n        });\n    }\n\n    /**\n     * Finds out a {URL,filePath} to live preview from the project. Will return and empty object if the current\n     * file is not previewable.\n     * @return {Promise<*>}\n     */\n    async function getPreviewDetails() {\n        return new Promise(async (resolve, reject)=>{ // eslint-disable-line\n            // async is explicitly caught\n            try {\n                const projectRoot = ProjectManager.getProjectRoot().fullPath;\n                const projectRootUrl = `${window.fsServerUrl}${projectRoot}`;\n                const currentDocument = DocumentManager.getCurrentDocument();\n                const currentFile = currentDocument? currentDocument.file : ProjectManager.getSelectedItem();\n                if(currentFile){\n                    let fullPath = currentFile.fullPath;\n                    let httpFilePath = null;\n                    if(fullPath.startsWith(\"http://\") || fullPath.startsWith(\"https://\")){\n                        httpFilePath = fullPath;\n                    }\n                    if(_isPreviewableFile(fullPath)){\n                        const filePath = httpFilePath || path.relative(projectRoot, fullPath);\n                        resolve({\n                            URL: httpFilePath || `${projectRootUrl}${filePath}`,\n                            filePath: filePath,\n                            fullPath: fullPath,\n                            isMarkdownFile: _isMarkdownFile(fullPath)\n                        });\n                    } else {\n                        resolve({}); // not a previewable file\n                    }\n                }\n                resolve(await _getDefaultPreviewDetails());\n            }catch (e) {\n                reject(e);\n            }\n        });\n    }\n\n    exports.getPreviewDetails = getPreviewDetails;\n    exports.getNoPreviewURL = getNoPreviewURL;\n    exports.getExtension = getExtension;\n});\n\n\n"],"file":"utils.js"}