{"version":3,"sources":["extensions/default/QuickView/unittests.js"],"names":["define","require","exports","module","SpecRunnerUtils","brackets","getModule","PreferencesManager","prefs","getExtensionPrefs","describe","testFolder","getTestPath","testWindow","extensionRequire","CommandManager","Commands","EditorManager","QuickView","editor","testFile","oldFile","getPopoverAtPos","lineNum","columnNum","cm","getCurrentFullEditor","_codeMirror","pos","line","ch","token","setCursorPos","getTokenAt","_queryPreviewProviders","expectNoPreviewAtPos","popoverInfo","expect","toBeFalsy","checkColorAtPos","expectedColor","_previewCSS","toBe","checkGradientAtPos","expectedGradient","checkImagePathAtPos","expectedPathEnding","imagePath","_imgPath","substr","length","checkImageDataAtPos","expectedData","beforeEach","async","createTestWindowAndRun","loadProjectInTestWindow","test","ExtensionLoader","getRequireContextForExtension","awaitsForDone","openProjectFiles","afterAll","closeTestWindow","it","expectedGradient1","expectedGradient2","expectedGradient3","expectedGradient4","showPopoverAtPos","_forceShow","getBounds","object","useOffset","left","offset","parseInt","css","top","right","outerWidth","bottom","outerHeight","boundsInsideWindow","bounds","editorBounds","$","toggleOption","commandID","text","promise","execute","$popover","toEqual","toBeTruthy","TOGGLE_WORD_WRAP","scrollX","defaultCharWidth","scrollY","defaultTextHeight","setScrollPos","markers","findMarksAt","rangeMarker","marker","type","toBeDefined","range","find","from","to","original","get","set"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2013 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*global describe, it, expect, beforeEach, awaitsForDone, afterAll */\n\ndefine(function (require, exports, module) {\n\n\n    var SpecRunnerUtils    = brackets.getModule(\"spec/SpecRunnerUtils\"),\n        PreferencesManager = brackets.getModule(\"preferences/PreferencesManager\"),\n        prefs              = PreferencesManager.getExtensionPrefs(\"quickview\");\n\n    describe(\"extension:Quick View\", function () {\n        let testFolder = SpecRunnerUtils.getTestPath(\"/spec/quickview-extn-test-files\");\n\n        // load from testWindow\n        var testWindow,\n            brackets,\n            extensionRequire,\n            CommandManager,\n            Commands,\n            EditorManager,\n            QuickView,\n            editor,\n            testFile = \"test.css\",\n            oldFile;\n\n        beforeEach(async function () {\n            // Create a new window that will be shared by ALL tests in this spec.\n            if (!testWindow) {\n                testWindow = await SpecRunnerUtils.createTestWindowAndRun();\n\n                await SpecRunnerUtils.loadProjectInTestWindow(testFolder);\n            }\n\n            // Load module instances from brackets.test\n            brackets = testWindow.brackets;\n            CommandManager = brackets.test.CommandManager;\n            Commands = brackets.test.Commands;\n            EditorManager = brackets.test.EditorManager;\n            extensionRequire = brackets.test.ExtensionLoader.getRequireContextForExtension(\"QuickView\");\n            QuickView = extensionRequire(\"main\");\n\n            if (testFile !== oldFile) {\n                await awaitsForDone(SpecRunnerUtils.openProjectFiles([testFile]), \"open test file: \" + testFile);\n\n                editor  = EditorManager.getCurrentFullEditor();\n                oldFile = testFile;\n            }\n        }, 30000);\n\n        afterAll(async function () {\n            testWindow       = null;\n            brackets         = null;\n            CommandManager   = null;\n            Commands         = null;\n            EditorManager    = null;\n            extensionRequire = null;\n            QuickView        = null;\n            await SpecRunnerUtils.closeTestWindow();\n        });\n\n        function getPopoverAtPos(lineNum, columnNum) {\n            editor  = EditorManager.getCurrentFullEditor();\n            var cm = editor._codeMirror,\n                pos = { line: lineNum, ch: columnNum },\n                token;\n\n            editor.setCursorPos(pos);\n            token = cm.getTokenAt(pos, true);\n\n            return QuickView._queryPreviewProviders(editor, pos, token);\n        }\n\n        function expectNoPreviewAtPos(line, ch) {\n            var popoverInfo = getPopoverAtPos(line, ch);\n            expect(popoverInfo).toBeFalsy();\n        }\n\n        function checkColorAtPos(expectedColor, line, ch) {\n            var popoverInfo = getPopoverAtPos(line, ch);\n            expect(popoverInfo._previewCSS).toBe(expectedColor);\n        }\n\n        function checkGradientAtPos(expectedGradient, line, ch) {\n            // Just call checkColorAtPos since both have the same function calls.\n            checkColorAtPos(expectedGradient, line, ch);\n        }\n\n        function checkImagePathAtPos(expectedPathEnding, line, ch) {\n            var popoverInfo = getPopoverAtPos(line, ch),\n                imagePath = popoverInfo._imgPath;\n\n            // Just check end of path - local drive location prefix unimportant\n            expect(imagePath.substr(imagePath.length - expectedPathEnding.length)).toBe(expectedPathEnding);\n        }\n\n        function checkImageDataAtPos(expectedData, line, ch) {\n            var popoverInfo = getPopoverAtPos(line, ch);\n            expect(popoverInfo._imgPath).toBe(expectedData);\n        }\n\n        describe(\"Quick view colors\", function () {\n            it(\"should show preview of hex colors either in 3 digit hex or or 6-digit hex\", function () {\n                checkColorAtPos(\"#369\", 3, 12);\n                checkColorAtPos(\"#2491F5\", 4, 13);\n            });\n\n            it(\"should NOT show preview of color on words start with #\", function () {\n                expectNoPreviewAtPos(7, 7);     // cursor on #invalid_hex\n                expectNoPreviewAtPos(8, 15);    // cursor on #web\n            });\n\n            it(\"should show preview of valid rgb/rgba colors\", function () {\n                checkColorAtPos(\"rgb(255,0,0)\",           12, 12);  // no whitespace\n                checkColorAtPos(\"rgb(100%,   0%,   0%)\",  13, 17);  // extra whitespace\n                checkColorAtPos(\"rgb(50%, 75%, 25%)\",     14, 24);\n\n                // rgba with values of 0-255\n                checkColorAtPos(\"rgba(255, 0, 0, 0.5)\", 15, 23);\n                checkColorAtPos(\"rgba(255, 0, 0, 1)\",   16, 22);\n                checkColorAtPos(\"rgba(255, 0, 0, .5)\",  17, 19);\n\n                // rgba with percentage values\n                checkColorAtPos(\"rgba(100%, 0%, 0%, 0.5)\",  18, 32);\n                checkColorAtPos(\"rgba(80%, 50%, 50%, 1)\",   20, 33);\n                checkColorAtPos(\"rgba(50%, 75%, 25%, 1.0)\", 21, 23);\n            });\n\n            it(\"should NOT show preview of unsupported rgb/rgba colors\", function () {\n                expectNoPreviewAtPos(25, 14);    // cursor on rgb(300, 0, 0)\n                expectNoPreviewAtPos(26, 15);    // cursor on rgb(0, 95.5, 0)\n                expectNoPreviewAtPos(27, 15);    // cursor on rgba(-0, 0, 0, 0.5)\n            });\n\n            it(\"should show preview of valid hsl/hsla colors\", function () {\n                checkColorAtPos(\"hsl(0, 100%, 50%)\",       31, 22);\n                checkColorAtPos(\"hsla(0, 100%, 50%, 0.5)\", 32, 23);\n                checkColorAtPos(\"hsla(0, 100%, 50%, .5)\",  33, 23);\n                checkColorAtPos(\"hsl(390, 100%, 50%)\",     34, 24);\n            });\n\n            it(\"should NOT show preview of unsupported hsl/hsla colors\", function () {\n                expectNoPreviewAtPos(38, 25);    // cursor on hsla(90, 100%, 50%, 2)\n                expectNoPreviewAtPos(39, 24);    // cursor on hsla(0, 200%, 50%, 0.5)\n                expectNoPreviewAtPos(40, 25);    // cursor on hsla(0.0, 100%, 50%, .5)\n            });\n\n            it(\"should show preview of colors with valid names\", function () {\n                checkColorAtPos(\"blueviolet\",    47, 15);\n                checkColorAtPos(\"darkgoldenrod\", 49, 16);\n                checkColorAtPos(\"darkgray\",      50, 16);\n                checkColorAtPos(\"firebrick\",     51, 15);\n                checkColorAtPos(\"honeydew\",      53, 16);\n                checkColorAtPos(\"lavenderblush\", 56, 16);\n                checkColorAtPos(\"salmon\",        61, 16);\n                checkColorAtPos(\"tomato\",        66, 16);\n            });\n\n            it(\"should NOT show preview of colors with invalid names\", function () {\n                expectNoPreviewAtPos(72, 15);    // cursor on redsox\n                expectNoPreviewAtPos(73, 16);    // cursor on pinky\n                expectNoPreviewAtPos(74, 16);    // cursor on blue in hyphenated word blue-cheese\n                expectNoPreviewAtPos(75, 18);    // cursor on white in hyphenated word @bc-bg-highlight\n            });\n\n            describe(\"JavaScript file\", function () {\n                testFile = \"test.js\";\n\n                it(\"should NOT show preview of color-named functions and object/array keys\", function () {\n                    expectNoPreviewAtPos(2, 12);    // cursor on green()\n                    expectNoPreviewAtPos(4, 22);    // cursor on Math.tan\n                    expectNoPreviewAtPos(5, 14);    // cursor on tan()\n                    expectNoPreviewAtPos(5, 38);    // cursor on array[red]\n                });\n                it(\"should not show preview of literal color names\", function () {\n                    expectNoPreviewAtPos(2, 36);  // green\n                    expectNoPreviewAtPos(3, 21);  // green\n                    expectNoPreviewAtPos(5, 25);  // red\n                    expectNoPreviewAtPos(7,  1);  // darkgray\n                });\n            });\n        });\n\n        describe(\"Quick view gradients\", function () {\n            testFile = \"test.css\";\n\n            it(\"Should show linear gradient preview for those with vendor prefix\", function () {\n                var expectedGradient1 = \"-webkit-linear-gradient(top,  #d2dfed 0%, #c8d7eb 26%, #bed0ea 51%, #a6c0e3 51%, #afc7e8 62%, #bad0ef 75%, #99b5db 88%, #799bc8 100%)\",\n                    expectedGradient2 = \"-webkit-gradient(linear, left top, left bottom, color-stop(0%,#d2dfed), color-stop(26%,#c8d7eb), color-stop(51%,#bed0ea), color-stop(51%,#a6c0e3), color-stop(62%,#afc7e8), color-stop(75%,#bad0ef), color-stop(88%,#99b5db), color-stop(100%,#799bc8))\",\n                    expectedGradient3 = \"-webkit-linear-gradient(top,  #d2dfed 0%,#c8d7eb 26%,#bed0ea 51%,#a6c0e3 51%,#afc7e8 62%,#bad0ef 75%,#99b5db 88%,#799bc8 100%)\",\n                    expectedGradient4 = \"-webkit-gradient(linear, left top, left bottom, from(rgb(51,51,51)), to(rgb(204,204,204)))\";\n                checkGradientAtPos(expectedGradient1, 80, 36);   // -moz- prefix gets stripped\n                checkGradientAtPos(expectedGradient2, 81, 36);   // Old webkit syntax\n                checkGradientAtPos(expectedGradient3, 82, 36);   // -webkit- prefix gets stripped\n                checkGradientAtPos(expectedGradient3, 83, 36);   // -o- prefix gets stripped\n                checkGradientAtPos(expectedGradient3, 84, 36);   // -ms- prefix gets stripped\n                checkGradientAtPos(expectedGradient4, 90, 36);   // test parameters with 2 levels of nested parens\n            });\n\n            it(\"Should show linear gradient preview for those with colon or space before\", function () {\n                var expectedGradient = \"linear-gradient(to bottom, black 0%, white 100%)\";\n                checkGradientAtPos(expectedGradient, 169, 25);   // space colon space\n                checkGradientAtPos(expectedGradient, 170, 25);   // colon space\n                checkGradientAtPos(expectedGradient, 171, 25);   // space colon\n                checkGradientAtPos(expectedGradient, 172, 25);   // colon\n            });\n\n            it(\"Should show radial gradient preview for those with colon or space before\", function () {\n                var expectedGradient = \"radial-gradient(red, white 50%, blue 100%)\";\n                checkGradientAtPos(expectedGradient, 176, 25);   // space colon space\n                checkGradientAtPos(expectedGradient, 177, 25);   // colon space\n                checkGradientAtPos(expectedGradient, 178, 25);   // space colon\n                checkGradientAtPos(expectedGradient, 179, 25);   // colon\n            });\n\n            it(\"Should show linear gradient preview for those with w3c standard syntax (no prefix)\", function () {\n                checkGradientAtPos(\"linear-gradient(#333, #CCC)\",                  99, 50);\n                checkGradientAtPos(\"linear-gradient(135deg, #333, #CCC)\",          101, 50);\n\n                checkGradientAtPos(\"linear-gradient(to right, #333, #CCC)\",        98, 50);\n                checkGradientAtPos(\"linear-gradient(to bottom right, #333, #CCC)\", 100, 50);\n\n\n                // multiple colors\n                checkGradientAtPos(\"linear-gradient(#333, #CCC, #333)\",             104, 50);\n                checkGradientAtPos(\"linear-gradient(#333 0%, #CCC 33%, #333 100%)\", 105, 50);\n                checkGradientAtPos(\"linear-gradient(yellow, blue 20%, #0f0)\",       106, 50);\n            });\n\n            it(\"Should show radial gradient preview for those with vendor prefix syntax\", function () {\n                var expectedGradient1 = \"-webkit-gradient(radial, center center, 0, center center, 141, from(black), to(white), color-stop(25%, blue), color-stop(40%, green), color-stop(60%, red), color-stop(80%, purple))\",\n                    expectedGradient2 = \"-webkit-radial-gradient(center center, circle contain, black 0%, blue 25%, green 40%, red 60%, purple 80%, white 100%)\";\n                checkGradientAtPos(expectedGradient1, 110, 93);   // old webkit syntax\n                checkGradientAtPos(expectedGradient2, 111, 36);   // -webkit- prefix preserved\n                checkGradientAtPos(expectedGradient2, 112, 36);   // -moz- prefix gets stripped\n                checkGradientAtPos(expectedGradient2, 113, 36);   // -ms- prefix gets stripped\n                checkGradientAtPos(expectedGradient2, 114, 36);   // -0- prefix gets stripped\n            });\n\n            it(\"Should show radial gradient preview for those with w3c standard syntax (no prefix)\", function () {\n                checkGradientAtPos(\"radial-gradient(yellow, green)\", 118, 35);\n                checkGradientAtPos(\"radial-gradient(yellow, green)\", 118, 40);\n            });\n\n            it(\"Should show repeating linear gradient preview\", function () {\n                checkGradientAtPos(\"repeating-linear-gradient(red, blue 50%, red 100%)\", 122, 50);\n                checkGradientAtPos(\"repeating-linear-gradient(red 0%, white 0%, blue 0%)\", 123, 50);\n                checkGradientAtPos(\"repeating-linear-gradient(red 0%, white 50%, blue 100%)\", 124, 50);\n            });\n\n            it(\"Should show repeating radial gradient preview\", function () {\n                checkGradientAtPos(\"repeating-radial-gradient(circle closest-side at 20px 30px, red, yellow, green 100%, yellow 150%, red 200%)\", 128, 40);\n                checkGradientAtPos(\"repeating-radial-gradient(red, blue 50%, red 100%)\", 129, 40);\n            });\n\n            it(\"Should show comma-separated gradients\", function () {\n                // line ending in comma\n                checkGradientAtPos(\"linear-gradient(63deg, #999 23%, transparent 23%)\", 135,  50);\n\n                // multiple gradients on a line\n                checkGradientAtPos(\"linear-gradient(63deg, transparent 74%, #999 78%)\", 136,  50);\n                checkGradientAtPos(\"linear-gradient(63deg, transparent 0%, #999 38%, #999 58%, transparent 100%)\",   136, 100);\n            });\n\n            it(\"Should convert gradients arguments from pixel to percent\", function () {\n                // linear gradient in px\n                checkGradientAtPos(\"-webkit-linear-gradient(top, rgba(0,0,0,0) 0%, green 50%, red 100%)\", 163, 40);\n                // repeating linear-gradient in pixels (no prefix)\n                checkGradientAtPos(\"repeating-linear-gradient(red, blue 50%, red 100%)\", 164, 40);\n                // repeating radial-gradient in pixels (no prefix)\n                checkGradientAtPos(\"repeating-radial-gradient(red, blue 50%, red 100%)\", 165, 40);\n            });\n\n            it(\"Should not go into infinite loop on unbalanced parens\", function () {\n                // no preview, and no infinite loop\n                expectNoPreviewAtPos(189, 30);\n                expectNoPreviewAtPos(190, 40);\n            });\n        });\n\n        describe(\"Quick view display\", function () {\n\n            function showPopoverAtPos(line, ch) {\n                var popoverInfo = getPopoverAtPos(line, ch);\n                QuickView._forceShow(popoverInfo);\n            }\n\n            function getBounds(object, useOffset) {\n                var left = (useOffset ? object.offset().left : parseInt(object.css(\"left\"), 10)),\n                    top = (useOffset ? object.offset().top : parseInt(object.css(\"top\"), 10));\n                return {\n                    left: left,\n                    top: top,\n                    right: left + object.outerWidth(),\n                    bottom: top + object.outerHeight()\n                };\n            }\n\n            function boundsInsideWindow(object) {\n                // For the popover, we can't use offset(), because jQuery gets confused by the\n                // scale factor and transform origin that the animation uses. Instead, we rely\n                // on the fact that its offset parent is body, and just test its explicit left/top\n                // values.\n                var bounds = getBounds(object, false),\n                    editorBounds = getBounds(testWindow.$(\"#editor-holder\"), true);\n                return bounds.left   >= editorBounds.left   &&\n                    bounds.right  <= editorBounds.right  &&\n                    bounds.top    >= editorBounds.top    &&\n                    bounds.bottom <= editorBounds.bottom;\n            }\n\n            async function toggleOption(commandID, text) {\n                var promise = CommandManager.execute(commandID);\n                await awaitsForDone(promise, text);\n            }\n\n            it(\"popover is positioned within window bounds\", async function () {\n                var $popover  = testWindow.$(\"#quick-view-container\");\n                expect($popover.length).toEqual(1);\n\n                // Popover should be below item\n                showPopoverAtPos(3, 12);\n                expect(boundsInsideWindow($popover)).toBeTruthy();\n\n                // Popover should above item\n                showPopoverAtPos(20, 33);\n                expect(boundsInsideWindow($popover)).toBeTruthy();\n\n                // Turn off word wrap for next tests\n                await toggleOption(Commands.TOGGLE_WORD_WRAP, \"Toggle word-wrap\");\n\n                // Popover should be inside right edge\n                showPopoverAtPos(81, 36);\n                expect(boundsInsideWindow($popover)).toBeTruthy();\n\n                // Popover should be inside left edge\n                var scrollX = editor._codeMirror.defaultCharWidth()  * 80,\n                    scrollY = editor._codeMirror.defaultTextHeight() * 70;\n\n                editor.setScrollPos(scrollX, scrollY);      // Scroll right\n                showPopoverAtPos(82, 136);\n                expect(boundsInsideWindow($popover)).toBeTruthy();\n\n                // restore word wrap\n                await toggleOption(Commands.TOGGLE_WORD_WRAP, \"Toggle word-wrap\");\n            });\n\n            it(\"highlight matched text when popover shown\", function () {\n                showPopoverAtPos(4, 14);\n                var markers = editor._codeMirror.findMarksAt({line: 4, ch: 14});\n                let rangeMarker = null;\n                for(let marker of markers){\n                    if(marker.type === 'range'){\n                        rangeMarker = marker;\n                        break;\n                    }\n                }\n                expect(rangeMarker).toBeDefined();\n                let range = rangeMarker.find();\n                expect(range.from.ch).toBe(11);\n                expect(range.to.ch).toBe(18);\n            });\n\n        });\n\n        describe(\"Quick view images\", function () {\n            it(\"Should show image preview for file path inside url()\", function () {\n                checkImagePathAtPos(\"img/grabber_color-well.png\", 140, 26);\n                checkImagePathAtPos(\"img/Color.png\",              141, 26);\n                checkImagePathAtPos(\"img/throbber.gif\",           142, 26);\n                checkImagePathAtPos(\"img/update_large_icon.svg\",  143, 26);\n            });\n\n            it(\"Should show image preview for urls with http/https\", function () {\n                checkImagePathAtPos(\"https://raw.github.com/gruehle/HoverPreview/master/screenshots/Image.png\", 145, 26);\n            });\n\n            it(\"Should show image preview for file path inside single or double quotes\", function () {\n                checkImagePathAtPos(\"img/med_hero.jpg\",  147, 26);\n                checkImagePathAtPos(\"img/Gradient.png\",  148, 26);\n                checkImagePathAtPos(\"img/specials.jpeg\", 149, 26);\n            });\n\n            it(\"Should show image preview for subsequent images in a line\", function () {\n                checkImagePathAtPos(\"img/Gradient.png\", 153, 80);    // url(\"\")\n                checkImagePathAtPos(\"img/Gradient.png\", 154, 80);    // url()\n                checkImagePathAtPos(\"img/Gradient.png\", 155, 80);    // \"\"\n            });\n\n            it(\"Should show image preview for URIs containing quotes\", function () {\n                checkImagePathAtPos(\"img/don't.png\", 183, 26);  // url() containing '\n                checkImagePathAtPos(\"img/don't.png\", 184, 26);  // url(\"\") containing '\n                checkImageDataAtPos(\"data:image/svg+xml;utf8, <svg version='1.1' xmlns='http://www.w3.org/2000/svg'></svg>\", 185, 26);  // data url(\"\") containing '\n            });\n\n            it(\"Should show image preview for URLs with known image extensions\", function () {\n                checkImageDataAtPos(\"http://example.com/image.gif\", 194, 20);\n                checkImageDataAtPos(\"http://example.com/image.png\", 195, 20);\n                checkImageDataAtPos(\"http://example.com/image.jpe\", 196, 20);\n                checkImageDataAtPos(\"http://example.com/image.jpeg\", 197, 20);\n                checkImageDataAtPos(\"http://example.com/image.jpg\", 198, 20);\n                checkImageDataAtPos(\"http://example.com/image.ico\", 199, 20);\n                checkImageDataAtPos(\"http://example.com/image.bmp\", 200, 20);\n                checkImageDataAtPos(\"http://example.com/image.svg\", 201, 20);\n            });\n\n            it(\"Should show image preview for extensionless URLs (with protocol) with pref set\", function () {\n                // Flip the pref on and restore when done\n                var original = prefs.get(\"extensionlessImagePreview\");\n                prefs.set(\"extensionlessImagePreview\", true);\n\n                checkImageDataAtPos(\"https://image.service.com/id/1234513\", 203, 20); // https\n                checkImageDataAtPos(\"http://image.service.com/id/1234513\", 204, 20);  // http\n                checkImageDataAtPos(\"https://image.service.com/id/1234513?w=300&h=400\", 205, 20); // qs params\n\n                prefs.set(\"extensionlessImagePreview\", original);\n            });\n\n            it(\"Should not show image preview for extensionless URLs (with protocol) without pref set\", function () {\n                // Flip the pref off and restore when done\n                var original = prefs.get(\"extensionlessImagePreview\");\n                prefs.set(\"extensionlessImagePreview\", false);\n\n                checkImageDataAtPos(\"https://image.service.com/id/1234513\", 203, 20); // https\n                checkImageDataAtPos(\"http://image.service.com/id/1234513\", 204, 20);  // http\n                checkImageDataAtPos(\"https://image.service.com/id/1234513?w=300&h=400\", 205, 20); // qs params\n\n                prefs.set(\"extensionlessImagePreview\", original);\n            });\n\n            it(\"Should ignore URLs for common non-image extensions\", function () {\n                expectNoPreviewAtPos(209, 20); // .html\n                expectNoPreviewAtPos(210, 20); // .css\n                expectNoPreviewAtPos(211, 20); // .js\n                expectNoPreviewAtPos(212, 20); // .json\n                expectNoPreviewAtPos(213, 20); // .md\n                expectNoPreviewAtPos(214, 20); // .xml\n                expectNoPreviewAtPos(215, 20); // .mp3\n                expectNoPreviewAtPos(216, 20); // .ogv\n                expectNoPreviewAtPos(217, 20); // .mp4\n                expectNoPreviewAtPos(218, 20); // .mpeg\n                expectNoPreviewAtPos(219, 20); // .webm\n                expectNoPreviewAtPos(220, 20); // .zip\n                expectNoPreviewAtPos(221, 20); // .tgz\n            });\n\n            it(\"Should show image preview for a data URI inside url()\", function () {\n                checkImageDataAtPos(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAABq0lEQVQoU11RPUgcURD+Zt/unnrcCf4QIugRMcS7a2xjmmArRlRIFRBFgrVtGgmBRFCwTBoLsQiBGMxiJ4iksLRSFEzQRC2EAwm5g727feP3LpyFy1tm5s33zcz7RnDvG4x0zFgMJRY/jiewhy/w8FKSJkyaTuG7Fumvi+ARbQiLpcMDvH/Qj1S6Bf6vI5SxKPUG4fGm5kMf6wr08MKHILCKldoZlk0OIeuHjNuDBBcNAqvvENTLwKii1ZFoF/7G2PQDpNo8dFUt1AcSGfymz42PVfI8ghxht1bHh9MpucCiegMFdJoUOtSD+MxLPtI5T/GaHWhg+NjRk3G5utPikwb5bjzhq40JSChs6Sx1eOYAojg/fCFv7yvnBLGCLPMqxS2dZrtXnDthhySuYebnpFw3ST2RtmUVIx5z1sIKdX9qgDcOTJAj7WsNa8eTUhrY0Gwqg2FldeZiduH5r9JHvqEDigzDS/4VJvYJfMh9VLmbNO9+s9hNg5D/qjkJ8I6uW0yFtkrwHydCg+AhVgsp/8Pnu00XI+0jYJ7gjANRiEsmQ3aNOXuJhG035i1QA6g+uONCrgAAAABJRU5ErkJggg==\",  159, 26);\n            });\n        });\n    });\n});\n"],"file":"unittests.js"}