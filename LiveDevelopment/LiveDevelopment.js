define(function LiveDevelopment(require,exports,module){require("utils/Global");var _=require("thirdparty/lodash"),STATUS_ERROR=exports.STATUS_ERROR=-1,STATUS_INACTIVE=exports.STATUS_INACTIVE=0,STATUS_CONNECTING=exports.STATUS_CONNECTING=1,STATUS_LOADING_AGENTS=exports.STATUS_LOADING_AGENTS=2,STATUS_ACTIVE=exports.STATUS_ACTIVE=3,STATUS_OUT_OF_SYNC=exports.STATUS_OUT_OF_SYNC=4,STATUS_SYNC_ERROR=exports.STATUS_SYNC_ERROR=5,Async=require("utils/Async"),CSSUtils=require("language/CSSUtils"),Dialogs=require("widgets/Dialogs"),DefaultDialogs=require("widgets/DefaultDialogs"),DocumentManager=require("document/DocumentManager"),EditorManager=require("editor/EditorManager"),EventDispatcher=require("utils/EventDispatcher"),FileServer=require("LiveDevelopment/Servers/FileServer").FileServer,FileSystemError=require("filesystem/FileSystemError"),FileUtils=require("file/FileUtils"),LiveDevelopmentUtils=require("LiveDevelopment/LiveDevelopmentUtils"),LiveDevServerManager=require("LiveDevelopment/LiveDevServerManager"),MainViewManager=require("view/MainViewManager"),NativeApp=require("utils/NativeApp"),PreferencesDialogs=require("preferences/PreferencesDialogs"),ProjectManager=require("project/ProjectManager"),Strings=require("strings"),StringUtils=require("utils/StringUtils"),UserServer=require("LiveDevelopment/Servers/UserServer").UserServer,WebSocketTransport=require("LiveDevelopment/transports/WebSocketTransport"),PreferencesManager=require("preferences/PreferencesManager"),Metrics=require("utils/Metrics"),Inspector=require("LiveDevelopment/Inspector/Inspector"),CSSDocument=require("LiveDevelopment/Documents/CSSDocument"),CSSPreprocessorDocument=require("LiveDevelopment/Documents/CSSPreprocessorDocument"),HTMLDocument=require("LiveDevelopment/Documents/HTMLDocument"),JSDocument=require("LiveDevelopment/Documents/JSDocument"),SYNC_ERROR_CLASS="live-preview-sync-error",CSSAgent=require("LiveDevelopment/Agents/CSSAgent"),agents={console:require("LiveDevelopment/Agents/ConsoleAgent"),remote:require("LiveDevelopment/Agents/RemoteAgent"),network:require("LiveDevelopment/Agents/NetworkAgent"),dom:require("LiveDevelopment/Agents/DOMAgent"),css:CSSAgent,script:require("LiveDevelopment/Agents/ScriptAgent"),highlight:require("LiveDevelopment/Agents/HighlightAgent"),goto:require("LiveDevelopment/Agents/GotoAgent"),edit:require("LiveDevelopment/Agents/EditAgent")},launcherUrl=window.location.pathname;launcherUrl=(launcherUrl=launcherUrl.replace("/test/SpecRunner.html","/src/index.html")).substr(0,launcherUrl.lastIndexOf("/"))+"/LiveDevelopment/launch.html",launcherUrl=window.location.origin+launcherUrl;var _enabledAgentNames={console:!0,remote:!0,network:!0,css:!0,highlight:!0},_loadedAgentNames=[],_liveDocument,_relatedDocuments={},_openDeferred,_closeDeferred,_loadAgentsPromise,_server,_regServers=[];function _isPromisePending(promise){return promise&&"pending"===promise.state()}function _getCurrentDocument(){return DocumentManager.getCurrentDocument()}function _classForDocument(doc){switch(doc.getLanguage().getId()){case"less":case"scss":return CSSPreprocessorDocument;case"css":return CSSDocument;case"javascript":return exports.config.experimental?JSDocument:null}return LiveDevelopmentUtils.isHtmlFileExt(doc.file.fullPath)?HTMLDocument:null}function getLiveDocForPath(path){if(_server)return _server.get(path)}function getLiveDocForEditor(editor){return editor?getLiveDocForPath(editor.document.file.fullPath):null}function _doClearErrors(liveDocument){var lineHandle;liveDocument.editor&&liveDocument._errorLineHandles&&liveDocument._errorLineHandles.length&&liveDocument.editor._codeMirror.operation(function(){for(;lineHandle=liveDocument._errorLineHandles.pop();)liveDocument.editor._codeMirror.removeLineClass(lineHandle,"wrap",SYNC_ERROR_CLASS)})}function _makeTroubleshootingMessage(msg){return msg+" "+StringUtils.format(Strings.LIVE_DEVELOPMENT_TROUBLESHOOTING,brackets.config.troubleshoot_url)}function _closeDocument(liveDocument){_doClearErrors(liveDocument),liveDocument.close(),liveDocument.editor&&liveDocument.editor.off(".livedev"),liveDocument.off(".livedev")}function _closeRelatedDocument(liveDoc){_relatedDocuments[liveDoc.doc.url]&&delete _relatedDocuments[liveDoc.doc.url],_server&&_server.remove(liveDoc),_closeDocument(liveDoc)}function _setStatus(status,closeReason){if(status!==exports.status){exports.status=status;var reason=status===STATUS_INACTIVE?closeReason:null;exports.trigger("statusChange",status,reason)}}function _handleLiveDocumentStatusChanged(liveDocument){var startLine,endLine,i,lineHandle,status;_setStatus(liveDocument.errors.length?STATUS_SYNC_ERROR:STATUS_ACTIVE),liveDocument.editor&&liveDocument.editor._codeMirror.operation(function(){_doClearErrors(liveDocument),liveDocument._errorLineHandles=liveDocument._errorLineHandles||[],liveDocument.errors.forEach(function(error){for(startLine=error.startPos.line,endLine=error.endPos.line,i=startLine;i<endLine+1;i++)lineHandle=liveDocument.editor._codeMirror.addLineClass(i,"wrap",SYNC_ERROR_CLASS),liveDocument._errorLineHandles.push(lineHandle)})})}function _closeDocuments(){_liveDocument&&(_closeDocument(_liveDocument),_liveDocument=void 0),Object.keys(_relatedDocuments).forEach(function(url){_closeDocument(_relatedDocuments[url]),delete _relatedDocuments[url]}),_server&&_server.clear()}function _createDocument(doc,editor){var DocClass=_classForDocument(doc),liveDocument=new DocClass(doc,editor);return DocClass?(liveDocument.on("statusChanged.livedev",function(){_handleLiveDocumentStatusChanged(liveDocument)}),liveDocument):null}function _createLiveDocumentForFrame(doc){doc._ensureMasterEditor(),_liveDocument=_createDocument(doc,doc._masterEditor),_server.add(_liveDocument)}function enableAgent(name){agents.hasOwnProperty(name)&&!_enabledAgentNames.hasOwnProperty(name)&&(_enabledAgentNames[name]=!0)}function disableAgent(name){_enabledAgentNames.hasOwnProperty(name)&&delete _enabledAgentNames[name]}function _docIsOutOfSync(doc){var liveDoc=_server&&_server.get(doc.file.fullPath),isLiveEditingEnabled=liveDoc&&liveDoc.isLiveEditingEnabled();return doc.isDirty&&!isLiveEditingEnabled}function _onError(event,error,msgData){var message;error.message?message=error.message:(console.warn("Expected a non-empty string in error.message, got this instead:",error.message),message=JSON.stringify(error)),message&&"Uncaught"===message.substr(0,8)&&(message=message.substr(9));var data=error.data;Array.isArray(data)&&(message+="\n"+data.join("\n")),console.error(message,error,msgData)}function _styleSheetAdded(event,url){var path=_server&&_server.urlToPath(url),exists=!!_relatedDocuments[url],docPromise;path&&!exists&&DocumentManager.getDocumentForPath(path).done(function(doc){if(!(_classForDocument(doc)!==CSSDocument&&_classForDocument(doc)!==CSSPreprocessorDocument||_liveDocument&&doc===_liveDocument.doc)){var liveDoc=_createDocument(doc,doc._masterEditor);liveDoc&&(_server.add(liveDoc),_relatedDocuments[doc.url]=liveDoc,liveDoc.on("deleted.livedev",function(event,liveDoc){_closeRelatedDocument(liveDoc)}))}})}function unloadAgents(){_loadedAgentNames.forEach(function(name){agents[name].unload()}),_loadedAgentNames=[]}function _invokeAgentMethod(name,methodName){var oneAgentPromise;return agents[name]&&agents[name][methodName]&&(oneAgentPromise=agents[name][methodName].call()),oneAgentPromise?oneAgentPromise.fail(function(){console.error(methodName+" failed on agent",name)}):oneAgentPromise=(new $.Deferred).resolve().promise(),oneAgentPromise}function getEnabledAgents(){var enabledAgents;return enabledAgents=exports.config.experimental?agents:_enabledAgentNames,Object.keys(enabledAgents)}function _enableAgents(){return Async.doInParallel(getEnabledAgents(),function(name){return _invokeAgentMethod(name,"enable")},!0)}function loadAgents(){if(_loadAgentsPromise)return _loadAgentsPromise;var result=new $.Deferred,allAgentsPromise;return _loadAgentsPromise=result.promise(),_setStatus(STATUS_LOADING_AGENTS),allAgentsPromise=Async.doInParallel(getEnabledAgents(),function(name){return _invokeAgentMethod(name,"load").done(function(){_loadedAgentNames.push(name)})},!0),(allAgentsPromise=Async.withTimeout(allAgentsPromise,1e4)).done(function(){var doc=_liveDocument?_liveDocument.doc:null;if(doc){var status=STATUS_ACTIVE;_docIsOutOfSync(doc)&&(status=STATUS_OUT_OF_SYNC),_setStatus(status),result.resolve()}else result.reject()}),allAgentsPromise.fail(result.reject),_loadAgentsPromise.fail(function(){_setStatus(STATUS_ERROR),Dialogs.showModalDialog(Dialogs.DIALOG_ID_ERROR,Strings.LIVE_DEVELOPMENT_ERROR_TITLE,_makeTroubleshootingMessage(Strings.LIVE_DEV_LOADING_ERROR_MESSAGE))}).always(function(){_loadAgentsPromise=null}),_loadAgentsPromise}function _getInitialDocFromCurrent(){var doc=_getCurrentDocument(),refPath,i;if(doc&&(refPath=doc.file.fullPath,LiveDevelopmentUtils.isStaticHtmlFileExt(refPath)||LiveDevelopmentUtils.isServerHtmlFileExt(refPath)))return(new $.Deferred).resolve(doc);var result=new $.Deferred,baseUrl=ProjectManager.getBaseUrl(),hasOwnServerForLiveDevelopment=baseUrl&&baseUrl.length;return ProjectManager.getAllFiles().done(function(allFiles){var projectRoot=ProjectManager.getProjectRoot().fullPath,containingFolder,indexFileFound=!1,stillInProjectTree=!0;containingFolder=refPath?FileUtils.getDirectoryPath(refPath):projectRoot;for(var filteredFiltered=allFiles.filter(function(item){var parent=FileUtils.getParentPath(item.fullPath);return 0===containingFolder.indexOf(parent)}),filterIndexFile=function(fileInfo){if(0===fileInfo.fullPath.indexOf(containingFolder)){if("index"!==FileUtils.getFilenameWithoutExtension(fileInfo.name))return!1;if(hasOwnServerForLiveDevelopment){if(LiveDevelopmentUtils.isServerHtmlFileExt(fileInfo.name)||LiveDevelopmentUtils.isStaticHtmlFileExt(fileInfo.name))return!0}else if(LiveDevelopmentUtils.isStaticHtmlFileExt(fileInfo.name))return!0}};!indexFileFound&&stillInProjectTree;)-1===(i=_.findIndex(filteredFiltered,filterIndexFile))?-1===(containingFolder=FileUtils.getParentPath(containingFolder)).indexOf(projectRoot)&&(stillInProjectTree=!1):indexFileFound=!0;-1===i?result.resolve(null):DocumentManager.getDocumentForPath(filteredFiltered[i].fullPath).then(result.resolve,result.resolve)}),result.promise()}function onActiveEditorChange(event,current,previous){if(previous&&previous.document&&CSSUtils.isCSSPreprocessorFile(previous.document.file.fullPath)){var prevDocUrl=_server&&_server.pathToUrl(previous.document.file.fullPath);_relatedDocuments&&_relatedDocuments[prevDocUrl]&&_closeRelatedDocument(_relatedDocuments[prevDocUrl])}var docUrl;current&&current.document&&CSSUtils.isCSSPreprocessorFile(current.document.file.fullPath)&&_styleSheetAdded(null,_server&&_server.pathToUrl(current.document.file.fullPath))}function _doInspectorDisconnect(doCloseWindow){var closePromise,deferred=new $.Deferred,connected=Inspector.connected();return EditorManager.off("activeEditorChange",onActiveEditorChange),Inspector.Page.off(".livedev"),Inspector.off(".livedev"),_loadAgentsPromise?_loadAgentsPromise.always(unloadAgents):unloadAgents(),_closeDocuments(),_server&&(_server.stop(),_server=null),doCloseWindow&&connected?(closePromise=Inspector.Runtime.evaluate("window.open('', '_self').close();"),closePromise=Async.withTimeout(closePromise,5e3)):closePromise=(new $.Deferred).resolve(),closePromise.always(function(){Inspector.connected()?Inspector.disconnect().always(deferred.resolve):deferred.resolve()}),deferred.promise()}function _close(doCloseWindow,reason){if(WebSocketTransport.closeWebSocketServer(),_closeDeferred)return _closeDeferred;(_closeDeferred=new $.Deferred).always(function(){_closeDeferred=null});var promise=_closeDeferred.promise();function cleanup(){var closeDeferred;("mac"===brackets.platform?NativeApp.closeLiveBrowser():$.Deferred().resolve()).done(function(){_setStatus(STATUS_INACTIVE,reason||"explicit_close"),_regServers.forEach(function(server){LiveDevServerManager.removeServer(server)}),_regServers=[],_closeDeferred.resolve()}).fail(function(err){err&&(reason+=" ("+err+")"),_setStatus(STATUS_INACTIVE,reason||"explicit_close"),_closeDeferred.resolve()})}return _isPromisePending(_openDeferred)&&_openDeferred.reject(),exports.status===STATUS_INACTIVE?_closeDeferred.resolve():_doInspectorDisconnect(doCloseWindow).always(cleanup),promise}function _onFrameNavigated(event,res){var url=res.frame.url,baseUrl,baseUrlRegExp;res.frame.parentId||!url.match(/^file:\/\//i)&&_server&&(baseUrl=_server.getBaseUrl())&&(baseUrlRegExp=new RegExp("^"+StringUtils.regexEscape(baseUrl),"i"),url.match(baseUrlRegExp)||_close(!1,"navigated_away"))}function _onDisconnect(event){_close(!1,"closed_unknown_reason")}function _onDetached(event,res){var closeReason;res&&res.reason&&(closeReason="detached_"+res.reason),_close(!1,closeReason)}function reconnect(){return _loadAgentsPromise||(unloadAgents(),_.forOwn(_relatedDocuments,function(relatedDoc){_closeRelatedDocument(relatedDoc)}),loadAgents())}function reload(){reconnect(),Inspector.Page.reload()}function close(){return _close(!0)}function _waitForInterstitialPageLoad(){var deferred=$.Deferred(),keepPolling=!0,timer=window.setTimeout(function(){keepPolling=!1,deferred.reject()},1e4);function pollInterstitialPage(){keepPolling&&Inspector.connected()?Inspector.Runtime.evaluate("window.isBracketsLiveDevelopmentInterstitialPageLoaded",function(response){var result=response.result;"boolean"===result.type&&result.value?(window.clearTimeout(timer),deferred.resolve()):window.setTimeout(pollInterstitialPage,100)}):deferred.reject()}return pollInterstitialPage(),deferred.promise()}function _onInterstitialPageLoad(){var enablePromise;Inspector.Runtime.evaluate("window.navigator.userAgent",function(uaResponse){Inspector.setUserAgent(uaResponse.result.value)}),Inspector.Page.enable().then(function(){return Inspector.DOM.enable().then(_enableAgents,_enableAgents)}).done(function(){loadAgents().then(_openDeferred.resolve,_openDeferred.reject),_getInitialDocFromCurrent().done(function(doc){doc&&_liveDocument?(doc!==_liveDocument.doc&&_createLiveDocumentForFrame(doc),_server?Inspector.Page.navigate(_server.pathToUrl(doc.file.fullPath)):console.error("LiveDevelopment._onInterstitialPageLoad(): No server active")):close()})})}function _onConnect(event){Inspector.Page.on("frameNavigated.livedev",_onFrameNavigated),Inspector.on("disconnect.livedev",_onDisconnect),_waitForInterstitialPageLoad().fail(function(){close(),Dialogs.showModalDialog(DefaultDialogs.DIALOG_ID_ERROR,Strings.LIVE_DEVELOPMENT_ERROR_TITLE,_makeTroubleshootingMessage(Strings.LIVE_DEV_LOADING_ERROR_MESSAGE))}).done(_onInterstitialPageLoad)}function _showWrongDocError(){Dialogs.showModalDialog(DefaultDialogs.DIALOG_ID_ERROR,Strings.LIVE_DEVELOPMENT_ERROR_TITLE,_makeTroubleshootingMessage(Strings.LIVE_DEV_NEED_HTML_MESSAGE)),_openDeferred.reject()}function _showLiveDevServerNotReadyError(){Dialogs.showModalDialog(DefaultDialogs.DIALOG_ID_ERROR,Strings.LIVE_DEVELOPMENT_ERROR_TITLE,_makeTroubleshootingMessage(Strings.LIVE_DEV_SERVER_NOT_READY_MESSAGE)),_openDeferred.reject()}function _openInterstitialPage(){var browserStarted=!1,retryCount=0;Inspector.connectToURL(launcherUrl).fail(function onConnectFail(err){if("CANCEL"!==err){var dialogPromise;if(retryCount>3)return _setStatus(STATUS_ERROR),void Dialogs.showModalDialog(DefaultDialogs.DIALOG_ID_LIVE_DEVELOPMENT,Strings.LIVE_DEVELOPMENT_RELAUNCH_TITLE,_makeTroubleshootingMessage(Strings.LIVE_DEVELOPMENT_ERROR_MESSAGE),[{className:Dialogs.DIALOG_BTN_CLASS_LEFT,id:Dialogs.DIALOG_BTN_CANCEL,text:Strings.CANCEL},{className:Dialogs.DIALOG_BTN_CLASS_PRIMARY,id:Dialogs.DIALOG_BTN_OK,text:Strings.RELAUNCH_CHROME}]).done(function(id){id===Dialogs.DIALOG_BTN_OK?(_setStatus(STATUS_INACTIVE),_close().done(function(){browserStarted=!1,open(!0)}).fail(function(err){_setStatus(STATUS_ERROR),browserStarted=!1,_openDeferred.reject("CLOSE_LIVE_BROWSER")})):_close().done(function(){browserStarted=!1,_openDeferred.reject("CANCEL")}).fail(function(err){_setStatus(STATUS_ERROR),browserStarted=!1,_openDeferred.reject("CLOSE_LIVE_BROWSER")})});retryCount++,browserStarted||exports.status===STATUS_ERROR||NativeApp.openLiveBrowser(launcherUrl,!0).done(function(){browserStarted=!0}).fail(function(err){var message;_setStatus(STATUS_ERROR),message=err===FileSystemError.NOT_FOUND?Strings.ERROR_CANT_FIND_CHROME:StringUtils.format(Strings.ERROR_LAUNCHING_BROWSER,err),Dialogs.showModalDialog(DefaultDialogs.DIALOG_ID_ERROR,Strings.ERROR_LAUNCHING_BROWSER_TITLE,_makeTroubleshootingMessage(message)),_openDeferred.reject("OPEN_LIVE_BROWSER")}),exports.status!==STATUS_ERROR&&window.setTimeout(function retryConnect(){Inspector.connectToURL(launcherUrl).fail(onConnectFail)},3e3)}else _openDeferred.reject(err)})}function _doLaunchAfterServerReady(initialDoc){_setStatus(STATUS_CONNECTING),_createLiveDocumentForFrame(initialDoc),_server.start(),Inspector.one("connect",_onConnect),_openInterstitialPage(),_openDeferred.done(function(){EditorManager.on("activeEditorChange",onActiveEditorChange),onActiveEditorChange(null,EditorManager.getActiveEditor(),null)})}function _prepareServer(doc){var deferred=new $.Deferred,showBaseUrlPrompt=!1;if(_server=LiveDevServerManager.getServer(doc.file.fullPath),showBaseUrlPrompt=!exports.config.experimental&&!_server&&LiveDevelopmentUtils.isServerHtmlFileExt(doc.file.fullPath))PreferencesDialogs.showProjectPreferencesDialog("",Strings.LIVE_DEV_NEED_BASEURL_MESSAGE).done(function(id){id===Dialogs.DIALOG_BTN_OK&&ProjectManager.getBaseUrl()?_prepareServer(doc).then(deferred.resolve,deferred.reject):deferred.reject()});else if(_server){var readyPromise=_server.readyToServe();readyPromise?readyPromise.then(deferred.resolve,function(){_showLiveDevServerNotReadyError(),deferred.reject()}):(_showLiveDevServerNotReadyError(),deferred.reject())}else deferred.reject();return deferred.promise()}function getCurrentProjectServerConfig(){return{baseUrl:ProjectManager.getBaseUrl(),pathResolver:ProjectManager.makeProjectRelativeIfPossible,root:ProjectManager.getProjectRoot().fullPath}}function _createUserServer(){return new UserServer(getCurrentProjectServerConfig())}function _createFileServer(){return new FileServer(getCurrentProjectServerConfig())}function open(restart){if(_isPromisePending(_closeDeferred))return _closeDeferred.then(function(){return open(restart)});if(!restart){if(_isPromisePending(_openDeferred))return _openDeferred;(_openDeferred=new $.Deferred).always(function(){_openDeferred=null})}return Metrics.countEvent(Metrics.EVENT_TYPE.LIVE_PREVIEW,"Open","usage"),_regServers.push(LiveDevServerManager.registerServer({create:_createUserServer},99)),_regServers.push(LiveDevServerManager.registerServer({create:_createFileServer},0)),_getInitialDocFromCurrent().done(function(doc){var prepareServerPromise=doc&&_prepareServer(doc)||(new $.Deferred).reject(),otherDocumentsInWorkingFiles;doc&&!doc._masterEditor&&(otherDocumentsInWorkingFiles=MainViewManager.getWorkingSet(MainViewManager.ALL_PANES).length,MainViewManager.addToWorkingSet(MainViewManager.ACTIVE_PANE,doc.file),otherDocumentsInWorkingFiles||MainViewManager._edit(MainViewManager.ACTIVE_PANE,doc)),prepareServerPromise.done(function(){var reverseInspectPref=PreferencesManager.get("livedev.enableReverseInspect"),wsPort=PreferencesManager.get("livedev.wsPort");wsPort&&reverseInspectPref&&WebSocketTransport.createWebSocketServer(wsPort),_doLaunchAfterServerReady(doc)}).fail(function(){_showWrongDocError()})}),_openDeferred.promise()}function showHighlight(){var doc=getLiveDocForEditor(EditorManager.getActiveEditor());doc&&doc.updateHighlight&&doc.updateHighlight()}function hideHighlight(){Inspector.connected()&&agents.highlight&&agents.highlight.hide()}function redrawHighlight(){Inspector.connected()&&agents.highlight&&agents.highlight.redraw()}function _onFileChanged(){var doc=_getCurrentDocument();if(doc&&Inspector.connected()){var docUrl=_server&&_server.pathToUrl(doc.file.fullPath),wasRequested=agents.network&&agents.network.wasURLRequested(docUrl),isViewable=exports.config.experimental||_server&&_server.canServe(doc.file.fullPath);!wasRequested&&isViewable?(_setStatus(STATUS_CONNECTING),_closeDocuments(),_createLiveDocumentForFrame(doc),Inspector.Page.navigate(docUrl).then(function(){_setStatus(STATUS_ACTIVE)},function(){_close(!1,"closed_unknown_reason")})):wasRequested&&showHighlight()}}function _onDocumentSaved(event,doc){if(Inspector.connected()&&_server){var absolutePath=doc.file.fullPath,liveDocument=absolutePath&&_server.get(absolutePath),liveEditingEnabled;if(!(liveDocument&&liveDocument.isLiveEditingEnabled&&liveDocument.isLiveEditingEnabled())){var documentUrl=_server.pathToUrl(absolutePath),wasRequested;agents.network&&agents.network.wasURLRequested(documentUrl)&&reload()}}}function _onDirtyFlagChange(event,doc){doc&&Inspector.connected()&&_server&&agents.network&&agents.network.wasURLRequested(_server.pathToUrl(doc.file.fullPath))&&_setStatus(_docIsOutOfSync(doc)?STATUS_OUT_OF_SYNC:STATUS_ACTIVE)}function init(theConfig){exports.config=theConfig,Inspector.on("error",_onError),Inspector.Inspector.on("detached",_onDetached),CSSAgent.on("styleSheetAdded.livedev",_styleSheetAdded),MainViewManager.on("currentFileChange",_onFileChanged),DocumentManager.on("documentSaved",_onDocumentSaved).on("dirtyFlagChange",_onDirtyFlagChange),ProjectManager.on("beforeProjectClose beforeAppClose",close),_setStatus(STATUS_INACTIVE)}function _getServer(){return _server}function getServerBaseUrl(){return _server&&_server.getBaseUrl()}PreferencesManager.definePreference("livedev.wsPort","number",8125,{description:Strings.DESCRIPTION_LIVEDEV_WEBSOCKET_PORT}),PreferencesManager.definePreference("livedev.enableReverseInspect","boolean",!0,{description:Strings.DESCRIPTION_LIVEDEV_ENABLE_REVERSE_INSPECT}),EventDispatcher.makeEventDispatcher(exports),exports.launcherUrl=launcherUrl,exports._getServer=_getServer,exports._getInitialDocFromCurrent=_getInitialDocFromCurrent,exports.agents=agents,exports.open=open,exports.close=close,exports.reconnect=reconnect,exports.reload=reload,exports.enableAgent=enableAgent,exports.disableAgent=disableAgent,exports.getLiveDocForPath=getLiveDocForPath,exports.showHighlight=showHighlight,exports.hideHighlight=hideHighlight,exports.redrawHighlight=redrawHighlight,exports.init=init,exports.getCurrentProjectServerConfig=getCurrentProjectServerConfig,exports.getServerBaseUrl=getServerBaseUrl});
//# sourceMappingURL=LiveDevelopment.js.map
