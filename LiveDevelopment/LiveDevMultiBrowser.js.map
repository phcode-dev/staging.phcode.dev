{"version":3,"sources":["LiveDevelopment/LiveDevMultiBrowser.js"],"names":["define","require","exports","module","STATUS_INACTIVE","STATUS_CONNECTING","STATUS_ACTIVE","STATUS_OUT_OF_SYNC","STATUS_SYNC_ERROR","STATUS_RELOADING","STATUS_RESTARTING","CommandManager","Commands","Dialogs","DefaultDialogs","DocumentManager","EditorManager","EventDispatcher","FileUtils","MainViewManager","PreferencesDialogs","ProjectManager","Strings","_","LiveDevelopmentUtils","LiveDevServerManager","NodeSocketTransport","LiveDevProtocol","DefaultLauncher","LiveCSSDocument","LiveHTMLDocument","_liveDocument","_relatedDocuments","_protocol","_launcher","_server","_classForDocument","doc","getLanguage","getId","isHtmlFileExt","file","fullPath","isActive","status","getLiveDocForPath","path","get","_closeDocument","liveDocument","off","close","_handleRelatedDocumentDeleted","url","liveDoc","remove","_setStatus","closeReason","reason","trigger","_closeDocuments","undefined","Object","keys","forEach","clear","_resolveUrl","pathToUrl","_createLiveDocument","editor","roots","DocClass","on","event","hasErrors","_docIsOutOfSync","isLiveEditingEnabled","isDirty","_styleSheetAdded","urlToPath","alreadyAdded","docPromise","getDocumentForPath","done","_masterEditor","add","_updateBrowser","_getInitialDocFromCurrent","getCurrentDocument","refPath","i","isStaticHtmlFileExt","isServerHtmlFileExt","$","Deferred","resolve","result","baseUrl","getBaseUrl","hasOwnServerForLiveDevelopment","length","getAllFiles","allFiles","projectRoot","getProjectRoot","containingFolder","indexFileFound","stillInProjectTree","getDirectoryPath","filteredFiltered","filter","item","parent","getParentPath","indexOf","filterIndexFile","fileInfo","getFilenameWithoutExtension","name","findIndex","then","promise","_close","doCloseWindow","closeAllConnections","stop","_showWrongDocError","showModalDialog","DIALOG_ID_ERROR","LIVE_DEVELOPMENT_ERROR_TITLE","LIVE_DEV_NEED_HTML_MESSAGE","_showLiveDevServerNotReadyError","LIVE_DEV_SERVER_NOT_READY_MESSAGE","_createLiveDocumentForFrame","_ensureMasterEditor","_launch","launch","_open","navigate","msg","getConnectionIds","setTimeout","relatedDocs","related","docs","stylesheets","href","console","error","_doLaunchAfterServerReady","initialDoc","start","_prepareServer","deferred","showBaseUrlPrompt","getServer","showProjectPreferencesDialog","LIVE_DEV_NEED_BASEURL_MESSAGE","id","DIALOG_BTN_OK","reject","readyPromise","readyToServe","_onFileChange","docUrl","isViewable","canServe","open","prepareServerPromise","otherDocumentsInWorkingFiles","getWorkingSetSize","ALL_PANES","addToWorkingSet","ACTIVE_PANE","execute","CMD_OPEN","fail","_onDocumentSaved","absolutePath","liveEditingEnabled","isRelated","reload","_onDirtyFlagChange","setTransport","transport","setLauncher","launcher","log","Error","init","config","getLiveDocForEditor","document","showHighlight","getActiveEditor","updateHighlight","hideHighlight","evaluate","redrawHighlight","reconnect","getCurrentProjectServerConfig","pathResolver","makeProjectRelativeIfPossible","root","getServerBaseUrl","_getCurrentLiveDoc","makeEventDispatcher"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2012 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/**\n * LiveDevelopment allows Brackets to launch a browser with a \"live preview\" that's\n * connected to the current editor.\n *\n * # STARTING\n *\n * To start a session call `open`. This will read the currentDocument from brackets,\n * launch it in the default browser, and connect to it for live editing.\n *\n * # STOPPING\n *\n * To stop a session call `close`. This will close the connection to the browser\n * (but will not close the browser tab).\n *\n * # STATUS\n *\n * Status updates are dispatched as `statusChange` jQuery events. The status\n * is passed as the first parameter and the reason for the change as the second\n * parameter. Currently only the \"Inactive\" status supports the reason parameter.\n * The status codes are:\n *\n *  0: Inactive\n *  1: Connecting (waiting for a browser connection)\n *  2: Active\n *  3: Out of sync\n *  4: Sync error\n *  5: Reloading (after saving JS changes)\n *  6: Restarting (switching context to a new HTML live doc)\n *\n * The reason codes are:\n * - null (Unknown reason)\n * - \"explicit_close\" (LiveDevelopment.close() was called)\n * - \"navigated_away\" (The browser changed to a location outside of the project)\n * - \"detached_target_closed\" (The tab or window was closed)\n */\ndefine(function (require, exports, module) {\n\n\n    // Status Codes\n    var STATUS_INACTIVE      = exports.STATUS_INACTIVE       =  0;\n    var STATUS_CONNECTING    = exports.STATUS_CONNECTING     =  1;\n    var STATUS_ACTIVE        = exports.STATUS_ACTIVE         =  2;\n    var STATUS_OUT_OF_SYNC   = exports.STATUS_OUT_OF_SYNC    =  3;\n    var STATUS_SYNC_ERROR    = exports.STATUS_SYNC_ERROR     =  4;\n    var STATUS_RELOADING     = exports.STATUS_RELOADING      =  5;\n    var STATUS_RESTARTING    = exports.STATUS_RESTARTING     =  6;\n\n    var CommandManager       = require(\"command/CommandManager\"),\n        Commands             = require(\"command/Commands\"),\n        Dialogs              = require(\"widgets/Dialogs\"),\n        DefaultDialogs       = require(\"widgets/DefaultDialogs\"),\n        DocumentManager      = require(\"document/DocumentManager\"),\n        EditorManager        = require(\"editor/EditorManager\"),\n        EventDispatcher      = require(\"utils/EventDispatcher\"),\n        FileUtils            = require(\"file/FileUtils\"),\n        MainViewManager      = require(\"view/MainViewManager\"),\n        PreferencesDialogs   = require(\"preferences/PreferencesDialogs\"),\n        ProjectManager       = require(\"project/ProjectManager\"),\n        Strings              = require(\"strings\"),\n        _                    = require(\"thirdparty/lodash\"),\n        LiveDevelopmentUtils = require(\"LiveDevelopment/LiveDevelopmentUtils\"),\n        LiveDevServerManager = require(\"LiveDevelopment/LiveDevServerManager\"),\n        NodeSocketTransport  = require(\"LiveDevelopment/MultiBrowserImpl/transports/NodeSocketTransport\"),\n        LiveDevProtocol      = require(\"LiveDevelopment/MultiBrowserImpl/protocol/LiveDevProtocol\"),\n        DefaultLauncher      = require(\"LiveDevelopment/MultiBrowserImpl/launchers/Launcher\");\n\n    // Documents\n    var LiveCSSDocument      = require(\"LiveDevelopment/MultiBrowserImpl/documents/LiveCSSDocument\"),\n        LiveHTMLDocument     = require(\"LiveDevelopment/MultiBrowserImpl/documents/LiveHTMLDocument\");\n\n    /**\n     * @private\n     * The live HTML document for the currently active preview.\n     * @type {LiveHTMLDocument}\n     */\n    var _liveDocument;\n\n    /**\n     * @private\n     * Live documents related to the active HTML document - for example, CSS files\n     * that are used by the document.\n     * @type {Object.<string: {LiveHTMLDocument|LiveCSSDocument}>}\n     */\n    var _relatedDocuments = {};\n\n    /**\n     * @private\n     * Protocol handler that provides the actual live development API on top of the current transport.\n     */\n    var _protocol = LiveDevProtocol;\n\n    /**\n     * @private\n     * Current browser launcher for preview.\n     */\n    var _launcher;\n\n    /**\n     * @private\n     * Current live preview server\n     * @type {BaseServer}\n     */\n    var _server;\n\n    /**\n     * @private\n     * Determine which live document class should be used for a given document\n     * @param {Document} document The document we want to create a live document for.\n     * @return {function} The constructor for the live document class; will be a subclass of LiveDocument.\n     */\n    function _classForDocument(doc) {\n        if (doc.getLanguage().getId() === \"css\") {\n            return LiveCSSDocument;\n        }\n\n        if (LiveDevelopmentUtils.isHtmlFileExt(doc.file.fullPath)) {\n            return LiveHTMLDocument;\n        }\n\n        return null;\n    }\n\n    /**\n     * Returns true if the global Live Development mode is on (might be in the middle of connecting).\n     * @return {boolean}\n     */\n    function isActive() {\n        return exports.status > STATUS_INACTIVE;\n    }\n\n    /**\n     * Returns the live document for a given path, or null if there is no live document for it.\n     * @param {string} path\n     * @return {?LiveDocument}\n     */\n    function getLiveDocForPath(path) {\n        if (!_server) {\n            return null;\n        }\n\n        return _server.get(path);\n    }\n\n    /**\n     * @private\n     * Close a live document.\n     * @param {LiveDocument}\n     */\n    function _closeDocument(liveDocument) {\n        liveDocument.off(\".livedev\");\n        liveDocument.close();\n    }\n\n    /**\n     * Removes the given CSS/JSDocument from _relatedDocuments. Signals that the\n     * given file is no longer associated with the HTML document that is live (e.g.\n     * if the related file has been deleted on disk).\n     * @param {string} url Absolute URL of the related document\n     */\n    function _handleRelatedDocumentDeleted(url) {\n        var liveDoc = _relatedDocuments[url];\n        if (liveDoc) {\n            delete _relatedDocuments[url];\n        }\n\n        if (_server) {\n            _server.remove(liveDoc);\n        }\n        _closeDocument(liveDoc);\n    }\n\n    /**\n     * Update the status. Triggers a statusChange event.\n     * @param {number} status new status\n     * @param {?string} closeReason Optional string key suffix to display to\n     *     user when closing the live development connection (see LIVE_DEV_* keys)\n     */\n    function _setStatus(status, closeReason) {\n        // Don't send a notification when the status didn't actually change\n        if (status === exports.status) {\n            return;\n        }\n\n        exports.status = status;\n\n        var reason = status === STATUS_INACTIVE ? closeReason : null;\n        exports.trigger(\"statusChange\", status, reason);\n    }\n\n    /**\n     * @private\n     * Close all live documents.\n     */\n    function _closeDocuments() {\n        if (_liveDocument) {\n            _closeDocument(_liveDocument);\n            _liveDocument = undefined;\n        }\n\n        Object.keys(_relatedDocuments).forEach(function (url) {\n            _closeDocument(_relatedDocuments[url]);\n            delete _relatedDocuments[url];\n        });\n\n        // Clear all documents from request filtering\n        if (_server) {\n            _server.clear();\n        }\n    }\n\n    /**\n     * @private\n     * Returns the URL that we would serve the given path at.\n     * @param {string} path\n     * @return {string}\n     */\n    function _resolveUrl(path) {\n        return _server && _server.pathToUrl(path);\n    }\n\n    /**\n     * @private\n     * Create a LiveDocument for a Brackets editor/document to manage communication between the\n     * editor and the browser.\n     * @param {Document} doc\n     * @param {Editor} editor\n     * @param {roots} roots\n     * @return {?LiveDocument} The live document, or null if this type of file doesn't support live editing.\n     */\n    function _createLiveDocument(doc, editor, roots) {\n        var DocClass = _classForDocument(doc),\n            liveDocument;\n\n        if (!DocClass) {\n            return null;\n        }\n\n        liveDocument = new DocClass(_protocol, _resolveUrl, doc, editor, roots);\n\n        liveDocument.on(\"errorStatusChanged.livedev\", function (event, hasErrors) {\n            if (isActive()) {\n                _setStatus(hasErrors ? STATUS_SYNC_ERROR : STATUS_ACTIVE);\n            }\n        });\n\n        return liveDocument;\n    }\n\n    /**\n     * Documents are considered to be out-of-sync if they are dirty and\n     * do not have \"update while editing\" support\n     * @param {Document} doc\n     * @return {boolean}\n     */\n    function _docIsOutOfSync(doc) {\n        var liveDoc = _server && _server.get(doc.file.fullPath),\n            isLiveEditingEnabled = liveDoc && liveDoc.isLiveEditingEnabled();\n\n        return doc.isDirty && !isLiveEditingEnabled;\n    }\n\n    /**\n     * Handles a notification from the browser that a stylesheet was loaded into\n     * the live HTML document. If the stylesheet maps to a file in the project, then\n     * creates a live document for the stylesheet and adds it to _relatedDocuments.\n     * @param {$.Event} event\n     * @param {string} url The URL of the stylesheet that was added.\n     * @param {array} roots The URLs of the roots of the stylesheet (the css files loaded through <link>)\n     */\n    function _styleSheetAdded(event, url, roots) {\n        var path = _server && _server.urlToPath(url),\n            alreadyAdded = !!_relatedDocuments[url];\n\n        // path may be null if loading an external stylesheet.\n        // Also, the stylesheet may already exist and be reported as added twice\n        // due to Chrome reporting added/removed events after incremental changes\n        // are pushed to the browser\n        if (!path || alreadyAdded) {\n            return;\n        }\n\n        var docPromise = DocumentManager.getDocumentForPath(path);\n\n        docPromise.done(function (doc) {\n            if ((_classForDocument(doc) === LiveCSSDocument) &&\n                    (!_liveDocument || (doc !== _liveDocument.doc))) {\n                var liveDoc = _createLiveDocument(doc, doc._masterEditor, roots);\n                if (liveDoc) {\n                    _server.add(liveDoc);\n                    _relatedDocuments[doc.url] = liveDoc;\n                    liveDoc.on(\"updateDoc\", function (event, url) {\n                        var path = _server.urlToPath(url),\n                            doc = getLiveDocForPath(path);\n                        doc._updateBrowser();\n                    });\n                }\n            }\n        });\n    }\n\n    /**\n     * @private\n     * Determine an index file that can be used to start Live Development.\n     * This function will inspect all files in a project to find the closest index file\n     * available for currently opened document. We are searching for these files:\n     *  - index.html\n     *  - index.htm\n     *\n     * If the project is configured with a custom base url for live development, then\n     * the list of possible index files is extended to contain these index files too:\n     *  - index.php\n     *  - index.php3\n     *  - index.php4\n     *  - index.php5\n     *  - index.phtm\n     *  - index.phtml\n     *  - index.cfm\n     *  - index.cfml\n     *  - index.asp\n     *  - index.aspx\n     *  - index.jsp\n     *  - index.jspx\n     *  - index.shm\n     *  - index.shml\n     *\n     * If a file was found, the promise will be resolved with the full path to this file. If no file\n     * was found in the whole project tree, the promise will be resolved with null.\n     *\n     * @return {jQuery.Promise} A promise that is resolved with a full path\n     * to a file if one could been determined, or null if there was no suitable index\n     * file.\n     */\n    function _getInitialDocFromCurrent() {\n        var doc = DocumentManager.getCurrentDocument(),\n            refPath,\n            i;\n\n        // Is the currently opened document already a file we can use for Live Development?\n        if (doc) {\n            refPath = doc.file.fullPath;\n            if (LiveDevelopmentUtils.isStaticHtmlFileExt(refPath) || LiveDevelopmentUtils.isServerHtmlFileExt(refPath)) {\n                return new $.Deferred().resolve(doc);\n            }\n        }\n\n        var result = new $.Deferred();\n\n        var baseUrl = ProjectManager.getBaseUrl(),\n            hasOwnServerForLiveDevelopment = (baseUrl && baseUrl.length);\n\n        ProjectManager.getAllFiles().done(function (allFiles) {\n            var projectRoot = ProjectManager.getProjectRoot().fullPath,\n                containingFolder,\n                indexFileFound = false,\n                stillInProjectTree = true;\n\n            if (refPath) {\n                containingFolder = FileUtils.getDirectoryPath(refPath);\n            } else {\n                containingFolder = projectRoot;\n            }\n\n            var filteredFiltered = allFiles.filter(function (item) {\n                var parent = FileUtils.getParentPath(item.fullPath);\n\n                return (containingFolder.indexOf(parent) === 0);\n            });\n\n            var filterIndexFile = function (fileInfo) {\n                if (fileInfo.fullPath.indexOf(containingFolder) === 0) {\n                    if (FileUtils.getFilenameWithoutExtension(fileInfo.name) === \"index\") {\n                        if (hasOwnServerForLiveDevelopment) {\n                            if ((LiveDevelopmentUtils.isServerHtmlFileExt(fileInfo.name)) ||\n                                    (LiveDevelopmentUtils.isStaticHtmlFileExt(fileInfo.name))) {\n                                return true;\n                            }\n                        } else if (LiveDevelopmentUtils.isStaticHtmlFileExt(fileInfo.name)) {\n                            return true;\n                        }\n                    } else {\n                        return false;\n                    }\n                }\n            };\n\n            while (!indexFileFound && stillInProjectTree) {\n                i = _.findIndex(filteredFiltered, filterIndexFile);\n\n                // We found no good match\n                if (i === -1) {\n                    // traverse the directory tree up one level\n                    containingFolder = FileUtils.getParentPath(containingFolder);\n                    // Are we still inside the project?\n                    if (containingFolder.indexOf(projectRoot) === -1) {\n                        stillInProjectTree = false;\n                    }\n                } else {\n                    indexFileFound = true;\n                }\n            }\n\n            if (i !== -1) {\n                DocumentManager.getDocumentForPath(filteredFiltered[i].fullPath).then(result.resolve, result.resolve);\n                return;\n            }\n\n            result.resolve(null);\n        });\n\n        return result.promise();\n    }\n\n    /**\n     * @private\n     * Close the connection and the associated window\n     * @param {boolean} doCloseWindow Use true to close the window/tab in the browser\n     * @param {?string} reason Optional string key suffix to display to user (see LIVE_DEV_* keys)\n     */\n    function _close(doCloseWindow, reason) {\n        if (exports.status !== STATUS_INACTIVE) {\n            // Close live documents\n            _closeDocuments();\n            // Close all active connections\n            _protocol.closeAllConnections();\n\n            if (_server) {\n                // Stop listening for requests when disconnected\n                _server.stop();\n\n                // Dispose server\n                _server = null;\n            }\n        }\n    //TODO: implement closeWindow together with launchers.\n//        if (doCloseWindow) {\n//\n//        }\n        _setStatus(STATUS_INACTIVE, reason || \"explicit_close\");\n    }\n\n    /**\n     * Closes all active connections.\n     * Returns a resolved promise for API compatibility.\n     * @return {$.Promise} A resolved promise\n     */\n    function close() {\n        _close(true);\n        return new $.Deferred().resolve().promise();\n    }\n\n    /**\n     * @private\n     * Displays an error when no HTML file can be found to preview.\n     */\n    function _showWrongDocError() {\n        Dialogs.showModalDialog(\n            DefaultDialogs.DIALOG_ID_ERROR,\n            Strings.LIVE_DEVELOPMENT_ERROR_TITLE,\n            Strings.LIVE_DEV_NEED_HTML_MESSAGE\n        );\n    }\n\n    /**\n     * @private\n     * Displays an error when the server for live development files can't be started.\n     */\n    function _showLiveDevServerNotReadyError() {\n        Dialogs.showModalDialog(\n            DefaultDialogs.DIALOG_ID_ERROR,\n            Strings.LIVE_DEVELOPMENT_ERROR_TITLE,\n            Strings.LIVE_DEV_SERVER_NOT_READY_MESSAGE\n        );\n    }\n\n    /**\n     * @private\n     * Creates the main live document for a given HTML document and notifies the server it exists.\n     * TODO: we should really maintain the list of live documents, not the server.\n     * @param {Document} doc\n     */\n    function _createLiveDocumentForFrame(doc) {\n        // create live document\n        doc._ensureMasterEditor();\n        _liveDocument = _createLiveDocument(doc, doc._masterEditor);\n        _server.add(_liveDocument);\n    }\n\n\n     /**\n     * Launches the given URL in the default browser.\n     * @param {string} url\n     * TODO: launchers for multiple browsers\n     */\n    function _launch(url) {\n        // open default browser\n        // TODO: fail?\n        //\n        _launcher.launch(url);\n    }\n\n    /**\n     * @private\n     * Launches the given document in the browser, given that a live document has already\n     * been created for it.\n     * @param {Document} doc\n     */\n    function _open(doc) {\n        if (doc && _liveDocument && doc === _liveDocument.doc) {\n            if (_server) {\n                // Launch the URL in the browser. If it's the first one to connect back to us,\n                // our status will transition to ACTIVE once it does so.\n                if (exports.status < STATUS_ACTIVE) {\n                    _launch(_server.pathToUrl(doc.file.fullPath));\n                }\n                if (exports.status === STATUS_RESTARTING) {\n                    // change page in browser\n                    _protocol.navigate(_server.pathToUrl(doc.file.fullPath));\n                }\n\n                _protocol\n                    // TODO: timeout if we don't get a connection within a certain time\n                    .on(\"ConnectionConnect.livedev\", function (event, msg) {\n                        // check for the first connection\n                        if (_protocol.getConnectionIds().length === 1) {\n                            // check the page that connection comes from matches the current live document session\n                            if (_liveDocument && (msg.url === _resolveUrl(_liveDocument.doc.file.fullPath))) {\n                                _setStatus(STATUS_ACTIVE);\n                            }\n                        }\n                    })\n                    .on(\"ConnectionClose.livedev\", function (event, msg) {\n                        // close session when the last connection was closed\n                        if (_protocol.getConnectionIds().length === 0) {\n                            setTimeout(function () {\n                                if (_protocol.getConnectionIds().length === 0 &&\n                                        exports.status <= STATUS_ACTIVE) {\n                                    _close(false, \"detached_target_closed\");\n                                }\n                            }, 5000);\n                        }\n                    })\n                    // extract stylesheets and create related LiveCSSDocument instances\n                    .on(\"DocumentRelated.livedev\", function (event, msg) {\n                        var relatedDocs = msg.related;\n                        var docs = Object.keys(relatedDocs.stylesheets);\n                        docs.forEach(function (url) {\n                            _styleSheetAdded(null, url, relatedDocs.stylesheets[url]);\n                        });\n                    })\n                    // create new LiveCSSDocument if a new stylesheet is added\n                    .on(\"StylesheetAdded.livedev\", function (event, msg) {\n                        _styleSheetAdded(null, msg.href, msg.roots);\n                    })\n                    // remove LiveCSSDocument instance when stylesheet is removed\n                    .on(\"StylesheetRemoved.livedev\", function (event, msg) {\n                        _handleRelatedDocumentDeleted(msg.href);\n                    });\n            } else {\n                console.error(\"LiveDevelopment._open(): No server active\");\n            }\n        } else {\n            // Unlikely that we would get to this state where\n            // a connection is in process but there is no current\n            // document\n            close();\n        }\n    }\n\n    /**\n     * @private\n     * Creates the live document in preparation for launching the\n     * preview of the given document, then launches it. (The live document\n     * must already exist before we launch it so that the server can\n     * ask it for the instrumented version of the document when the browser\n     * requests it.)\n     * TODO: could probably just consolidate this with _open()\n     * @param {Document} doc\n     */\n    function _doLaunchAfterServerReady(initialDoc) {\n\n        _createLiveDocumentForFrame(initialDoc);\n\n        // start listening for requests\n        _server.start();\n\n        // open browser to the url\n        _open(initialDoc);\n    }\n\n    /**\n     * @private\n     * Create the server in preparation for opening a live preview.\n     * @param {Document} doc The document we want the server for. Different servers handle\n     * different types of project (a static server for when no app server is configured,\n     * vs. a user server when there is an app server set in File > Project Settings).\n     */\n    function _prepareServer(doc) {\n        var deferred = new $.Deferred(),\n            showBaseUrlPrompt = false;\n\n        _server = LiveDevServerManager.getServer(doc.file.fullPath);\n\n        // Optionally prompt for a base URL if no server was found but the\n        // file is a known server file extension\n        showBaseUrlPrompt = !_server && LiveDevelopmentUtils.isServerHtmlFileExt(doc.file.fullPath);\n\n        if (showBaseUrlPrompt) {\n            // Prompt for a base URL\n            PreferencesDialogs.showProjectPreferencesDialog(\"\", Strings.LIVE_DEV_NEED_BASEURL_MESSAGE)\n                .done(function (id) {\n                    if (id === Dialogs.DIALOG_BTN_OK && ProjectManager.getBaseUrl()) {\n                        // If base url is specifed, then re-invoke _prepareServer() to continue\n                        _prepareServer(doc).then(deferred.resolve, deferred.reject);\n                    } else {\n                        deferred.reject();\n                    }\n                });\n        } else if (_server) {\n            // Startup the server\n            var readyPromise = _server.readyToServe();\n            if (!readyPromise) {\n                _showLiveDevServerNotReadyError();\n                deferred.reject();\n            } else {\n                readyPromise.then(deferred.resolve, function () {\n                    _showLiveDevServerNotReadyError();\n                    deferred.reject();\n                });\n            }\n        } else {\n            // No server found\n            deferred.reject();\n        }\n\n        return deferred.promise();\n    }\n\n    /**\n     * @private\n     * MainViewManager.currentFileChange event handler.\n     * When switching documents, close the current preview and open a new one.\n     */\n    function _onFileChange() {\n        var doc = DocumentManager.getCurrentDocument();\n        if (!isActive() || !doc) {\n            return;\n        }\n\n        // close the current session and begin a new session\n        var docUrl = _server && _server.pathToUrl(doc.file.fullPath),\n            isViewable = _server && _server.canServe(doc.file.fullPath);\n\n        if (_liveDocument.doc.url !== docUrl && isViewable) {\n            // clear live doc and related docs\n            _closeDocuments();\n            // create new live doc\n            _createLiveDocumentForFrame(doc);\n            _setStatus(STATUS_RESTARTING);\n            _open(doc);\n\n        }\n    }\n\n\n    /**\n     * Open a live preview on the current docuemnt.\n     */\n    function open() {\n        // TODO: need to run _onDocumentChange() after load if doc != currentDocument here? Maybe not, since activeEditorChange\n        // doesn't trigger it, while inline editors can still cause edits in doc other than currentDoc...\n        _getInitialDocFromCurrent().done(function (doc) {\n            var prepareServerPromise = (doc && _prepareServer(doc)) || new $.Deferred().reject(),\n                otherDocumentsInWorkingFiles;\n\n            if (doc && !doc._masterEditor) {\n                otherDocumentsInWorkingFiles = MainViewManager.getWorkingSetSize(MainViewManager.ALL_PANES);\n                MainViewManager.addToWorkingSet(MainViewManager.ACTIVE_PANE, doc.file);\n\n                if (!otherDocumentsInWorkingFiles) {\n                    CommandManager.execute(Commands.CMD_OPEN, { fullPath: doc.file.fullPath });\n                }\n            }\n\n            // wait for server (StaticServer, Base URL or file:)\n            prepareServerPromise\n                .done(function () {\n                    _setStatus(STATUS_CONNECTING);\n                    _doLaunchAfterServerReady(doc);\n                })\n                .fail(function () {\n                    _showWrongDocError();\n                });\n        });\n    }\n\n    /**\n     * For files that don't support as-you-type live editing, but are loaded by live HTML documents\n     * (e.g. JS files), we want to reload the full document when they're saved.\n     * @param {$.Event} event\n     * @param {Document} doc\n     */\n    function _onDocumentSaved(event, doc) {\n        if (!isActive() || !_server) {\n            return;\n        }\n\n        var absolutePath            = doc.file.fullPath,\n            liveDocument            = absolutePath && _server.get(absolutePath),\n            liveEditingEnabled      = liveDocument && liveDocument.isLiveEditingEnabled  && liveDocument.isLiveEditingEnabled();\n\n        // Skip reload if the saved document has live editing enabled\n        if (liveEditingEnabled) {\n            return;\n        }\n\n        // reload the page if the given document is a JS file related\n        // to the current live document.\n        if (_liveDocument.isRelated(absolutePath)) {\n            if (doc.getLanguage().getId() === \"javascript\") {\n                _setStatus(STATUS_RELOADING);\n                _protocol.reload();\n            }\n        }\n    }\n\n    /**\n     * For files that don't support as-you-type live editing, but are loaded by live HTML documents\n     * (e.g. JS files), we want to show a dirty indicator on the live development icon when they\n     * have unsaved changes, so the user knows s/he needs to save in order to have the page reload.\n     * @param {$.Event} event\n     * @param {Document} doc\n     */\n    function _onDirtyFlagChange(event, doc) {\n        if (!isActive() || !_server) {\n            return;\n        }\n\n        var absolutePath = doc.file.fullPath;\n\n        if (_liveDocument.isRelated(absolutePath)) {\n            // Set status to out of sync if dirty. Otherwise, set it to active status.\n            _setStatus(_docIsOutOfSync(doc) ? STATUS_OUT_OF_SYNC : STATUS_ACTIVE);\n        }\n    }\n\n    /**\n     * Sets the current transport mechanism to be used by the live development protocol\n     * (e.g. socket server, iframe postMessage, etc.)\n     * The low-level transport. Must provide the following methods:\n     *\n     * - start(): Initiates transport (eg. creates Web Socket server).\n     * - send(idOrArray, string): Dispatches the given protocol message (provided as a JSON string) to the given client ID\n     *   or array of client IDs. (See the \"connect\" message for an explanation of client IDs.)\n     * - close(id): Closes the connection to the given client ID.\n     * - getRemoteScript(): Returns a script that should be injected into the page's HTML in order to handle the remote side\n     *   of the transport. Should include the \"<script>\" tags. Should return null if no injection is necessary.\n     *\n     * It must also dispatch the following jQuery events:\n     *\n     * - \"connect\": When a target browser connects back to the transport. Must provide two parameters:\n     *   - clientID - a unique number representing this connection\n     *   - url - the URL of the page in the target browser that's connecting to us\n     * - \"message\": When a message is received by the transport. Must provide two parameters:\n     *   - clientID - the ID of the client sending the message\n     *   - message - the text of the message as a JSON string\n     * - \"close\": When the remote browser closes the connection. Must provide one parameter:\n     *   - clientID - the ID of the client closing the connection\n     *\n     * @param {{launch: function(string), send: function(number|Array.<number>, string), close: function(number), getRemoteScript: function(): ?string}} transport\n     */\n    function setTransport(transport) {\n        _protocol.setTransport(transport);\n    }\n\n    /**\n     * Sets the current browser launcher mechanism to be used by live development\n     * (e.g., default browser, iframe-based browser, etc.)\n     * The launcher must provide the following method:\n     *\n     * - launch(url): Launch the given URL in the appropriate browser.\n     *\n     * @param {{launch: function(string)}} launcher\n     */\n    function setLauncher(launcher) {\n        if (!(launcher && launcher.launch)) {\n            console.log(\"Invalid launcher object: \", launcher, new Error(\"LiveDevMultiBrowser.setLauncher()\"));\n            return;\n        }\n        _launcher = launcher;\n    }\n\n    /**\n     * Initialize the LiveDevelopment module.\n     */\n    function init(config) {\n        exports.config = config;\n        MainViewManager\n            .on(\"currentFileChange\", _onFileChange);\n        DocumentManager\n            .on(\"documentSaved\", _onDocumentSaved)\n            .on(\"dirtyFlagChange\", _onDirtyFlagChange);\n        ProjectManager\n            .on(\"beforeProjectClose beforeAppClose\", close);\n\n        // Default transport for live connection messages - can be changed\n        setTransport(NodeSocketTransport);\n\n        // Default launcher for preview browser - can be changed\n        setLauncher(DefaultLauncher);\n\n        // Initialize exports.status\n        _setStatus(STATUS_INACTIVE);\n    }\n\n    function getLiveDocForEditor(editor) {\n        if (!editor) {\n            return null;\n        }\n        return getLiveDocForPath(editor.document.file.fullPath);\n    }\n\n    /**\n     *  Enable highlighting\n     */\n    function showHighlight() {\n        var doc = getLiveDocForEditor(EditorManager.getActiveEditor());\n\n        if (doc && doc.updateHighlight) {\n            doc.updateHighlight();\n        }\n    }\n\n    /**\n     * Hide any active highlighting\n     */\n    function hideHighlight() {\n        if (_protocol) {\n            _protocol.evaluate(\"_LD.hideHighlight()\");\n        }\n    }\n\n    /**\n     * Redraw highlights\n     */\n    function redrawHighlight() {\n        if (_protocol) {\n            _protocol.evaluate(\"_LD.redrawHighlights()\");\n        }\n    }\n\n    /**\n     * Originally unload and reload agents. It doesn't apply for this new implementation.\n     * @return {jQuery.Promise} Already resolved promise.\n     */\n    function reconnect() {\n        return $.Deferred().resolve();\n    }\n\n    /**\n     * Reload current page in all connected browsers.\n     */\n    function reload() {\n        if (_protocol) {\n            _protocol.reload();\n        }\n    }\n\n    /**\n     * Returns current project server config. Copied from original LiveDevelopment.\n     */\n    function getCurrentProjectServerConfig() {\n        return {\n            baseUrl: ProjectManager.getBaseUrl(),\n            pathResolver: ProjectManager.makeProjectRelativeIfPossible,\n            root: ProjectManager.getProjectRoot().fullPath\n        };\n    }\n\n    /**\n     * @private\n     * Returns the base URL of the current server serving the active live document, or null if\n     * there is no active live document.\n     * @return {?string}\n     */\n    function getServerBaseUrl() {\n        return _server && _server.getBaseUrl();\n    }\n\n    // for unit testing only\n    function _getCurrentLiveDoc() {\n        return _liveDocument;\n    }\n\n    EventDispatcher.makeEventDispatcher(exports);\n\n    // For unit testing\n    exports._server                   = _server;\n    exports._getCurrentLiveDoc        = _getCurrentLiveDoc;\n    exports._getInitialDocFromCurrent = _getInitialDocFromCurrent;\n\n    // Export public functions\n    exports.open                = open;\n    exports.close               = close;\n    exports.reconnect           = reconnect;\n    exports.reload              = reload;\n    exports.getLiveDocForPath   = getLiveDocForPath;\n    exports.showHighlight       = showHighlight;\n    exports.hideHighlight       = hideHighlight;\n    exports.redrawHighlight     = redrawHighlight;\n    exports.init                = init;\n    exports.isActive            = isActive;\n    exports.getServerBaseUrl    = getServerBaseUrl;\n    exports.getCurrentProjectServerConfig = getCurrentProjectServerConfig;\n    exports.setTransport        = setTransport;\n    exports.setLauncher         = setLauncher;\n});\n"],"file":"LiveDevMultiBrowser.js"}