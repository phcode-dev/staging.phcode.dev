define(function DOMHelpersModule(require,exports,module){function _isQuote(c,escape,quote){return"\\"!==escape&&(void 0!==quote?c===quote:'"'===c||"'"===c)}function _removeQuotes(src){if(_isQuote(src[0])&&src[src.length-1]===src[0]){var q=src[0];src=(src=src.substr(1,src.length-2)).replace("\\"+q,q)}return src}function _find(src,match,skip,quotes,comments){"string"==typeof match&&(match=[match,match.length]),void 0===skip&&(skip=0);var i,activeQuote,isComment=!1;for(i=skip;i<src.length;i++)if(quotes&&_isQuote(src[i],src[i-1],activeQuote))activeQuote=activeQuote?void 0:src[i];else if(!activeQuote)if(comments&&!isComment&&src.substr(i,comments[0].length)===comments[0])isComment=!0,i+=comments[0].length-1;else if(isComment)src.substr(i,comments[1].length)===comments[1]&&(isComment=!1,i+=comments[1].length-1);else if(0===src.substr(i,match[1]).search(match[0]))return i;return-1}function _findEach(src,match,quotes,comments,callback){for(var from=0,to;from<src.length;)(to=_find(src,match,from,quotes,comments))<0&&(to=src.length),callback(src.substr(from,to-from)),from=to+1}function _findTag(src,skip){var from,to,inc;return(from=_find(src,[/<[a-z!\/]/i,2],skip))<0?null:("\x3c!--"===src.substr(from,4)?(to=_find(src,"--\x3e",from+4),inc=3):"<script"===src.substr(from,7).toLowerCase()?(to=_find(src.toLowerCase(),"<\/script>",from+7),inc=9):"<style"===src.substr(from,6).toLowerCase()?(to=_find(src.toLowerCase(),"</style>",from+6),inc=8):(to=_find(src,">",from+1,!0),inc=1),to<0?null:{from:from,length:to+inc-from})}function _extractAttributes(content){if(0!==(content=(content=content.replace(/^<\S+\s*/,"")).replace(/\s*\/?>$/,"")).length){var index,key,value,attributes={};return _findEach(content,[/\s/,1],!0,void 0,function each(item){(index=item.search("="))<0||0!==(key=item.substr(0,index).trim()).length&&(value=_removeQuotes(value=item.substr(index+1).trim()),attributes[key]=value)}),attributes}}function extractPayload(content){var payload={};return"<"!==content[0]?(payload.nodeType=3,payload.nodeValue=content):"\x3c!--"===content.substr(0,4)?(payload.nodeType=8,payload.nodeValue=content.substr(4,content.length-7)):"!"===content[1]?payload.nodeType=10:(payload.nodeType=1,payload.nodeName=/^<([^>\s]+)/.exec(content)[1].toUpperCase(),payload.attributes=_extractAttributes(content),"/"===payload.nodeName[0]&&(payload.nodeName=payload.nodeName.substr(1),payload.closing=!0),"/"===content[content.length-2]&&(payload.closed=!0),"SCRIPT"!==payload.nodeName&&"STYLE"!==payload.nodeName||(payload.closed=!0)),payload}function eachNode(src,callback){for(var index=0,text,range,length,payload;index<src.length;)(range=_findTag(src,index))||(range={from:src.length,length:0}),(length=range.from-index)>0&&(text=src.substr(index,length),/\S/.test(text)&&((payload=extractPayload(text)).sourceOffset=index,payload.sourceLength=length,callback(payload))),range.length>0&&((payload=extractPayload(src.substr(range.from,range.length))).sourceOffset=range.from,payload.sourceLength=range.length,callback(payload)),index=range.from+range.length}exports.extractPayload=extractPayload,exports.eachNode=eachNode});
//# sourceMappingURL=DOMHelpers.js.map
