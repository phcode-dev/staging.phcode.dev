define(function JSDocumentModule(require,exports,module){var EventDispatcher=require("utils/EventDispatcher"),Inspector=require("LiveDevelopment/Inspector/Inspector"),ScriptAgent=require("LiveDevelopment/Agents/ScriptAgent"),HighlightAgent=require("LiveDevelopment/Agents/HighlightAgent"),JSDocument=function JSDocument(doc,editor){editor&&(this.doc=doc,this.editor=editor,this.onHighlight=this.onHighlight.bind(this),this.onChange=this.onChange.bind(this),this.onCursorActivity=this.onCursorActivity.bind(this),HighlightAgent.on("highlight",this.onHighlight),this.editor.on("change",this.onChange),this.editor.on("cursorActivity",this.onCursorActivity),this.onCursorActivity())};EventDispatcher.makeEventDispatcher(JSDocument.prototype),JSDocument.prototype.close=function close(){this.editor&&(HighlightAgent.off("highlight",this.onHighlight),this.editor.off("change",this.onChange),this.editor.off("cursorActivity",this.onCursorActivity),this.onHighlight())},JSDocument.prototype.script=function script(){return ScriptAgent.scriptForURL(this.doc.url)},JSDocument.prototype.onCursorActivity=function onCursorActivity(event,editor){},JSDocument.prototype.onChange=function onChange(event,editor,change){var src=this.doc.getText();Inspector.Debugger.setScriptSource(this.script().scriptId,src,function onSetScriptSource(res){Inspector.Runtime.evaluate('if($)$("canvas").each(function(i,e){if(e.rerender)e.rerender()})')}.bind(this))},JSDocument.prototype.onHighlight=function onHighlight(event,node){var codeMirror=this.editor._codeMirror,i;for(i in this._highlight)codeMirror.removeLineClass(this._highlight[i],"wrap","highlight");if(this._highlight=[],node&&node.trace){var scriptId=this.script().scriptId,callFrame,line;for(i in node.trace)(callFrame=node.trace[i]).location&&callFrame.location.scriptId===scriptId&&(line=callFrame.location.lineNumber,codeMirror.addLineClass(line,"wrap","highlight"),this._highlight.push(line))}},module.exports=JSDocument});
//# sourceMappingURL=JSDocument.js.map
