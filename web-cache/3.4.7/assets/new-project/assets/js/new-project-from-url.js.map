{"version":3,"sources":["assets/new-project/assets/js/new-project-from-url.js"],"names":["createProjectBtn","locationInput","projectNameInput","createProjectWithNameBtn","urlSearchParams","URLSearchParams","window","location","search","params","Object","fromEntries","entries","PARAM_SUGGESTED_NAME","suggestedName","PARAM_SUGGESTED_TITLE","title","Strings","CMD_PROJECT_NEW","PARAM_SUGGESTED_URL","url","FLATTEN_ZIP_FIRST_LEVEL_DIR","flattenZipFirstLevel","LICENSE","license","LICENSE_URL","licenseURL","CREDITS","credits","CREDITS_URL","creditsURL","PREVIEW_URL","previewURL","BACK_URL","backURL","_validateProjectLocation","showDirectoryPicker","$","document","getElementById","addClass","value","PLEASE_SELECT_A_FOLDER","removeClass","async","_validateSuggestedName","newProjectExtension","alreadyExists","_selectFolder","showFolderSelect","then","file","fullPath","replace","getMountDir","_createProjectClicked","downloadAndOpenProject","Metrics","countEvent","EVENT_TYPE","NEW_PROJECT","closeDialogue","showErrorDialogue","MISSING_FIELDS","PLEASE_FILL_ALL_REQUIRED","_showLicensingInfo","el","textContent","href","attr","_showPreview","src","_setupNavigation","initNewProjectFromURL","onclick","keyup"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*global newProjectExtension, Strings, Metrics*/\n/*eslint no-console: 0*/\n/*eslint strict: [\"error\", \"global\"]*/\n/* jshint ignore:start */\n\nlet createProjectBtn, locationInput, projectNameInput, createProjectWithNameBtn;\n\nconst urlSearchParams = new URLSearchParams(window.location.search);\nconst params = Object.fromEntries(urlSearchParams.entries());\nconst PARAM_SUGGESTED_NAME = params.suggestedName || \"project\";\nconst PARAM_SUGGESTED_TITLE = params.title || Strings.CMD_PROJECT_NEW;\nconst PARAM_SUGGESTED_URL = params.url;\nconst FLATTEN_ZIP_FIRST_LEVEL_DIR = (params.flattenZipFirstLevel ==='true');\nconst LICENSE = params.license;\nconst LICENSE_URL = params.licenseURL;\nconst CREDITS = params.credits;\nconst CREDITS_URL = params.creditsURL;\nconst PREVIEW_URL = params.previewURL;\nconst BACK_URL = params.backURL;\n\nfunction _validateProjectLocation() {\n    if(!window.showDirectoryPicker){ // fs access apis not present\n        $(document.getElementById(\"projectLocation\")).addClass(\"forced-hidden\");\n        return true;\n    }\n    let location = locationInput.value;\n    if( location === Strings.PLEASE_SELECT_A_FOLDER){\n        $(locationInput).addClass(\"error-border\");\n        return false;\n    }\n    $(locationInput).removeClass(\"error-border\");\n    return true;\n}\n\nasync function _validateSuggestedName() {\n    let suggestedName = projectNameInput.value;\n    if(await newProjectExtension.alreadyExists(suggestedName)){\n        $(projectNameInput).addClass(\"error-border\");\n        return;\n    }\n    $(projectNameInput).removeClass(\"error-border\");\n}\n\nfunction _selectFolder() {\n    newProjectExtension.showFolderSelect()\n        .then(file =>{\n            locationInput.fullPath = file;\n            locationInput.value = file.replace(newProjectExtension.getMountDir(), \"\");\n            _validateProjectLocation();\n        });\n}\n\nfunction _createProjectClicked() {\n    if(_validateProjectLocation()){\n        newProjectExtension.downloadAndOpenProject(\n            PARAM_SUGGESTED_URL,\n            locationInput.fullPath, PARAM_SUGGESTED_NAME, FLATTEN_ZIP_FIRST_LEVEL_DIR)\n            .then(()=>{\n                Metrics.countEvent(Metrics.EVENT_TYPE.NEW_PROJECT, \"createProject.Click\", \"create.success\");\n                newProjectExtension.closeDialogue();\n            });\n    } else {\n        newProjectExtension.showErrorDialogue(\n            Strings.MISSING_FIELDS,\n            Strings.PLEASE_FILL_ALL_REQUIRED);\n    }\n    Metrics.countEvent(Metrics.EVENT_TYPE.NEW_PROJECT, \"createProject.Click\", \"create\");\n}\n\nfunction _showLicensingInfo() {\n    if(LICENSE || LICENSE_URL){\n        $(document.getElementById(\"License\")).removeClass(\"forced-hidden\");\n        let el = document.getElementById(\"licenseLink\");\n        el.textContent = LICENSE || LICENSE_URL;\n        let licenseURL = LICENSE_URL || '#';\n        el.href = licenseURL;\n        if(licenseURL === '#'){\n            $(el).attr('target', '');\n        }\n    }\n    if(CREDITS || CREDITS_URL){\n        $(document.getElementById(\"Credits\")).removeClass(\"forced-hidden\");\n        let el = document.getElementById(\"creditsLink\");\n        el.textContent = CREDITS || CREDITS_URL;\n        let creditsURL = CREDITS_URL || '#';\n        el.href = creditsURL;\n        if(creditsURL === '#'){\n            $(el).attr('target', '');\n        }\n    }\n}\n\nfunction _showPreview() {\n    if(!PREVIEW_URL){\n        return;\n    }\n    $(document.getElementById(\"previewBox\")).removeClass(\"forced-hidden\");\n    document.getElementById(\"bigFrame\").src = PREVIEW_URL;\n    document.getElementById(\"littleFrame\").src = PREVIEW_URL;\n}\n\nfunction _setupNavigation() {\n    if(BACK_URL){\n        document.getElementById(\"backButton\").href = BACK_URL;\n    }\n}\n\nfunction initNewProjectFromURL() {\n    _setupNavigation();\n    if(!window.showDirectoryPicker){ // fs access apis not present\n        $(document.getElementById(\"projectLocation\")).addClass(\"forced-hidden\");\n    } else {\n        $(document.getElementById(\"projectName\")).addClass(\"forced-hidden\");\n    }\n    document.getElementById(\"titleNewProject\").textContent = PARAM_SUGGESTED_TITLE;\n    projectNameInput = document.getElementById(\"projectNameInput\");\n    locationInput = document.getElementById(\"locationInput\");\n    createProjectBtn = document.getElementById(\"createProjectBtn\");\n    createProjectWithNameBtn = document.getElementById(\"createProjectWithNameBtn\");\n    createProjectBtn.onclick = _createProjectClicked;\n    createProjectWithNameBtn.onclick = _createProjectClicked;\n    $(projectNameInput).keyup(_validateSuggestedName);\n    locationInput.value = Strings.PLEASE_SELECT_A_FOLDER;\n    projectNameInput.value = PARAM_SUGGESTED_NAME;\n    locationInput.onclick = _selectFolder;\n    _showLicensingInfo();\n    _showPreview();\n    _validateProjectLocation();\n    _validateSuggestedName();\n}\n"],"file":"new-project-from-url.js"}