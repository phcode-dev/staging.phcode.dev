define(function(require,exports,module){let _=require("thirdparty/lodash"),Mustache=require("thirdparty/mustache/mustache"),Dialogs=require("widgets/Dialogs"),Strings=require("strings"),ViewCommandHandlers=require("view/ViewCommandHandlers"),settingsTemplate=require("text!htmlContent/themes-settings.html"),PreferencesManager,prefs=require("preferences/PreferencesManager").getExtensionPrefs("themes"),loadedThemes={};const SYSTEM_DEFAULT_THEME="system-default",DEFAULTS={themeScrollbars:!0,theme:SYSTEM_DEFAULT_THEME,lightTheme:"light-theme",darkTheme:"dark-theme"};var $settings=$(settingsTemplate).addClass("themeSettings");function getValues(){var result={};return Object.keys(DEFAULTS).forEach(function(key){result[key]=prefs.get(key)}),result.fontFamily=ViewCommandHandlers.getFontFamily(),result.fontSize=ViewCommandHandlers.getFontSize(),result.validFontSizeRegExp=ViewCommandHandlers.validFontSizeRegExp,result}function showDialog(){const currentSettings=getValues(),newSettings={},themes=_.map(loadedThemes,function(theme){return theme});themes.unshift({displayName:Strings.SYSTEM_DEFAULT,name:SYSTEM_DEFAULT_THEME});const template=$("<div>").append($settings).html(),$template=$(Mustache.render(template,{settings:currentSettings,themes:themes,Strings:Strings}));var $currentThemeOption=$template.find("[value='"+currentSettings.theme+"']");0===$currentThemeOption.length&&($currentThemeOption=$template.find("[value='"+DEFAULTS.theme+"']")),$currentThemeOption.attr("selected","selected"),$template.find("[data-toggle=tab].default").tab("show"),$template.on("change","[data-target]:checkbox",function(){var $target=$(this),attr=$target.attr("data-target");newSettings[attr]=$target.is(":checked")}).on("input","[data-target='fontSize']",function(){var target=this,targetValue=$(this).val(),$btn=$("#theme-settings-done-btn")[0];!0===this.checkValidity()?($btn.disabled=!1,newSettings.fontSize=targetValue):$btn.disabled=!0}).on("input","[data-target='fontFamily']",function(){var targetValue=$(this).val();newSettings.fontFamily=targetValue}).on("change","select",function(){var $target=$(":selected",this),attr=$target.attr("data-target");attr&&prefs.set(attr,$target.val())}),Dialogs.showModalDialogUsingTemplate($template).done(function(id){var setterFn;"save"===id?Object.keys(newSettings).forEach(function(setting){DEFAULTS.hasOwnProperty(setting)?prefs.set(setting,newSettings[setting]):(setterFn="set"+setting[0].toLocaleUpperCase()+setting.substr(1),"function"==typeof ViewCommandHandlers[setterFn]&&ViewCommandHandlers[setterFn](newSettings[setting]))}):"cancel"===id&&prefs.set("theme",currentSettings.theme)})}function setThemes(themes){loadedThemes=themes}function restore(){prefs.set("theme",DEFAULTS.theme),prefs.set("themeScrollbars",DEFAULTS.themeScrollbars)}prefs.definePreference("theme","string",DEFAULTS.theme,{description:Strings.DESCRIPTION_THEME}),prefs.definePreference("themeScrollbars","boolean",DEFAULTS.themeScrollbars,{description:Strings.DESCRIPTION_USE_THEME_SCROLLBARS}),exports.DEFAULTS=DEFAULTS,exports._setThemes=setThemes,exports.restore=restore,exports.showDialog=showDialog});
//# sourceMappingURL=ThemeSettings.js.map
