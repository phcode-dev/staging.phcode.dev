{"version":3,"sources":["thirdparty/CodeMirror/addon/edit/closebrackets.js"],"names":["mod","exports","module","require","define","amd","CodeMirror","defaults","pairs","closeBefore","triples","explode","Pos","getOption","conf","name","defineOption","cm","val","old","Init","removeKeyMap","keyMap","state","closeBrackets","ensureBound","addKeyMap","Backspace","handleBackspace","Enter","handleEnter","chars","i","length","ch","charAt","key","handler","handleChar","getConfig","deflt","mode","override","getModeAt","getCursor","Pass","ranges","listSelections","empty","around","charsAround","head","indexOf","cur","replaceRange","line","operation","linesep","lineSeparator","replaceSelection","moveSel","indentLine","dir","newRanges","primary","range","pos","push","anchor","setSelections","contractSelection","sel","inverted","cmpPos","identical","opening","type","curType","next","getRange","test","getTokenTypeAt","prev","isWordChar","stringStartsAfter","left","right","sels","getSelections","replaceSelections","slice","triggerElectric","str","token","getTokenAt","start"],"mappings":"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","sourcesContent":["// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: https://codemirror.net/5/LICENSE\n\n(function(mod) {\n  if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n    mod(require(\"../../lib/codemirror\"));\n  else if (typeof define == \"function\" && define.amd) // AMD\n    define([\"../../lib/codemirror\"], mod);\n  else // Plain browser env\n    mod(CodeMirror);\n})(function(CodeMirror) {\n  var defaults = {\n    pairs: \"()[]{}''\\\"\\\"\",\n    closeBefore: \")]}'\\\":;>\",\n    triples: \"\",\n    explode: \"[]{}\"\n  };\n\n  var Pos = CodeMirror.Pos;\n\n  CodeMirror.defineOption(\"autoCloseBrackets\", false, function(cm, val, old) {\n    if (old && old != CodeMirror.Init) {\n      cm.removeKeyMap(keyMap);\n      cm.state.closeBrackets = null;\n    }\n    if (val) {\n      ensureBound(getOption(val, \"pairs\"))\n      cm.state.closeBrackets = val;\n      cm.addKeyMap(keyMap);\n    }\n  });\n\n  function getOption(conf, name) {\n    if (name == \"pairs\" && typeof conf == \"string\") return conf;\n    if (typeof conf == \"object\" && conf[name] != null) return conf[name];\n    return defaults[name];\n  }\n\n  var keyMap = {Backspace: handleBackspace, Enter: handleEnter};\n  function ensureBound(chars) {\n    for (var i = 0; i < chars.length; i++) {\n      var ch = chars.charAt(i), key = \"'\" + ch + \"'\"\n      if (!keyMap[key]) keyMap[key] = handler(ch)\n    }\n  }\n  ensureBound(defaults.pairs + \"`\")\n\n  function handler(ch) {\n    return function(cm) { return handleChar(cm, ch); };\n  }\n\n  function getConfig(cm) {\n    var deflt = cm.state.closeBrackets;\n    if (!deflt || deflt.override) return deflt;\n    var mode = cm.getModeAt(cm.getCursor());\n    return mode.closeBrackets || deflt;\n  }\n\n  function handleBackspace(cm) {\n    var conf = getConfig(cm);\n    if (!conf || cm.getOption(\"disableInput\")) return CodeMirror.Pass;\n\n    var pairs = getOption(conf, \"pairs\");\n    var ranges = cm.listSelections();\n    for (var i = 0; i < ranges.length; i++) {\n      if (!ranges[i].empty()) return CodeMirror.Pass;\n      var around = charsAround(cm, ranges[i].head);\n      if (!around || pairs.indexOf(around) % 2 != 0) return CodeMirror.Pass;\n    }\n    for (var i = ranges.length - 1; i >= 0; i--) {\n      var cur = ranges[i].head;\n      cm.replaceRange(\"\", Pos(cur.line, cur.ch - 1), Pos(cur.line, cur.ch + 1), \"+delete\");\n    }\n  }\n\n  function handleEnter(cm) {\n    var conf = getConfig(cm);\n    var explode = conf && getOption(conf, \"explode\");\n    if (!explode || cm.getOption(\"disableInput\")) return CodeMirror.Pass;\n\n    var ranges = cm.listSelections();\n    for (var i = 0; i < ranges.length; i++) {\n      if (!ranges[i].empty()) return CodeMirror.Pass;\n      var around = charsAround(cm, ranges[i].head);\n      if (!around || explode.indexOf(around) % 2 != 0) return CodeMirror.Pass;\n    }\n    cm.operation(function() {\n      var linesep = cm.lineSeparator() || \"\\n\";\n      cm.replaceSelection(linesep + linesep, null);\n      moveSel(cm, -1)\n      ranges = cm.listSelections();\n      for (var i = 0; i < ranges.length; i++) {\n        var line = ranges[i].head.line;\n        cm.indentLine(line, null, true);\n        cm.indentLine(line + 1, null, true);\n      }\n    });\n  }\n\n  function moveSel(cm, dir) {\n    var newRanges = [], ranges = cm.listSelections(), primary = 0\n    for (var i = 0; i < ranges.length; i++) {\n      var range = ranges[i]\n      if (range.head == cm.getCursor()) primary = i\n      var pos = range.head.ch || dir > 0 ? {line: range.head.line, ch: range.head.ch + dir} : {line: range.head.line - 1}\n      newRanges.push({anchor: pos, head: pos})\n    }\n    cm.setSelections(newRanges, primary)\n  }\n\n  function contractSelection(sel) {\n    var inverted = CodeMirror.cmpPos(sel.anchor, sel.head) > 0;\n    return {anchor: new Pos(sel.anchor.line, sel.anchor.ch + (inverted ? -1 : 1)),\n            head: new Pos(sel.head.line, sel.head.ch + (inverted ? 1 : -1))};\n  }\n\n  function handleChar(cm, ch) {\n    var conf = getConfig(cm);\n    if (!conf || cm.getOption(\"disableInput\")) return CodeMirror.Pass;\n\n    var pairs = getOption(conf, \"pairs\");\n    var pos = pairs.indexOf(ch);\n    if (pos == -1) return CodeMirror.Pass;\n\n    var closeBefore = getOption(conf,\"closeBefore\");\n\n    var triples = getOption(conf, \"triples\");\n\n    var identical = pairs.charAt(pos + 1) == ch;\n    var ranges = cm.listSelections();\n    var opening = pos % 2 == 0;\n\n    var type;\n    for (var i = 0; i < ranges.length; i++) {\n      var range = ranges[i], cur = range.head, curType;\n      var next = cm.getRange(cur, Pos(cur.line, cur.ch + 1));\n      if (opening && !range.empty()) {\n        curType = \"surround\";\n      } else if ((identical || !opening) && next == ch) {\n        if (identical && stringStartsAfter(cm, cur))\n          curType = \"both\";\n        else if (triples.indexOf(ch) >= 0 && cm.getRange(cur, Pos(cur.line, cur.ch + 3)) == ch + ch + ch)\n          curType = \"skipThree\";\n        else\n          curType = \"skip\";\n      } else if (identical && cur.ch > 1 && triples.indexOf(ch) >= 0 &&\n                 cm.getRange(Pos(cur.line, cur.ch - 2), cur) == ch + ch) {\n        if (cur.ch > 2 && /\\bstring/.test(cm.getTokenTypeAt(Pos(cur.line, cur.ch - 2)))) return CodeMirror.Pass;\n        curType = \"addFour\";\n      } else if (identical) {\n        var prev = cur.ch == 0 ? \" \" : cm.getRange(Pos(cur.line, cur.ch - 1), cur)\n        if (!CodeMirror.isWordChar(next) && prev != ch && !CodeMirror.isWordChar(prev)) curType = \"both\";\n        else return CodeMirror.Pass;\n      } else if (opening && (next.length === 0 || /\\s/.test(next) || closeBefore.indexOf(next) > -1)) {\n        curType = \"both\";\n      } else {\n        return CodeMirror.Pass;\n      }\n      if (!type) type = curType;\n      else if (type != curType) return CodeMirror.Pass;\n    }\n\n    var left = pos % 2 ? pairs.charAt(pos - 1) : ch;\n    var right = pos % 2 ? ch : pairs.charAt(pos + 1);\n    cm.operation(function() {\n      if (type == \"skip\") {\n        moveSel(cm, 1)\n      } else if (type == \"skipThree\") {\n        moveSel(cm, 3)\n      } else if (type == \"surround\") {\n        var sels = cm.getSelections();\n        for (var i = 0; i < sels.length; i++)\n          sels[i] = left + sels[i] + right;\n        cm.replaceSelections(sels, \"around\");\n        sels = cm.listSelections().slice();\n        for (var i = 0; i < sels.length; i++)\n          sels[i] = contractSelection(sels[i]);\n        cm.setSelections(sels);\n      } else if (type == \"both\") {\n        cm.replaceSelection(left + right, null);\n        cm.triggerElectric(left + right);\n        moveSel(cm, -1)\n      } else if (type == \"addFour\") {\n        cm.replaceSelection(left + left + left + left, \"before\");\n        moveSel(cm, 1)\n      }\n    });\n  }\n\n  function charsAround(cm, pos) {\n    var str = cm.getRange(Pos(pos.line, pos.ch - 1),\n                          Pos(pos.line, pos.ch + 1));\n    return str.length == 2 ? str : null;\n  }\n\n  function stringStartsAfter(cm, pos) {\n    var token = cm.getTokenAt(Pos(pos.line, pos.ch + 1))\n    return /\\bstring/.test(token.type) && token.start == pos.ch &&\n      (pos.ch == 0 || !/\\bstring/.test(cm.getTokenTypeAt(pos)))\n  }\n});\n"],"file":"closebrackets.js"}