{"version":3,"sources":["features/JumpToDefManager.js"],"names":["define","require","exports","module","Commands","Strings","AppInit","CommandManager","EditorManager","Editor","ProviderRegistrationHandler","RegistrationHandler","JUMP_TO_DEF_MARKER","_providerRegistrationHandler","registerJumpToDefProvider","registerProvider","bind","removeJumpToDefProvider","removeProvider","_getJumpToDefProvider","editor","position","jumpToDefProvider","language","getLanguageForSelection","enabledProviders","getProvidersForLanguageId","getId","some","item","index","provider","canJumpToDef","_doJumpToDef","request","result","$","Deferred","getActiveEditor","reject","promise","doJumpToDef","done","resolve","fail","_clearHoverMarkers","hoverMarksPresent","clearAllMarks","_drawHoverMarkers","pos","markToken","MARK_OPTION_HYPERLINK_TEXT","_hoverMarkersOnMouseMove","evt","getHoveredEditor","ctrlKey","metaKey","coordsChar","left","clientX","top","clientY","ch","document","getLine","line","length","appReady","editorHolder","addEventListener","register","CMD_JUMPTO_DEFINITION","NAVIGATE_JUMPTO_DEFINITION"],"mappings":"AAuBAA,OAAO,SAAUC,QAASC,QAASC,QAG/B,MAAMC,SAAWH,QAAQ,oBACrBI,QAAUJ,QAAQ,WAClBK,QAAUL,QAAQ,iBAClBM,eAAiBN,QAAQ,0BACzBO,cAAgBP,QAAQ,wBACxBQ,OAAsBR,QAAQ,iBAAiBQ,OAC/CC,4BAA8BT,QAAQ,sCAAsCU,oBAE1EC,mBAAqB,aAE3B,IAAIC,6BAA+B,IAAIH,4BACnCI,0BAA4BD,6BAA6BE,iBAAiBC,KAAKH,8BAC/EI,wBAA0BJ,6BAA6BK,eAAeF,KAAKH,8BAG/E,SAASM,sBAAsBC,OAAQC,SAAW,MAC9C,IAAIC,kBAAoB,KACpBC,SAAWH,OAAOI,0BAClBC,iBAUJ,OAVuBZ,6BAA6Ba,0BAA0BH,SAASI,SAGtEC,KAAK,SAAUC,KAAMC,OAElC,IAAKD,KAAKE,SAASC,cAAgBH,KAAKE,SAASC,aAAaZ,OAAQC,UAElE,OADAC,kBAAoBO,KAAKE,UAClB,IAGRT,kBAQX,SAASW,eACL,IAAIC,QAAU,KACVC,OAAS,IAAIC,EAAEC,SACfjB,OAASZ,cAAc8B,kBAE3B,IAAKlB,OAED,OADAe,OAAOI,SACAJ,OAAOK,UAGlB,IAAIlB,kBAAoBH,sBAAsBC,QAC9C,OAAKE,oBAILY,QAAUZ,kBAAkBmB,YAAYrB,UAOxCc,QAAQQ,KAAK,WACTP,OAAOQ,YACRC,KAAK,WACJT,OAAOI,WAGJJ,OAAOK,YAhBVL,OAAOI,SACAJ,OAAOK,WAkBtB,SAASK,mBAAmBzB,QACrBA,QAAUA,OAAO0B,oBAChB1B,OAAO2B,cAAcnC,oBACrBQ,OAAO0B,mBAAoB,GAInC,SAASE,kBAAkB5B,OAAQ6B,KAC/B,GAAG7B,OAAO,CAEN,IAAIE,kBADJuB,mBAAmBzB,QACKD,sBAAsBC,OAAQ6B,OAElD7B,OAAO8B,UAAUtC,mBAAoBqC,IAAKxC,OAAO0C,4BACjD/B,OAAO0B,mBAAoB,IAKvC,SAASM,yBAAyBC,KAC9B,IAAIjC,OAASZ,cAAc8C,iBAAiBD,KAE5C,GADAR,mBAAmBzB,QAChBA,SAAWiC,IAAIE,SAAWF,IAAIG,SAAS,CACtC,IAAIP,IAAM7B,OAAOqC,WAAW,CAACC,KAAML,IAAIM,QAASC,IAAKP,IAAIQ,UAEzD,GAAIZ,IAAIa,IAAM1C,OAAO2C,SAASC,QAAQf,IAAIgB,MAAMC,OAC5C,OAEJlB,kBAAkB5B,OAAQ6B,MAIlC3C,QAAQ6D,SAAS,WACb,IAAIC,aAAehC,EAAE,kBAAkB,GACvCgC,aAAaC,iBAAiB,YAAajB,0BAA0B,GACrEgB,aAAaC,iBAAiB,QAASjB,0BAA0B,KAGrE7C,eAAe+D,SAASjE,QAAQkE,sBAAuBnE,SAASoE,2BAA4BvC,cAE5F/B,QAAQY,0BAA4BA,0BACpCZ,QAAQe,wBAA0BA","sourcesContent":["/*\n * Copyright (c) 2019 - present Adobe. All rights reserved.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n *\n */\n\ndefine(function (require, exports, module) {\n\n\n    const Commands = require(\"command/Commands\"),\n        Strings = require(\"strings\"),\n        AppInit = require(\"utils/AppInit\"),\n        CommandManager = require(\"command/CommandManager\"),\n        EditorManager = require(\"editor/EditorManager\"),\n        Editor              = require(\"editor/Editor\").Editor,\n        ProviderRegistrationHandler = require(\"features/PriorityBasedRegistration\").RegistrationHandler;\n\n    const JUMP_TO_DEF_MARKER = \"jumpMarker\";\n\n    let _providerRegistrationHandler = new ProviderRegistrationHandler(),\n        registerJumpToDefProvider = _providerRegistrationHandler.registerProvider.bind(_providerRegistrationHandler),\n        removeJumpToDefProvider = _providerRegistrationHandler.removeProvider.bind(_providerRegistrationHandler);\n\n\n    function _getJumpToDefProvider(editor, position = null) {\n        let jumpToDefProvider = null;\n        let language = editor.getLanguageForSelection(),\n            enabledProviders = _providerRegistrationHandler.getProvidersForLanguageId(language.getId());\n\n\n        enabledProviders.some(function (item, index) {\n            // if canJumpToDef is not provided, we assume that the provicer can jump to definition.\n            if (!item.provider.canJumpToDef || item.provider.canJumpToDef(editor, position)) {\n                jumpToDefProvider = item.provider;\n                return true;\n            }\n        });\n        return jumpToDefProvider;\n    }\n\n    /**\n     * Asynchronously asks providers to handle jump-to-definition.\n     * @return {!Promise} Resolved when the provider signals that it's done; rejected if no\n     * provider responded or the provider that responded failed.\n     */\n    function _doJumpToDef() {\n        let request = null,\n            result = new $.Deferred(),\n            editor = EditorManager.getActiveEditor();\n\n        if (!editor) {\n            result.reject();\n            return result.promise();\n        }\n\n        let jumpToDefProvider = _getJumpToDefProvider(editor);\n        if (!jumpToDefProvider) {\n            result.reject();\n            return result.promise();\n        }\n        request = jumpToDefProvider.doJumpToDef(editor);\n\n        if (!request) {\n            result.reject();\n            return result.promise();\n        }\n\n        request.done(function () {\n            result.resolve();\n        }).fail(function () {\n            result.reject();\n        });\n\n        return result.promise();\n    }\n\n    function _clearHoverMarkers(editor) {\n        if(editor && editor.hoverMarksPresent){\n            editor.clearAllMarks(JUMP_TO_DEF_MARKER);\n            editor.hoverMarksPresent = false;\n        }\n    }\n\n    function _drawHoverMarkers(editor, pos) {\n        if(editor){\n            _clearHoverMarkers(editor);\n            let jumpToDefProvider = _getJumpToDefProvider(editor, pos);\n            if(jumpToDefProvider){\n                editor.markToken(JUMP_TO_DEF_MARKER, pos, Editor.MARK_OPTION_HYPERLINK_TEXT);\n                editor.hoverMarksPresent = true;\n            }\n        }\n    }\n\n    function _hoverMarkersOnMouseMove(evt){\n        let editor = EditorManager.getHoveredEditor(evt);\n        _clearHoverMarkers(editor);\n        if(editor && (evt.ctrlKey || evt.metaKey)){\n            let pos = editor.coordsChar({left: evt.clientX, top: evt.clientY});\n            // No preview if mouse is past last char on line\n            if (pos.ch >= editor.document.getLine(pos.line).length) {\n                return;\n            }\n            _drawHoverMarkers(editor, pos);\n        }\n    }\n\n    AppInit.appReady(function () {\n        let editorHolder = $(\"#editor-holder\")[0];\n        editorHolder.addEventListener(\"mousemove\", _hoverMarkersOnMouseMove, true);\n        editorHolder.addEventListener(\"keyup\", _hoverMarkersOnMouseMove, true);\n    });\n\n    CommandManager.register(Strings.CMD_JUMPTO_DEFINITION, Commands.NAVIGATE_JUMPTO_DEFINITION, _doJumpToDef);\n\n    exports.registerJumpToDefProvider = registerJumpToDefProvider;\n    exports.removeJumpToDefProvider = removeJumpToDefProvider;\n});\n"],"file":"JumpToDefManager.js"}