define(function(require,exports,module){const MAX_AUDIT_ENTRIES=3e3;let initDone=!1,disabled=!1,loggedDataForAudit=new Map;const EVENT_TYPE={PLATFORM:"phoenix.platform",PROJECT:"project",THEMES:"themes",EXTENSIONS:"extensions",UI:"phoenix.UI",UI_DIALOG:"ui-dialog",UI_BOTTOM_PANEL:"ui-bottomPanel",UI_SIDE_PANEL:"ui-sidePanel",LIVE_PREVIEW:"live-preview",CODE_HINTS:"code-hints",EDITOR:"editor",SEARCH:"search",SHARING:"sharing",PERFORMANCE:"performance",NEW_PROJECT:"new-project"};function _createAnalyticsShims(){window.analytics||(window.analytics={_initData:[],loadStartTime:(new Date).getTime(),event:function(){window.analytics._initData.push(arguments)}}),window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)}}function _initGoogleAnalytics(){let script=document.createElement("script");script.type="text/javascript",script.async=!0,script.onload=function(){gtag("js",new Date),gtag("config",brackets.config.googleAnalyticsID,{page_title:"Phoenix editor",page_path:"/index.html",page_location:window.location.origin})},script.src="https://www.googletagmanager.com/gtag/js?"+brackets.config.googleAnalyticsID,document.getElementsByTagName("head")[0].appendChild(script)}function _initMixPanelAnalytics(){window.mixpanel?mixpanel.init(brackets.config.mixPanelID,{debug:window.debugMode}):console.error("Mixpanel not found. MixPanel Analytics will not be initialized.")}function _initCoreAnalytics(){let script=document.createElement("script");script.type="text/javascript",script.async=!0,window.analytics.debugMode=window.debugMode,script.onload=function(){window.initAnalyticsSession(brackets.config.coreAnalyticsID,brackets.config.coreAnalyticsAppName),window.analytics.event("core-analytics","client-lib","loadTime",1,(new Date).getTime()-window.analytics.loadStartTime)},script.src="https://unpkg.com/@aicore/core-analytics-client-lib/dist/analytics.min.js",document.getElementsByTagName("head")[0].appendChild(script)}function init(){initDone||window.testEnvironment||(_initGoogleAnalytics(),_initMixPanelAnalytics(),_initCoreAnalytics(),initDone=!0)}_createAnalyticsShims();const ignoredGAEvents=["instantSearch"];function _sendToGoogleAnalytics(category,action,label,count){if(disabled||window.testEnvironment)return;action=action||"action",label||(label=action),count||(count=1);let eventAct=`${category=category||"category"}.${action}.${label}`;ignoredGAEvents.includes(action)||gtag("event",eventAct,{event_category:category,event_label:label,value:count})}function _sendToMixPanel(category,action,label,count,value){disabled||window.testEnvironment||(category=category||"category",action=action||"action",label||(label=action),count=count||1,value=value||1,window.mixpanel&&mixpanel.track&&mixpanel.track(category,{action:action,label:label,count:count,value:value}))}function _sendToCoreAnalytics(category,action,label,count,value){disabled||window.testEnvironment||(category=category||"category",action=action||"action",label||(label=action),value||(value=1),analytics.event(category,action,label,count,value))}const AUDIT_TYPE_COUNT="count",AUDIT_TYPE_VALUE="val";function _logEventForAudit(eventType,eventCategory,eventSubCategory,val,type){let defaultVal={eventType:type,sum:0,count:0},key=`${eventType}.${eventCategory}.${eventSubCategory}`,newVal=loggedDataForAudit.get(key)||defaultVal;if(newVal.count=newVal.count+1,newVal.sum=newVal.sum+val,loggedDataForAudit.set(key,newVal),loggedDataForAudit.size>=MAX_AUDIT_ENTRIES){const NUM_ENTRIES_TO_DELETE=1e3;let keys;Array.from(loggedDataForAudit.keys()).slice(0,NUM_ENTRIES_TO_DELETE).forEach(k=>loggedDataForAudit.delete(k))}}function countEvent(eventType,eventCategory,eventSubCategory,count=1){_logEventForAudit(eventType,eventCategory,eventSubCategory,count,AUDIT_TYPE_COUNT),_sendToGoogleAnalytics(eventType,eventCategory,eventSubCategory,count),_sendToMixPanel(eventType,eventCategory,eventSubCategory,count),_sendToCoreAnalytics(eventType,eventCategory,eventSubCategory,count)}function valueEvent(eventType,eventCategory,eventSubCategory,value){_logEventForAudit(eventType,eventCategory,eventSubCategory,value,AUDIT_TYPE_VALUE),_sendToGoogleAnalytics(eventType,eventCategory,eventSubCategory,value),_sendToMixPanel(eventType,eventCategory,eventSubCategory,1,value),_sendToCoreAnalytics(eventType,eventCategory,eventSubCategory,1,value)}function setDisabled(shouldDisable){disabled=shouldDisable}function getLoggedDataForAudit(){return loggedDataForAudit}function clearAuditData(){loggedDataForAudit.clear()}exports.init=init,exports.setDisabled=setDisabled,exports.getLoggedDataForAudit=getLoggedDataForAudit,exports.clearAuditData=clearAuditData,exports.countEvent=countEvent,exports.valueEvent=valueEvent,exports.EVENT_TYPE=EVENT_TYPE,exports.AUDIT_TYPE_COUNT=AUDIT_TYPE_COUNT,exports.AUDIT_TYPE_VALUE=AUDIT_TYPE_VALUE});
//# sourceMappingURL=Metrics.js.map
