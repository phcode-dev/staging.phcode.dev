!function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror"),require("../fold/xml-fold")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../fold/xml-fold"],mod):mod(CodeMirror)}(function(CodeMirror){CodeMirror.defineOption("autoCloseTags",!1,function(cm,val,old){if(old!=CodeMirror.Init&&old&&cm.removeKeyMap("autoCloseTags"),val){var map={name:"autoCloseTags"};"object"==typeof val&&!1===val.whenClosing||(map["'/'"]=function(cm){return autoCloseSlash(cm)}),"object"==typeof val&&!1===val.whenOpening||(map["'>'"]=function(cm){return autoCloseGT(cm)}),cm.addKeyMap(map)}});var htmlDontClose=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],htmlIndent=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"];function autoCloseGT(cm){if(cm.getOption("disableInput"))return CodeMirror.Pass;for(var ranges=cm.listSelections(),replacements=[],opt=cm.getOption("autoCloseTags"),i=0;i<ranges.length;i++){if(!ranges[i].empty())return CodeMirror.Pass;var pos=ranges[i].head,tok=cm.getTokenAt(pos),inner=CodeMirror.innerMode(cm.getMode(),tok.state),state=inner.state,tagInfo=inner.mode.xmlCurrentTag&&inner.mode.xmlCurrentTag(state),tagName=tagInfo&&tagInfo.name;if(!tagName)return CodeMirror.Pass;var html="html"==inner.mode.configuration,dontCloseTags="object"==typeof opt&&opt.dontCloseTags||html&&htmlDontClose,indentTags="object"==typeof opt&&opt.indentTags||html&&htmlIndent;tok.end>pos.ch&&(tagName=tagName.slice(0,tagName.length-tok.end+pos.ch));var lowerTagName=tagName.toLowerCase();if(!tagName||"string"==tok.type&&(tok.end!=pos.ch||!/[\"\']/.test(tok.string.charAt(tok.string.length-1))||1==tok.string.length)||"tag"==tok.type&&tagInfo.close||tok.string.indexOf("/")==pos.ch-tok.start-1||dontCloseTags&&indexOf(dontCloseTags,lowerTagName)>-1||closingTagExists(cm,inner.mode.xmlCurrentContext&&inner.mode.xmlCurrentContext(state)||[],tagName,pos,!0))return CodeMirror.Pass;var emptyTags="object"==typeof opt&&opt.emptyTags;if(emptyTags&&indexOf(emptyTags,tagName)>-1)replacements[i]={text:"/>",newPos:CodeMirror.Pos(pos.line,pos.ch+2)};else{var indent=indentTags&&indexOf(indentTags,lowerTagName)>-1;replacements[i]={indent:indent,text:">"+(indent?"\n\n":"")+"</"+tagName+">",newPos:indent?CodeMirror.Pos(pos.line+1,0):CodeMirror.Pos(pos.line,pos.ch+1)}}}for(var dontIndentOnAutoClose="object"==typeof opt&&opt.dontIndentOnAutoClose,i=ranges.length-1;i>=0;i--){var info=replacements[i];cm.replaceRange(info.text,ranges[i].head,ranges[i].anchor,"+insert");var sel=cm.listSelections().slice(0);sel[i]={head:info.newPos,anchor:info.newPos},cm.setSelections(sel),!dontIndentOnAutoClose&&info.indent&&(cm.indentLine(info.newPos.line,null,!0),cm.indentLine(info.newPos.line+1,null,!0))}}function autoCloseCurrent(cm,typingSlash){for(var ranges=cm.listSelections(),replacements=[],head=typingSlash?"/":"</",opt=cm.getOption("autoCloseTags"),dontIndentOnAutoClose="object"==typeof opt&&opt.dontIndentOnSlash,i=0;i<ranges.length;i++){if(!ranges[i].empty())return CodeMirror.Pass;var pos=ranges[i].head,tok=cm.getTokenAt(pos),inner=CodeMirror.innerMode(cm.getMode(),tok.state),state=inner.state;if(typingSlash&&("string"==tok.type||"<"!=tok.string.charAt(0)||tok.start!=pos.ch-1))return CodeMirror.Pass;var replacement,mixed="xml"!=inner.mode.name&&"htmlmixed"==cm.getMode().name;if(mixed&&"javascript"==inner.mode.name)replacement=head+"script";else if(mixed&&"css"==inner.mode.name)replacement=head+"style";else{var context=inner.mode.xmlCurrentContext&&inner.mode.xmlCurrentContext(state),top=context.length?context[context.length-1]:"";if(!context||context.length&&closingTagExists(cm,context,top,pos))return CodeMirror.Pass;replacement=head+top}">"!=cm.getLine(pos.line).charAt(tok.end)&&(replacement+=">"),replacements[i]=replacement}if(cm.replaceSelections(replacements),ranges=cm.listSelections(),!dontIndentOnAutoClose)for(var i=0;i<ranges.length;i++)(i==ranges.length-1||ranges[i].head.line<ranges[i+1].head.line)&&cm.indentLine(ranges[i].head.line)}function autoCloseSlash(cm){return cm.getOption("disableInput")?CodeMirror.Pass:autoCloseCurrent(cm,!0)}function indexOf(collection,elt){if(collection.indexOf)return collection.indexOf(elt);for(var i=0,e=collection.length;i<e;++i)if(collection[i]==elt)return i;return-1}function closingTagExists(cm,context,tagName,pos,newTag){if(!CodeMirror.scanForClosingTag)return!1;var end=Math.min(cm.lastLine()+1,pos.line+500),nextClose=CodeMirror.scanForClosingTag(cm,pos,null,end);if(!nextClose||nextClose.tag!=tagName)return!1;for(var onCx=newTag?1:0,i=context.length-1;i>=0&&context[i]==tagName;i--)++onCx;pos=nextClose.to;for(var i=1;i<onCx;i++){var next=CodeMirror.scanForClosingTag(cm,pos,null,end);if(!next||next.tag!=tagName)return!1;pos=next.to}return!0}CodeMirror.commands.closeTag=function(cm){return autoCloseCurrent(cm)}});
//# sourceMappingURL=closetag.js.map
