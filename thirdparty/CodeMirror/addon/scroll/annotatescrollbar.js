!function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],mod):mod(CodeMirror)}(function(CodeMirror){"use strict";function Annotation(cm,options){function scheduleRedraw(delay){clearTimeout(self.doRedraw),self.doRedraw=setTimeout(function(){self.redraw()},delay)}this.cm=cm,this.options=options,this.buttonHeight=options.scrollButtonHeight||cm.getOption("scrollButtonHeight"),this.annotations=[],this.doRedraw=this.doUpdate=null,this.div=cm.getWrapperElement().appendChild(document.createElement("div")),this.div.style.cssText="position: absolute; right: 0; top: 0; z-index: 7; pointer-events: none",this.computeScale();var self=this;cm.on("refresh",this.resizeHandler=function(){clearTimeout(self.doUpdate),self.doUpdate=setTimeout(function(){self.computeScale()&&scheduleRedraw(20)},100)}),cm.on("markerAdded",this.resizeHandler),cm.on("markerCleared",this.resizeHandler),!1!==options.listenForChanges&&cm.on("changes",this.changeHandler=function(){scheduleRedraw(250)})}CodeMirror.defineExtension("annotateScrollbar",function(options){return"string"==typeof options&&(options={className:options}),new Annotation(this,options)}),CodeMirror.defineOption("scrollButtonHeight",0),Annotation.prototype.computeScale=function(){var cm=this.cm,hScale=(cm.getWrapperElement().clientHeight-cm.display.barHeight-2*this.buttonHeight)/cm.getScrollerElement().scrollHeight;if(hScale!=this.hScale)return this.hScale=hScale,!0},Annotation.prototype.update=function(annotations){this.annotations=annotations,this.redraw()},Annotation.prototype.redraw=function(compute){!1!==compute&&this.computeScale();var cm=this.cm,hScale=this.hScale,frag=document.createDocumentFragment(),anns=this.annotations,wrapping=cm.getOption("lineWrapping"),singleLineH=wrapping&&1.5*cm.defaultTextHeight(),curLine=null,curLineObj=null;function getY(pos,top){if(curLine!=pos.line){curLine=pos.line,curLineObj=cm.getLineHandle(pos.line);var visual=cm.getLineHandleVisualStart(curLineObj);visual!=curLineObj&&(curLine=cm.getLineNumber(visual),curLineObj=visual)}return curLineObj.widgets&&curLineObj.widgets.length||wrapping&&curLineObj.height>singleLineH?cm.charCoords(pos,"local")[top?"top":"bottom"]:cm.heightAtLine(curLineObj,"local")+(top?0:curLineObj.height);var topY}var lastLine=cm.lastLine();if(cm.display.barWidth)for(var i=0,nextTop;i<anns.length;i++){var ann=anns[i];if(!(ann.to.line>lastLine)){for(var top=nextTop||getY(ann.from,!0)*hScale,bottom=getY(ann.to,!1)*hScale;i<anns.length-1&&!(anns[i+1].to.line>lastLine)&&!((nextTop=getY(anns[i+1].from,!0)*hScale)>bottom+.9);)bottom=getY((ann=anns[++i]).to,!1)*hScale;if(bottom!=top){var height=Math.max(bottom-top,3),elt=frag.appendChild(document.createElement("div"));elt.style.cssText="position: absolute; right: 0px; width: "+Math.max(cm.display.barWidth-1,2)+"px; top: "+(top+this.buttonHeight)+"px; height: "+height+"px",elt.className=this.options.className,ann.id&&elt.setAttribute("annotation-id",ann.id)}}}this.div.textContent="",this.div.appendChild(frag)},Annotation.prototype.clear=function(){this.cm.off("refresh",this.resizeHandler),this.cm.off("markerAdded",this.resizeHandler),this.cm.off("markerCleared",this.resizeHandler),this.changeHandler&&this.cm.off("changes",this.changeHandler),this.div.parentNode.removeChild(this.div)}});
//# sourceMappingURL=annotatescrollbar.js.map
