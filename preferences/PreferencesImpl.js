define(function(require,exports,module){var PreferencesBase=require("./PreferencesBase"),Async=require("utils/Async"),FileSystem=require("filesystem/FileSystem"),SETTINGS_FILENAME="brackets.json",STATE_FILENAME="state.json",userPrefFile=path.normalize(brackets.app.getApplicationSupportDirectory()+"/brackets.json"),_prefManagerReadyDeferred=new $.Deferred,userScopeCorrupt=!1;function isUserScopeCorrupt(){return userScopeCorrupt}var _addScopePromises=[],manager=new PreferencesBase.PreferencesSystem;manager.pauseChangeEvents();var projectStorage=new PreferencesBase.FileStorage(void 0,!0),projectScope=new PreferencesBase.Scope(projectStorage),projectPathLayer=new PreferencesBase.PathLayer,projectLanguageLayer=new PreferencesBase.LanguageLayer;projectScope.addLayer(projectPathLayer),projectScope.addLayer(projectLanguageLayer);var userStorage=new PreferencesBase.FileStorage(userPrefFile,!0),userScope=new PreferencesBase.Scope(userStorage),userLanguageLayer=new PreferencesBase.LanguageLayer;userScope.addLayer(userLanguageLayer);var userScopeLoading=manager.addScope("user",userScope);_addScopePromises.push(userScopeLoading),userScopeLoading.fail(function(err){_addScopePromises.push(manager.addScope("user",new PreferencesBase.MemoryStorage,{before:"default"})),err.name&&"ParsingError"===err.name&&(userScopeCorrupt=!0)}).always(function(){_addScopePromises.push(manager.addScope("project",projectScope,{before:"user"})),_addScopePromises.push(manager.addScope("session",new PreferencesBase.MemoryStorage)),Async.waitForAll(_addScopePromises).always(function(){_prefManagerReadyDeferred.resolve()})});var stateManager=new PreferencesBase.PreferencesSystem,userStateFile=path.normalize(brackets.app.getApplicationSupportDirectory()+"/state.json");FileSystem.alwaysIndex(userStateFile);var smUserScope=new PreferencesBase.Scope(new PreferencesBase.FileStorage(userStateFile,!0,!0)),stateProjectLayer=new PreferencesBase.ProjectLayer;smUserScope.addLayer(stateProjectLayer);var smUserScopeLoading=stateManager.addScope("user",smUserScope);function _reloadUserPrefs(rootDir){var prefsDir;0===path.normalize(brackets.app.getApplicationSupportDirectory()+"/").indexOf(rootDir.fullPath)&&(manager.fileChanged(userPrefFile),stateManager.fileChanged(userStateFile))}exports.manager=manager,exports.projectStorage=projectStorage,exports.projectPathLayer=projectPathLayer,exports.userScopeLoading=userScopeLoading,exports.stateManager=stateManager,exports.stateProjectLayer=stateProjectLayer,exports.smUserScopeLoading=smUserScopeLoading,exports.userPrefFile=userPrefFile,exports.isUserScopeCorrupt=isUserScopeCorrupt,exports.managerReady=_prefManagerReadyDeferred.promise(),exports.reloadUserPrefs=_reloadUserPrefs,exports.STATE_FILENAME="state.json",exports.SETTINGS_FILENAME="brackets.json"});
//# sourceMappingURL=PreferencesImpl.js.map
