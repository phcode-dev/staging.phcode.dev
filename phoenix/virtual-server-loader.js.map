{"version":3,"sources":["phoenix/virtual-server-loader.js"],"names":["Workbox","getRoute","pathName","window","location","pathname","basePath","substring","lastIndexOf","serverReady","console","log","origin","serverInstall","fsServerUrl","navigator","href","wb","logToConsolePref","controlling","then","addEventListener","event","isUpdate","register"],"mappings":"OA+BSA,YAAe,oFAExB,SAASC,WACL,MAAMC,SAAWC,OAAOC,SAASC,SAC3BC,SAAWJ,SAASK,UAAU,EAAGL,SAASM,YAAY,MAC5D,SAAUF,uBAKd,SAASG,cACLC,QAAQC,2CAA2CR,OAAOC,SAASQ,OAASX,cAGhF,SAASY,gBACLH,QAAQC,IAAI,gCAMhB,GAbAR,OAAOW,YAAcX,OAAOC,SAASQ,OAASX,WAa1C,kBAAmBc,UAAW,CAC9BL,QAAQC,IAAIR,OAAOC,SAASY,MAE5B,MAAMC,GAAK,IAAIjB,wCAAoE,SAA5BG,OAAOe,0BAAqCjB,cAInGgB,GAAGE,YAAYC,KAAKX,aAGpBQ,GAAGI,iBAAiB,YAAcC,QAC1BA,MAAMC,UACNV,kBAIRI,GAAGO","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, either version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n * See the GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License along\n * with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n// jshint ignore: start\n/*global navigator*/\n/*eslint no-console: 0*/\n/*eslint strict: [\"error\", \"global\"]*/\n\n\n/** Sets up a web server for the local phoenix virtual file system root.\n * Based on https://github.com/humphd/nohost\n *\n * This module should be functionally as light weight as possible with minimal deps as it is a shell component.\n * **/\n\n\nimport { Workbox } from 'https://storage.googleapis.com/workbox-cdn/releases/4.0.0/workbox-window.prod.mjs';\n\nfunction getRoute(){\n    const pathName = window.location.pathname;\n    const basePath = pathName.substring(0, pathName.lastIndexOf(\"/\"));\n    return `${basePath}/phoenix/vfs`;\n}\n\nwindow.fsServerUrl = window.location.origin + getRoute();\n\nfunction serverReady() {\n    console.log(`Server ready! Serving files on url: ${window.location.origin + getRoute()}`);\n}\n\nfunction serverInstall() {\n    console.log('Web server Worker installed.');\n}\n\n/**\n * Register the nohost service worker, passing `route` or other options.\n */\nif ('serviceWorker' in navigator) {\n    console.log(window.location.href);\n\n    const wb = new Workbox(`virtual-server-main.js?debug=${window.logToConsolePref === 'true'}&route=${getRoute()}`);\n    // for debug, use this URL`nohost-sw.js?debug&route=${basePath}/phoenix/vfs`\n\n    // Wait on the server to be fully ready to handle routing requests\n    wb.controlling.then(serverReady);\n\n    // Deal with first-run install, if necessary\n    wb.addEventListener('installed', (event) => {\n        if(!event.isUpdate) {\n            serverInstall();\n        }\n    });\n\n    wb.register();\n}\n\n"],"file":"virtual-server-loader.js"}