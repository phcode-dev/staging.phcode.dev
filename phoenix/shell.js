import initVFS from"./init_vfs.js";import ERR_CODES from"./errno.js";import initTauriShell from"./tauriShell.js";initVFS();let MAX_ALLOWED_TAURI_WINDOWS=30;async function getTauriWindowLabel(){const tauriWindows=await window.__TAURI__.window.getAll(),windowLabels={};for(let{label:label}of tauriWindows)windowLabels[label]=!0;for(let i=1;i<=MAX_ALLOWED_TAURI_WINDOWS;i++){const windowLabel=`phcode-${i}`;if(!windowLabels[windowLabel])return windowLabel}throw new Error("Could not get a free window label to create tauri window")}Phoenix.app={getNodeState:function(cbfn){cbfn(new Error("Node cannot be run in phoenix browser mode"))},closeWindow:function(){if(!Phoenix.browser.isTauri)throw new Error("closeWindow is not supported in browsers");window.__TAURI__.window.appWindow.close()},clipboardReadText:function(){return Phoenix.browser.isTauri?window.__TAURI__.clipboard.readText():window.navigator&&window.navigator.clipboard?window.navigator.clipboard.readText():Promise.reject(new Error("clipboardReadText: Unable to access clipboard text."))},copyToClipboard:function(textToCopy){if(Phoenix.browser.isTauri)return window.__TAURI__.clipboard.writeText(textToCopy);if(window.navigator&&window.navigator.clipboard)return window.navigator.clipboard.writeText(textToCopy);const textArea=document.createElement("textarea");return textArea.value=textToCopy,document.body.appendChild(textArea),textArea.select(),document.execCommand("copy"),document.body.removeChild(textArea),Promise.resolve()},isFullscreen:function(){return Phoenix.browser.isTauri?window.__TAURI__.window.appWindow.isFullscreen():Promise.resolve(!!document.fullscreenElement)},setFullscreen:function(enable){return Phoenix.browser.isTauri?window.__TAURI__.window.appWindow.setFullscreen(enable):enable?document.documentElement.requestFullscreen():document.exitFullscreen?document.exitFullscreen():Promise.resolve()},getDisplayLocation:function(fullVFSPath){return fullVFSPath.startsWith(Phoenix.VFS.getTauriDir())?Phoenix.fs.getTauriPlatformPath(fullVFSPath):fullVFSPath.startsWith(Phoenix.VFS.getMountDir())?fullVFSPath.replace(Phoenix.VFS.getMountDir(),""):window.Strings.STORED_IN_YOUR_BROWSER},setWindowTitle:async function(title){window.document.title=title,Phoenix.browser.isTauri&&await window.__TAURI__.window.appWindow.setTitle(title)},getWindowTitle:async function(){return Phoenix.browser.isTauri?window.__TAURI__.window.appWindow.title():window.document.title},openPathInFileBrowser:function(fullVFSPath){return new Promise((resolve,reject)=>{if(!window.__TAURI__||!fullVFSPath.startsWith(Phoenix.VFS.getTauriDir()))return void reject("openPathInFileBrowser is only currently supported in Native builds for tauri paths!");if(fullVFSPath.toLowerCase().startsWith("http://")||fullVFSPath.toLowerCase().startsWith("https://")||fullVFSPath.toLowerCase().startsWith("file://"))return void reject("Please use openPathInFileBrowser API to open URLs");const platformPath=Phoenix.fs.getTauriPlatformPath(fullVFSPath);window.__TAURI__.tauri.invoke("show_in_folder",{path:platformPath}).then(resolve).catch(reject)})},openURLInDefaultBrowser:function(url,tabIdentifier="_blank"){return new Promise((resolve,reject)=>{window.__TAURI__?url.toLowerCase().startsWith("http://")||url.toLowerCase().startsWith("https://")?window.__TAURI__.shell.open(url).then(resolve).catch(reject):reject("openURLInDefaultBrowser: URL should be http or https, but was "+url):resolve(window.open(url,tabIdentifier,"noopener,noreferrer"))})},openURLInPhoenixWindow:async function(url,{windowTitle:windowTitle,fullscreen:fullscreen,resizable:resizable,height:height,minHeight:minHeight,width:width,minWidth:minWidth,acceptFirstMouse:acceptFirstMouse,preferTabs:preferTabs}={}){const defaultHeight=900,defaultWidth=1366;if(window.__TAURI__){const windowLabel=await getTauriWindowLabel(),tauriWindow=new window.__TAURI__.window.WebviewWindow(windowLabel,{url:url,title:windowTitle||windowLabel||url,fullscreen:fullscreen,resizable:void 0===resizable||resizable,height:height||900,minHeight:minHeight||600,width:width||1366,minWidth:minWidth||800,acceptFirstMouse:void 0===acceptFirstMouse||acceptFirstMouse});return tauriWindow.isTauriWindow=!0,tauriWindow}let features="toolbar=no,location=no, status=no, menubar=no, scrollbars=yes";features=`${features}, width=${width||1366}, height=${height||900}`,(void 0===resizable||resizable)&&(features+=", resizable=yes"),preferTabs&&(features="");const nativeWindow=window.open(url,"_blank",features);return nativeWindow.isTauriWindow=!1,nativeWindow},zoomWebView:async function(scaleFactor=1){if(!Phoenix.browser.isTauri)throw new Error("zoomWebView is not supported in browsers");if(scaleFactor<.1||scaleFactor>2)throw new Error("zoomWebView scale factor should be between .1 and 2");return window.__TAURI__.tauri.invoke("zoom_window",{scaleFactor:scaleFactor})},getApplicationSupportDirectory:Phoenix.VFS.getAppSupportDir,getExtensionsDirectory:Phoenix.VFS.getExtensionDir,getUserDocumentsDirectory:Phoenix.VFS.getUserDocumentsDirectory,getUserProjectsDirectory:Phoenix.VFS.getUserProjectsDirectory,getTempDirectory:Phoenix.VFS.getTempDir,ERR_CODES:ERR_CODES,getTimeSinceStartup:function(){return Date.now()-Phoenix.startTime},language:navigator.language},window.appshell||(window.appshell=Phoenix),Phoenix.browser.isTauri&&initTauriShell(Phoenix.app);
//# sourceMappingURL=shell.js.map
