{"version":3,"sources":["widgets/Dialogs.js"],"names":["define","require","exports","module","KeyBindingManager","KeyEvent","EditorManager","Strings","DialogTemplate","WorkspaceManager","AppInit","Mustache","DIALOG_BTN_CANCEL","DIALOG_BTN_OK","DIALOG_BTN_DONTSAVE","DIALOG_BTN_SAVE_AS","DIALOG_CANCELED","DIALOG_BTN_DOWNLOAD","DIALOG_BTN_CLASS_PRIMARY","DIALOG_BTN_CLASS_NORMAL","DIALOG_BTN_CLASS_LEFT","zIndex","_isAnyDialogShown","dialogueShown","$","each","this","is","_dismissDialog","$dlg","buttonId","data","modal","getActiveEditor","focus","_processButton","autoDismiss","triggerHandler","_hasButton","find","length","_handleTab","event","$inputs","filter","stopEvent","stopPropagation","preventDefault","target","closest","shiftKey","first","_keydownHook","e","$primaryBtn","which","String","fromCharCode","$focusedElement","inTextArea","tagName","inTypingField","DOM_VK_TAB","DOM_VK_ESCAPE","DOM_VK_RETURN","ctrlKey","DOM_VK_SPACE","click","brackets","platform","metaKey","DOM_VK_BACK_SPACE","DOM_VK_PERIOD","Dialog","promise","_$dlg","_promise","setDialogMaxSize","maxWidth","maxHeight","$dlgs","width","height","css","max-width","max-height","overflow","showModalDialogUsingTemplate","template","undefined","append","result","Deferred","addClass","appendTo","keydownHook","call","lastFocus","window","document","activeElement","one","setTimeout","resolve","remove","removeGlobalKeydownHook","$otherBtn","blur","addGlobalKeydownHook","attr","backdrop","show","selector","keyboard","next","showModalDialog","dlgClass","title","message","buttons","templateVars","className","id","text","OK","render","cancelModalDialogIfOpen","_dontToggleWorkspacePanel","addLinkTooltips","elementOrDialog","$element","getElement","index","elem","$elem","url","prototype","getPromise","close","done","callback","htmlReady","addEscapeKeyEventHandler","addEventListener"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2012 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/**\n * Utilities for creating and managing standard modal dialogs.\n */\ndefine(function (require, exports, module) {\n\n\n    require(\"utils/Global\");\n\n    let KeyBindingManager = require(\"command/KeyBindingManager\"),\n        KeyEvent          = require(\"utils/KeyEvent\"),\n        EditorManager     = require(\"editor/EditorManager\"),\n        Strings           = require(\"strings\"),\n        DialogTemplate    = require(\"text!htmlContent/dialog-template.html\"),\n        WorkspaceManager  = require(\"view/WorkspaceManager\"),\n        AppInit           = require(\"utils/AppInit\"),\n        Mustache          = require(\"thirdparty/mustache/mustache\");\n\n    /**\n     * Dialog Buttons IDs\n     * @const {string}\n     */\n    let DIALOG_BTN_CANCEL           = \"cancel\",\n        DIALOG_BTN_OK               = \"ok\",\n        DIALOG_BTN_DONTSAVE         = \"dontsave\",\n        DIALOG_BTN_SAVE_AS          = \"save_as\",\n        DIALOG_CANCELED             = \"_canceled\",\n        DIALOG_BTN_DOWNLOAD         = \"download\";\n\n    /**\n     * Dialog Buttons Class Names\n     * @const {string}\n     */\n    let DIALOG_BTN_CLASS_PRIMARY    = \"primary\",\n        DIALOG_BTN_CLASS_NORMAL     = \"\",\n        DIALOG_BTN_CLASS_LEFT       = \"left\";\n\n    /**\n     * The z-index used for the dialogs. Each new dialog increase this number by 2\n     * @type {number}\n     */\n    let zIndex = 1050;\n\n    function _isAnyDialogShown() {\n        let dialogueShown = false;\n        $(\".modal\" + \".instance\").each(function () {\n            if ($(this).is(\":visible\")) {   // Bootstrap breaks if try to hide dialog that's already hidden\n                dialogueShown = true;\n            }\n        });\n        return dialogueShown;\n    }\n\n    /**\n     * @private\n     * Dismises a modal dialog\n     * @param {$.Element} $dlg\n     * @param {string} buttonId\n     */\n    function _dismissDialog($dlg, buttonId) {\n        $dlg.data(\"buttonId\", buttonId);\n        $dlg.modal(\"hide\");\n\n        if(!_isAnyDialogShown() && EditorManager.getActiveEditor()){\n            EditorManager.getActiveEditor().focus();\n        }\n    }\n\n    /**\n     * @private\n     * If autoDismiss is true, then dismisses the dialog. Otherwise just raises an event that the\n     * given button was clicked.\n     * @param {$.Element} $dlg The dialog element to be dismissed.\n     * @param {string} buttonId The ID of the button that was clicked.\n     * @param {boolean} autoDismiss Whether to autodismiss the dialog on a button click.\n     */\n    function _processButton($dlg, buttonId, autoDismiss) {\n        if (autoDismiss) {\n            _dismissDialog($dlg, buttonId);\n        } else {\n            $dlg.triggerHandler(\"buttonClick\", buttonId);\n        }\n    }\n\n    /**\n     * @private\n     * Returns true if the modal dialog has a button with the given ID\n     * @param {$.Element} $dlg\n     * @param {string} buttonId\n     * @return {boolean}\n     */\n    function _hasButton($dlg, buttonId) {\n        return ($dlg.find(\"[data-button-id='\" + buttonId + \"']\").length > 0);\n    }\n\n\n    /**\n     * @private\n     * Handles the use of Tab so that it stays inside the Dialog\n     * @param {$.Event} event\n     * @param {$.Element} $dlg\n     */\n    function _handleTab(event, $dlg) {\n        let $inputs = $(\":input:enabled, a\", $dlg).filter(\":visible\");\n\n        function stopEvent() {\n            event.stopPropagation();\n            event.preventDefault();\n        }\n\n        if ($(event.target).closest($dlg).length) {\n            // If it's the first or last tabbable element, focus the last/first element\n            if ((!event.shiftKey && event.target === $inputs[$inputs.length - 1]) ||\n                    (event.shiftKey && event.target === $inputs[0])) {\n                $inputs.filter(event.shiftKey ? \":last\" : \":first\").focus();\n                stopEvent();\n\n            // If there is no element to focus, don't let it focus outside of the dialog\n            } else if (!$inputs.length) {\n                stopEvent();\n            }\n\n        // If the focus left the dialog, focus the first element in the dialog\n        } else {\n            $inputs.first().focus();\n            stopEvent();\n        }\n    }\n\n\n    /**\n     * Handles the keyDown event for the dialogs\n     * @param {$.Event} e\n     * @param {boolean} autoDismiss\n     * @return {boolean}\n     */\n    let _keydownHook = function (e, autoDismiss) {\n        let $primaryBtn     = this.find(\".primary\"),\n            buttonId        = null,\n            which           = String.fromCharCode(e.which),\n            $focusedElement = this.find(\".dialog-button:focus, a:focus\");\n\n        function stopEvent() {\n            e.preventDefault();\n            e.stopPropagation();\n        }\n\n        // There might be a textfield in the dialog's UI; don't want to mistake normal typing for dialog dismissal\n        let inTextArea    = (e.target.tagName === \"TEXTAREA\"),\n            inTypingField = inTextArea || ($(e.target).filter(\":text, :password\").length > 0);\n\n        if (e.which === KeyEvent.DOM_VK_TAB) {\n            // We don't want to stopEvent() in this case since we might want the default behavior.\n            // _handleTab takes care of stopping/preventing default as necessary.\n            _handleTab(e, this);\n        } else if (e.which === KeyEvent.DOM_VK_ESCAPE) {\n            buttonId = DIALOG_BTN_CANCEL;\n        } else if (e.which === KeyEvent.DOM_VK_RETURN && (!inTextArea || e.ctrlKey)) {\n            // Enter key in single-line text input always dismisses; in text area, only Ctrl+Enter dismisses\n            // Click primary\n            stopEvent();\n            if (e.target.tagName === \"BUTTON\") {\n                this.find(e.target).click();\n            } else if (e.target.tagName !== \"INPUT\") {\n                // If the target element is not BUTTON or INPUT, click the primary button\n                // We're making an exception for INPUT element because of this issue: GH-11416\n                $primaryBtn.click();\n            }\n        } else if (e.which === KeyEvent.DOM_VK_SPACE) {\n            if ($focusedElement.length) {\n                // Space bar on focused button or link\n                stopEvent();\n                $focusedElement.click();\n            }\n        } else if (brackets.platform === \"mac\") {\n            // CMD+Backspace Don't Save\n            if (e.metaKey && (e.which === KeyEvent.DOM_VK_BACK_SPACE)) {\n                if (_hasButton(this, DIALOG_BTN_DONTSAVE)) {\n                    buttonId = DIALOG_BTN_DONTSAVE;\n                }\n            // FIXME (issue #418) CMD+. Cancel swallowed by native shell\n            } else if (e.metaKey && (e.which === KeyEvent.DOM_VK_PERIOD)) {\n                buttonId = DIALOG_BTN_CANCEL;\n            }\n        } else { // if (brackets.platform === \"win\") {\n            // 'N' Don't Save\n            if (which === \"N\" && !inTypingField) {\n                if (_hasButton(this, DIALOG_BTN_DONTSAVE)) {\n                    buttonId = DIALOG_BTN_DONTSAVE;\n                }\n            }\n        }\n\n        if (buttonId) {\n            stopEvent();\n            _processButton(this, buttonId, autoDismiss);\n        }\n\n        // Stop any other global hooks from processing the event (but\n        // allow it to continue bubbling if we haven't otherwise stopped it).\n        return true;\n    };\n\n\n\n    /**\n     * @constructor\n     * @private\n     *\n     * @param {$.Element} $dlg The dialog jQuery element\n     * @param {$.Promise} promise A promise that will be resolved with the ID of the clicked button when the dialog\n     *     is dismissed. Never rejected.\n     */\n    function Dialog($dlg, promise) {\n        this._$dlg    = $dlg;\n        this._promise = promise;\n    }\n\n    /**\n     * The dialog jQuery element\n     * @type {$.Element}\n     */\n    Dialog.prototype.getElement = function () {\n        return this._$dlg;\n    };\n\n    /**\n     * The dialog promise\n     * @type {$.Promise}\n     */\n    Dialog.prototype.getPromise = function () {\n        return this._promise;\n    };\n\n    /**\n     * Closes the dialog if is visible\n     */\n    Dialog.prototype.close = function () {\n        if (this._$dlg.is(\":visible\")) {   // Bootstrap breaks if try to hide dialog that's already hidden\n            _dismissDialog(this._$dlg, DIALOG_CANCELED);\n        }\n    };\n\n    /**\n     * Adds a done callback to the dialog promise\n     */\n    Dialog.prototype.done = function (callback) {\n        this._promise.done(callback);\n    };\n\n\n    /**\n     * Don't allow dialog to exceed viewport size\n     */\n    function setDialogMaxSize() {\n        let maxWidth, maxHeight,\n            $dlgs = $(\".modal-inner-wrapper > .instance\");\n\n        // Verify 1 or more modal dialogs are showing\n        if ($dlgs.length > 0) {\n            maxWidth  = $(\"body\").width();\n            maxHeight = $(\"body\").height();\n\n            $dlgs.css({\n                \"max-width\": maxWidth,\n                \"max-height\": maxHeight,\n                \"overflow\": \"auto\"\n            });\n        }\n    }\n\n    /**\n     * Creates a new modal dialog from a given template.\n     * The template can either be a string or a jQuery object representing a DOM node that is *not* in the current DOM.\n     *\n     * @param {string} template A string template or jQuery object to use as the dialog HTML.\n     * @param {boolean=} autoDismiss Whether to automatically dismiss the dialog when one of the buttons\n     *      is clicked. Default true. If false, you'll need to manually handle button clicks and the Esc\n     *      key, and dismiss the dialog yourself when ready by calling `close()` on the returned dialog.\n     * @return {Dialog}\n     */\n    function showModalDialogUsingTemplate(template, autoDismiss) {\n        if (autoDismiss === undefined) {\n            autoDismiss = true;\n        }\n\n        $(\"body\").append(\"<div class='modal-wrapper'><div class='modal-inner-wrapper'></div></div>\");\n\n        let result  = new $.Deferred(),\n            promise = result.promise(),\n            $dlg    = $(template)\n                .addClass(\"instance\")\n                .appendTo(\".modal-inner-wrapper:last\");\n\n        // Don't allow dialog to exceed viewport size\n        setDialogMaxSize();\n\n        // Save the dialog promise for unit tests\n        $dlg.data(\"promise\", promise);\n\n        let keydownHook = function (e) {\n            return _keydownHook.call($dlg, e, autoDismiss);\n        };\n\n        // Store current focus\n        let lastFocus = window.document.activeElement;\n\n        // Pipe dialog-closing notification back to client code\n        $dlg.one(\"hidden\", function () {\n            let buttonId = $dlg.data(\"buttonId\");\n            if (!buttonId) {    // buttonId will be undefined if closed via Bootstrap's \"x\" button\n                buttonId = DIALOG_BTN_CANCEL;\n            }\n\n            // Let call stack return before notifying that dialog has closed; this avoids issue #191\n            // if the handler we're triggering might show another dialog (as long as there's no\n            // fade-out animation)\n            window.setTimeout(function () {\n                result.resolve(buttonId);\n            }, 0);\n\n            // Remove the dialog instance from the DOM.\n            $dlg.remove();\n\n            // Remove our global keydown handler.\n            KeyBindingManager.removeGlobalKeydownHook(keydownHook);\n\n            // Restore previous focus\n            if (lastFocus) {\n                lastFocus.focus();\n            }\n\n            //Remove wrapper\n            $(\".modal-wrapper:last\").remove();\n        }).one(\"shown\", function () {\n            let $primaryBtn = $dlg.find(\".primary:enabled\"),\n                $otherBtn   = $dlg.find(\".modal-footer .dialog-button:enabled:eq(0)\");\n\n            // Set focus to the primary button, to any other button, or to the dialog depending\n            // if there are buttons\n            if ($primaryBtn.length) {\n                $primaryBtn.focus();\n            } else if ($otherBtn.length) {\n                $otherBtn.focus();\n            } else {\n                window.document.activeElement.blur();\n            }\n\n            // Push our global keydown handler onto the global stack of handlers.\n            KeyBindingManager.addGlobalKeydownHook(keydownHook);\n        });\n\n        // Click handler for buttons\n        $dlg.one(\"click\", \".dialog-button\", function (e) {\n            _processButton($dlg, $(this).attr(\"data-button-id\"), autoDismiss);\n        });\n\n        // Run the dialog\n        $dlg\n            .modal({\n                backdrop: \"static\",\n                show: true,\n                selector: \".modal-inner-wrapper:last\",\n                keyboard: false // handle the ESC key ourselves so we can deal with nested dialogs\n            })\n            // Updates the z-index of the modal dialog and the backdrop\n            .css(\"z-index\", zIndex + 1)\n            .next()\n            .css(\"z-index\", zIndex);\n\n        zIndex += 2;\n\n        return (new Dialog($dlg, promise));\n    }\n\n\n    /**\n     * Creates a new general purpose modal dialog using the default template and the template variables given\n     * as parameters as described.\n     *\n     * @param {string} dlgClass A class name identifier for the dialog. Typically one of DefaultDialogs.*\n     * @param {string=} title The title of the dialog. Can contain HTML markup. Defaults to \"\".\n     * @param {string=} message The message to display in the dialog. Can contain HTML markup. Defaults to \"\".\n     * @param {Array.<{className: string, id: string, text: string}>=} buttons An array of buttons where each button\n     *      has a class, id and text property. The id is used in \"data-button-id\". Defaults to a single Ok button.\n     *      Typically className is one of DIALOG_BTN_CLASS_*, id is one of DIALOG_BTN_*\n     * @param {boolean=} autoDismiss Whether to automatically dismiss the dialog when one of the buttons\n     *      is clicked. Default true. If false, you'll need to manually handle button clicks and the Esc\n     *      key, and dismiss the dialog yourself when ready by calling `close()` on the returned dialog.\n     * @return {Dialog}\n     */\n    function showModalDialog(dlgClass, title, message, buttons, autoDismiss) {\n        let templateVars = {\n            dlgClass: dlgClass,\n            title: title   || \"\",\n            message: message || \"\",\n            buttons: buttons || [{ className: DIALOG_BTN_CLASS_PRIMARY, id: DIALOG_BTN_OK, text: Strings.OK }]\n        };\n        let template = Mustache.render(DialogTemplate, templateVars);\n\n        return showModalDialogUsingTemplate(template, autoDismiss);\n    }\n\n    /**\n     * Immediately closes any dialog instances with the given class. The dialog callback for each instance will\n     * be called with the special buttonId DIALOG_CANCELED (note: callback is run asynchronously).\n     * @param {string} dlgClass The class name identifier for the dialog.\n     * @param {string=} buttonId The button id to use when closing the dialog. Defaults to DIALOG_CANCELED\n     */\n    function cancelModalDialogIfOpen(dlgClass, buttonId) {\n        $(\".\" + dlgClass + \".instance\").each(function () {\n            if ($(this).is(\":visible\")) {   // Bootstrap breaks if try to hide dialog that's already hidden\n                _dismissDialog($(this), buttonId || DIALOG_CANCELED);\n            }\n        });\n    }\n\n    function _dontToggleWorkspacePanel() {\n        return _isAnyDialogShown();\n    }\n\n    AppInit.htmlReady(function () {\n        WorkspaceManager.addEscapeKeyEventHandler(\"ModalDialog\", _dontToggleWorkspacePanel);\n    });\n\n    /**\n     * Ensures that all <a> tags with a URL have a tooltip showing the same URL\n     * @param {!jQueryObject|Dialog} elementOrDialog  Dialog intance, or root of other DOM tree to add tooltips to\n     */\n    function addLinkTooltips(elementOrDialog) {\n        let $element;\n        if (elementOrDialog.getElement) {\n            $element = elementOrDialog.getElement().find(\".dialog-message\");\n        } else {\n            $element = elementOrDialog;\n        }\n        $element.find(\"a\").each(function (index, elem) {\n            let $elem = $(elem);\n            let url = $elem.attr(\"href\");\n            if (url && url !== \"#\" && !$elem.attr(\"title\")) {\n                $elem.attr(\"title\", url);\n            }\n        });\n    }\n\n    window.addEventListener(\"resize\", setDialogMaxSize);\n\n    exports.DIALOG_BTN_CANCEL            = DIALOG_BTN_CANCEL;\n    exports.DIALOG_BTN_OK                = DIALOG_BTN_OK;\n    exports.DIALOG_BTN_DONTSAVE          = DIALOG_BTN_DONTSAVE;\n    exports.DIALOG_BTN_SAVE_AS           = DIALOG_BTN_SAVE_AS;\n    exports.DIALOG_CANCELED              = DIALOG_CANCELED;\n    exports.DIALOG_BTN_DOWNLOAD          = DIALOG_BTN_DOWNLOAD;\n\n    exports.DIALOG_BTN_CLASS_PRIMARY     = DIALOG_BTN_CLASS_PRIMARY;\n    exports.DIALOG_BTN_CLASS_NORMAL      = DIALOG_BTN_CLASS_NORMAL;\n    exports.DIALOG_BTN_CLASS_LEFT        = DIALOG_BTN_CLASS_LEFT;\n\n    exports.showModalDialog              = showModalDialog;\n    exports.showModalDialogUsingTemplate = showModalDialogUsingTemplate;\n    exports.cancelModalDialogIfOpen      = cancelModalDialogIfOpen;\n    exports.addLinkTooltips              = addLinkTooltips;\n});\n"],"file":"Dialogs.js"}