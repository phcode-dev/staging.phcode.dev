define(function DOMNodeModule(require,exports,module){var DOMHelpers=require("LiveDevelopment/Agents/DOMHelpers");function _fill(string,length,c){for(void 0===c&&(c=" ");string.length<length;)string+=c;return string}function _makeFindCondition(match){switch(typeof match){case"function":return match;case"string":return function findCondition(name,node){return node.name===name}.bind(void 0,match.toUpperCase());case"number":return function findCondition(type,node){return node.type===type}.bind(void 0,match);default:console.error("Invalid find condition: "+match)}}var DOMNode=function DOMNode(agent,payload){this.agent=agent,this.children=[],this.attributes={},"string"==typeof payload&&(payload=DOMHelpers.extractPayload(payload)),payload&&this.setPayload(payload),this.agent.addNode(this)},TYPE_ELEMENT=DOMNode.TYPE_ELEMENT=1,TYPE_ATTRIBUTE=DOMNode.TYPE_ATTRIBUTE=2,TYPE_TEXT=DOMNode.TYPE_TEXT=3,TYPE_COMMENT=DOMNode.TYPE_COMMENT=8,TYPE_DOCUMENT=DOMNode.TYPE_DOCUMENT=9;return DOMNode.prototype.remove=function remove(){this.agent.removeNode(this),this.parent&&this.parent.removeChild(this)},DOMNode.prototype.setPayload=function setPayload(payload){var i,k,v;if(this.nodeId=payload.nodeId,this.type=payload.nodeType,payload.nodeName&&(this.name=payload.nodeName),payload.nodeValue&&(this.value=payload.nodeValue),this.attributes={},payload.attributes)for(i=0;i<payload.attributes.length;i+=2)k=payload.attributes[i],v=payload.attributes[i+1],this.attributes[k]=v;payload.sourceOffset&&(this.location=payload.sourceOffset),payload.sourceLength?this.length=payload.sourceLength:this.value?this.length=this.value.length:this.name&&(this.length=this.name.length+2),payload.children?this.setChildrenPayload(payload.children):payload.childNodeCount&&this.agent.requestChildNodes(this)},DOMNode.prototype.setChildrenPayload=function setChildrenPayload(childrenPayload){var i,payload,node;for(i in childrenPayload)payload=childrenPayload[i],node=new DOMNode(this.agent,payload),this.appendChild(node)},DOMNode.prototype.payload=function payload(){var res={type:this.type};return this.nodeType===TYPE_ELEMENT?res.nodeName=this.name:res.value=this.value,res},DOMNode.prototype.findParentForNextNodeMatchingPayload=function findParentForNextNodeMatchingPayload(payload){for(var parent=this.canHaveChildren()?this:this.parent;parent&&!parent.matchesPayload(payload);)parent=parent.parent;return parent},DOMNode.prototype.findNextNodeMatchingPayload=function findNextNodeMatchingPayload(payload){for(var next=this.nextNode();next&&!next.matchesPayload(payload);)next=next.nextNode();return next},DOMNode.prototype.matchesPayload=function matchesPayload(payload){var r=!1;if(this.type===payload.nodeType)switch(this.type){case 1:r=this.name===payload.nodeName;break;case 3:r=!0;break;default:r=!0}return r},DOMNode.prototype.resolve=function resolve(){var def=new $.Deferred;return this.objectId?def.resolve(this):this.nodeId?this.agent.resolveNode(this,function onResolve(res){this.objectId=res.object.objectId,def.resolve(this)}.bind(this)):def.reject(),def.promise()},DOMNode.prototype.canHaveChildren=function canHaveChildren(){return 1===this.type&&!this.closed&&!this.closing&&"LINK"!==this.nodeName},DOMNode.prototype.removeChild=function removeChild(node){this.children.splice(this.indexOfChild(node),1),delete node.parent},DOMNode.prototype.insertChildAt=function insertChildAt(node,index){return node.parent&&node.parent.removeChild(node),(!index||index<0||index>this.children.length)&&(index=this.children.length),this.children.splice(index,0,node),node.parent=this,node},DOMNode.prototype.appendChild=function appendChild(node){return this.insertChildAt(node)},DOMNode.prototype.insertChildAfter=function insertChildAfter(node,sibling){var index=this.indexOfChild(sibling);return index>=0&&index++,this.insertChildAt(node,index)},DOMNode.prototype.insertChildBefore=function insertChildBefore(node,sibling){var index=this.indexOfChild(sibling);return this.insertChildAt(node,index)},DOMNode.prototype.indexOfChild=function indexOfChild(node){if(!node)return-1;var i;for(i in this.children)if(this.children[i]===node)return parseInt(i,0);return-1},DOMNode.prototype.previousSibling=function previousSibling(){return this.parent?this.parent.children[this.parent.indexOfChild(this)-1]:null},DOMNode.prototype.nextSibling=function nextSibling(){return this.parent?this.parent.children[this.parent.indexOfChild(this)+1]:null},DOMNode.prototype.previousNode=function previousNode(){var node=this.previousSibling();return node?node.children.length>0&&(node=node.children[node.children.length-1]):node=this.parent,node},DOMNode.prototype.nextNode=function nextNode(){if(this.children.length>0)return this.children[0];for(var node,parent=this;parent;){if(node=parent.nextSibling())return node;parent=parent.parent}return null},DOMNode.prototype.each=function each(callback){if(!1===callback(this))return!1;var i;for(i in this.children)if(!1===this.children[i].each(callback))return!1;return!0},DOMNode.prototype.find=function find(match){var findCondition=_makeFindCondition(match),node=null;return this.each(function each(n){if(findCondition(n))return node=n,!1}),node},DOMNode.prototype.findAll=function findAll(match){var nodes=[],findCondition=_makeFindCondition(match);return this.each(function each(node){findCondition(node)&&nodes.push(node)}),nodes},DOMNode.prototype.eachParent=function eachParent(callback){for(var node=this.parent;node;){if(!1===callback(node))return;node=node.parent}return null},DOMNode.prototype.findParent=function findParent(findCondition){var theParent=null;return this.eachParent(function each(parent){if(findCondition(parent))return theParent=parent,!1}),theParent},DOMNode.prototype.root=function root(){for(var node=this;node.parent;)node=node.parent;return node},DOMNode.prototype.isAtLocation=function isAtLocation(location,includeChildren){return void 0===includeChildren&&(includeChildren=!0),!(!this.location||location<this.location)&&(to=includeChildren&&this.closeLocation?this.closeLocation+this.closeLength:this.location+this.length,this.type===TYPE_TEXT&&(to+=1),location<to);var to},DOMNode.prototype.isEmpty=function isEmpty(){return this.type===TYPE_TEXT&&/^\s*$/.test(this.value)},DOMNode.prototype.toString=function toString(){var r;switch(this.type){case TYPE_ELEMENT:r="<"+this.name+">";break;case TYPE_ATTRIBUTE:r="[ATTRIBUTE]";break;case TYPE_TEXT:r=this.value.replace(/\s+/," ").substr(0,40);break;case TYPE_COMMENT:r="\x3c!--"+this.value.replace(/\s+/," ").substr(0,33)+"--\x3e";break;case TYPE_DOCUMENT:r="<!DOCTYPE>"}return r},DOMNode.prototype.dump=function dump(pre){void 0===pre&&(pre="");var r=pre+this.toString(),i;for(i in this.location&&(r=_fill(r,60),r+=" ("+this.location+","+(this.location+this.length)+")",this.closeLocation&&(r+=" ("+this.closeLocation+","+(this.closeLocation+this.closeLength)+")")),this.nodeId&&(r=_fill(r,80),r+=" {"+this.nodeId+"}"),console.info(r),pre+=". ",this.children)this.children[i].dump(pre)},DOMNode});
//# sourceMappingURL=DOMNode.js.map
