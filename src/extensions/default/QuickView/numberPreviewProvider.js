define(function(require,exports,module){require("./thirdparty/jquery.knob.modified");let PreferencesManager=brackets.getModule("preferences/PreferencesManager"),Strings=brackets.getModule("strings"),AppInit=brackets.getModule("utils/AppInit"),QuickView=brackets.getModule("features/QuickViewManager"),Metrics=brackets.getModule("utils/Metrics"),colorGradientProvider=require("./colorGradientProvider");const PREF_ENABLED_KEY="numberEditor";let prefs=PreferencesManager.getExtensionPrefs("quickview"),enabled;prefs.definePreference("numberEditor","boolean",!0,{description:Strings.DESCRIPTION_NUMBER_QUICK_VIEW});let lastOriginId=0;function _splitNumber(numStr){let split=numStr.match(/(^-?)(\d*\.?\d*)(.*)/),number=split[1]+split[2]||"",decimalPlaces=number.split(".")[1],roundTo;switch(decimalPlaces=decimalPlaces&&decimalPlaces.length||0){case 0:roundTo=1;break;case 1:roundTo=10;break;case 2:default:roundTo=100}return{number:number,units:split[3]||"",decimalPlaces:decimalPlaces,roundTo:roundTo}}function getQuickView(editor,pos,token,line){return new Promise((resolve,reject)=>{if("number"!==token.type||!enabled)return void reject();let sPos={line:pos.line,ch:token.start},ePos={line:pos.line,ch:token.end},editOrigin="+NumberQuickView_"+lastOriginId++,$content=$(`<div><input type="text" value="${token.string}" class="dial"><div>`),split=_splitNumber(token.string),changedMetricSent=!1;$content.find(".dial").knob({stopper:!1,step:1/split.roundTo,max:100/split.roundTo,width:100,height:100,fgColor:"#2893ef",fontSize:"1em",format:function(value){return Math.round(value*split.roundTo)/split.roundTo+split.units},getValue:function(userInput){let changedSplit=_splitNumber(userInput);return split.units=changedSplit.units,changedSplit.number},change:function(value){editor.document.batchOperation(function(){editor.setSelection(sPos,ePos);let replaceStr=Math.round(value*split.roundTo)/split.roundTo+split.units;editor.replaceRange(replaceStr,sPos,ePos,editOrigin),ePos={line:sPos.line,ch:sPos.ch+replaceStr.length},editor.setSelection(sPos,ePos)}),changedMetricSent||(Metrics.countEvent(Metrics.EVENT_TYPE.QUICK_VIEW,"num","changed"),changedMetricSent=!0)}}),resolve({start:sPos,end:ePos,content:$content,exclusive:!0,editsDoc:!0}),Metrics.countEvent(Metrics.EVENT_TYPE.QUICK_VIEW,"num","show")})}function filterQuickView(popovers){let numberQuickView,colorQuickView;for(let popover of popovers)popover.providerInfo.provider.QUICK_VIEW_NAME===exports.QUICK_VIEW_NAME?numberQuickView=popover:popover.providerInfo.provider.QUICK_VIEW_NAME===colorGradientProvider.QUICK_VIEW_NAME&&(colorQuickView=popover);return colorQuickView?[colorQuickView]:[numberQuickView]||popovers}prefs.on("change","numberEditor",function(){enabled=prefs.get("numberEditor")}),AppInit.appReady(function(){enabled=prefs.get("numberEditor"),QuickView.registerQuickViewProvider(exports,["css","html"])}),exports.getQuickView=getQuickView,exports.filterQuickView=filterQuickView,exports.QUICK_VIEW_NAME="numberPreviewProvider"});
//# sourceMappingURL=numberPreviewProvider.js.map
