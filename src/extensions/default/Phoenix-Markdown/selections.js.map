{"version":3,"sources":["extensions/default/Phoenix-Markdown/selections.js"],"names":["define","require","exports","module","_everySelection","editor","fn","i","selections","getSelections","length","state","done","result","_match","match","start","end","matchLength","startMatch","ch","preStart","line","document","getRange","postEnd","endMatch","_isOn","badMatch","_turnOn","insert","existing","replaceRange","_turnOff","remove","preEnd","allSelectionsOn","hasSelection","cursor","getCursorPos","selection","turnSelectionsOn","setCursorPos","turnSelectionsOff"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2016 Alan Hohn\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n/*jslint vars: true, plusplus: true, devel: true, nomen: true, indent: 4, maxerr: 50 */\n/*global define */\n\ndefine(function (require, exports, module) {\n\n\n    /**\n     * Perform the provided action on every selection\n     * (single or multiple). If the action returns an\n     * object, check if it indicates done, in which case\n     * return its result.\n     */\n    function _everySelection(editor, fn) {\n        var i, selections = editor.getSelections();\n        for (i = 0; i < selections.length; i++) {\n            var state = fn(selections[i]);\n            if (state && state.done) {\n                return state.result;\n            }\n        }\n    }\n\n    /**\n     * Returns true if the specified range is immediately\n     * preceeded by and immediately followed by the\n     * specified string\n     */\n    function _match(editor, match, start, end) {\n        var matchLength = match.length;\n        if (matchLength < 1) {\n            return false;\n        }\n        var startMatch = '';\n        if (start.ch >= matchLength) {\n            var preStart = {line: start.line,\n                ch: start.ch - matchLength};\n            startMatch = editor.document.getRange(preStart, start);\n        }\n        var postEnd = {line: end.line, ch: end.ch + matchLength};\n        var endMatch = editor.document.getRange(end, postEnd);\n        return (startMatch === match && endMatch === match);\n    }\n\n    /**\n     * Determines if the specified range is \"on\" (i.e. that\n     * it is immediately preceded by and immediately followed\n     * by the contents of \"match\" but not by the contents of\n     * \"badMatch\").\n     */\n    function _isOn(editor, match, badMatch, start, end) {\n        return _match(editor, match, start, end) &&\n            !_match(editor, badMatch, start, end);\n    }\n\n    function _turnOn(editor, start, end, insert) {\n        // Doing the replace this way gets rid of the current\n        // selection(s), which is undesirable but preferable\n        // to messing the selection up, which is what two separate\n        // inserts does. At least undo works well with this method.\n        var existing = editor.document.getRange(start, end);\n        editor.document.replaceRange(insert + existing + insert, start, end, \"+mdbar\");\n    }\n\n    function _turnOff(editor, start, end, remove) {\n        var preStart = {line: start.line, ch: start.ch - remove.length};\n        // Shifted by the time we use it\n        var preEnd = {line: end.line, ch: end.ch - remove.length};\n        editor.document.replaceRange(\"\", preStart, start, \"+mdbar\");\n        editor.document.replaceRange(\"\", preEnd, end, \"+mdbar\");\n    }\n\n    /**\n     * Determines if all selections are on (see isOn above).\n     * If no selection, uses the current cursor position.\n     */\n    exports.allSelectionsOn = function (editor, match, badMatch) {\n        if (editor.hasSelection()) {\n            var result = _everySelection(editor, function (selection) {\n                if (!_isOn(editor, match, badMatch, selection.start, selection.end)) {\n                    return {done: true, result: false};\n                }\n            });\n            if (typeof result !== 'undefined') {\n                return result;\n            }\n        } else {\n            var cursor = editor.getCursorPos(false, \"to\");\n            return _isOn(editor, match, badMatch, cursor, cursor);\n        }\n        return true;\n    };\n\n    /**\n     * For every selection, or for the cursor line if no selection,\n     * insert the provided string if it is not already present at\n     * both the start and end of the selection.\n     */\n    exports.turnSelectionsOn = function (editor, insert, badMatch) {\n        if (editor.hasSelection()) {\n            _everySelection(editor, function (selection) {\n                if (!_isOn(editor, insert, badMatch, selection.start, selection.end)) {\n                    _turnOn(editor, selection.start, selection.end, insert);\n                    selection.end = {line: selection.end.line, ch: selection.end.ch - insert.length};\n                }\n            });\n        } else {\n            var cursor = editor.getCursorPos(false, \"to\");\n            _turnOn(editor, cursor, cursor, insert);\n            editor.setCursorPos({line: cursor.line, ch: cursor.ch + insert.length});\n        }\n    };\n\n    /**\n     * For every selection, or for the cursor line if no selection,\n     * remove the provided string if it is present at both the\n     * start and end of the selection.\n     */\n    exports.turnSelectionsOff = function (editor, remove, badMatch) {\n        if (editor.hasSelection()) {\n            _everySelection(editor, function (selection) {\n                if (_isOn(editor, remove, badMatch, selection.start, selection.end)) {\n                    _turnOff(editor, selection.start, selection.end, remove);\n                }\n            });\n        } else {\n            var cursor = editor.getCursorPos(false, \"to\");\n            _turnOff(editor, cursor, cursor, remove);\n            //editor.setCursorPos({line: cursor.line, ch: cursor.ch + remove.length});\n        }\n    };\n\n});\n"],"file":"selections.js"}