define(function(require,exports,module){const NotificationUI=brackets.getModule("widgets/NotificationUI"),LiveDevelopment=brackets.getModule("LiveDevelopment/main"),ExtensionInterface=brackets.getModule("utils/ExtensionInterface"),WorkspaceManager=brackets.getModule("view/WorkspaceManager"),MainViewManager=brackets.getModule("view/MainViewManager"),CommandManager=brackets.getModule("command/CommandManager"),Commands=brackets.getModule("command/Commands"),Strings=brackets.getModule("strings"),Menus=brackets.getModule("command/Menus"),StringUtils=brackets.getModule("utils/StringUtils"),KeyBindingManager=brackets.getModule("command/KeyBindingManager"),Metrics=brackets.getModule("utils/Metrics"),NOTIFICATION_BACKOFF=1e4,GUIDED_TOUR_LOCAL_STORAGE_KEY="guidedTourActions",userAlreadyDidAction=localStorage.getItem(GUIDED_TOUR_LOCAL_STORAGE_KEY)?JSON.parse(localStorage.getItem(GUIDED_TOUR_LOCAL_STORAGE_KEY)):{version:1,clickedNewProjectIcon:!1,beautifyCodeShown:!1};let currentlyShowingNotification;function _shouldContinueCommandTracking(){return!userAlreadyDidAction.clickedNewProjectIcon}function _startCommandTracking(){function commandTracker(_event,commandID){let write=!1;switch(commandID){case Commands.FILE_NEW_PROJECT:userAlreadyDidAction.clickedNewProjectIcon=!0,write=!0}write&&localStorage.setItem(GUIDED_TOUR_LOCAL_STORAGE_KEY,JSON.stringify(userAlreadyDidAction)),_shouldContinueCommandTracking()||CommandManager.off(CommandManager.EVENT_BEFORE_EXECUTE_COMMAND,commandTracker)}_shouldContinueCommandTracking()&&CommandManager.on(CommandManager.EVENT_BEFORE_EXECUTE_COMMAND,commandTracker)}function _showBeautifyNotification(){if(userAlreadyDidAction.beautifyCodeShown)return;let editorContextMenu=Menus.getContextMenu(Menus.ContextMenuIds.EDITOR_MENU);function _showNotification(){currentlyShowingNotification||setTimeout(()=>{let keyboardShortcut=KeyBindingManager.getKeyBindings(Commands.EDIT_BEAUTIFY_CODE);keyboardShortcut=keyboardShortcut&&keyboardShortcut[0]?keyboardShortcut[0].displayKey:"-",userAlreadyDidAction.beautifyCodeShown=!0,localStorage.setItem(GUIDED_TOUR_LOCAL_STORAGE_KEY,JSON.stringify(userAlreadyDidAction)),Metrics.countEvent(Metrics.EVENT_TYPE.UI,"guide","beautify"),(currentlyShowingNotification=NotificationUI.createFromTemplate(StringUtils.format(Strings.BEAUTIFY_CODE_NOTIFICATION,keyboardShortcut),"editor-context-menu-edit.beautifyCode",{allowedPlacements:["left","right"],autoCloseTimeS:15,dismissOnClick:!0})).done(()=>{currentlyShowingNotification=null}),editorContextMenu.off(Menus.EVENT_BEFORE_CONTEXT_MENU_OPEN,_showNotification)},500)}editorContextMenu.on(Menus.EVENT_BEFORE_CONTEXT_MENU_OPEN,_showNotification)}function _showNewProjectNotification(){function _showNotification(){currentlyShowingNotification||(Metrics.countEvent(Metrics.EVENT_TYPE.UI,"guide","newProj"),(currentlyShowingNotification=NotificationUI.createFromTemplate(Strings.NEW_PROJECT_NOTIFICATION,"newProject",{allowedPlacements:["top","bottom"],autoCloseTimeS:15,dismissOnClick:!0})).done(()=>{currentlyShowingNotification=null}),MainViewManager.off(MainViewManager.EVENT_CURRENT_FILE_CHANGE,_showNotification))}userAlreadyDidAction.clickedNewProjectIcon||MainViewManager.on(MainViewManager.EVENT_CURRENT_FILE_CHANGE,_showNotification)}function _showPopoutLivePreviewNotification(){ExtensionInterface.waitAndGetExtensionInterface(ExtensionInterface._DEFAULT_EXTENSIONS_INTERFACE_NAMES.PHOENIX_LIVE_PREVIEW).then(livePreviewExtension=>{function _showNotification(){let notificationKey="livePreviewPopoutShown",version="v1",popoutMessageShown;"v1"!==localStorage.getItem(notificationKey)?currentlyShowingNotification||(WorkspaceManager.isPanelVisible(livePreviewExtension.LIVE_PREVIEW_PANEL_ID)&&(Metrics.countEvent(Metrics.EVENT_TYPE.UI,"guide","lp_popout"),(currentlyShowingNotification=NotificationUI.createFromTemplate(Strings.GUIDED_LIVE_PREVIEW_POPOUT,"livePreviewPopoutButton",{allowedPlacements:["bottom"],autoCloseTimeS:15,dismissOnClick:!0})).done(()=>{currentlyShowingNotification=null}),localStorage.setItem(notificationKey,"v1")),LiveDevelopment.off(LiveDevelopment.EVENT_LIVE_PREVIEW_CLICKED,_showNotification)):LiveDevelopment.off(LiveDevelopment.EVENT_LIVE_PREVIEW_CLICKED,_showNotification)}LiveDevelopment.on(LiveDevelopment.EVENT_LIVE_PREVIEW_CLICKED,_showNotification)})}function _showLivePreviewNotification(){const livePreviewNotificationKey="newProjectNotificationShown",livePreviewNotificationShown=localStorage.getItem(livePreviewNotificationKey);livePreviewNotificationShown||(currentlyShowingNotification?setTimeout(_showLivePreviewNotification,NOTIFICATION_BACKOFF):(currentlyShowingNotification=NotificationUI.createFromTemplate(Strings.GUIDED_LIVE_PREVIEW,"main-toolbar",{allowedPlacements:["left"],autoCloseTimeS:15,dismissOnClick:!0}),localStorage.setItem(livePreviewNotificationKey,"true"),currentlyShowingNotification.done(()=>{currentlyShowingNotification=null})))}exports.startTourIfNeeded=function(){_showLivePreviewNotification(),_showPopoutLivePreviewNotification(),_showNewProjectNotification(),_startCommandTracking(),_showBeautifyNotification()}});
//# sourceMappingURL=guided-tour.js.map
