{"version":3,"sources":["extensions/default/JavaScriptRefactoring/unittests.js"],"names":["define","require","exports","module","MainViewManager","brackets","getModule","DocumentManager","SpecRunnerUtils","ScopeManager","Session","ExtractToVariable","ProjectManager","FileSystem","ExtractToFunction","TokenUtils","WrapSelection","RenameIdentifier","testFolder","getTestPath","testPath","testDoc","testEditor","describe","savedGetAllFiles","getAllFiles","savedGetProjectRoot","getProjectRoot","async","setupTest","path","primePump","getDocumentForPath","done","doc","awaitsFor","createMockEditorForDocument","handleProjectOpen","awaits","session","handleEditorChange","document","tearDownTest","_closeAll","ALL_PANES","destroyMockEditor","_waitForRefactoring","prevDocLength","numberOfLines","callback","Function","getText","length","split","_waitForRename","prevSelections","getSelections","beforeAll","files","$","Deferred","resolve","getFileForPath","promise","afterAll","beforeEach","afterEach","it","setSelection","line","ch","handleExtractToVariable","expect","getLine","toBe","getRange","result","handleExtractToFunction","scopeMenu","awaitsForDone","then","inlineMenu","items","name","toBeUndefined","toBeDefined","scopeElement","$menu","find","trigger","selections","handleRename","token1","getTokenAt","_codeMirror","token2","start","toEqual","wrapInTryCatch","wrapInCondition","prevDoc","convertToArrowFunction","createGettersAndSetters"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2013 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/*jslint regexp: true */\n/*global describe, it, expect, beforeEach, afterEach, awaitsFor, beforeAll, afterAll, awaits, awaitsForDone */\n\ndefine(function (require, exports, module) {\n\n\n    const MainViewManager      = brackets.getModule(\"view/MainViewManager\"),\n        DocumentManager      = brackets.getModule(\"document/DocumentManager\"),\n        SpecRunnerUtils      = brackets.getModule(\"spec/SpecRunnerUtils\"),\n        ScopeManager         = brackets.getModule(\"JSUtils/ScopeManager\"),\n        Session              = brackets.getModule(\"JSUtils/Session\"),\n        ExtractToVariable    = require(\"ExtractToVariable\"),\n        ProjectManager       = brackets.getModule(\"project/ProjectManager\"),\n        FileSystem           = brackets.getModule(\"filesystem/FileSystem\"),\n        ExtractToFunction    = require(\"ExtractToFunction\"),\n        TokenUtils           = brackets.getModule(\"utils/TokenUtils\"),\n        WrapSelection        = require(\"WrapSelection\"),\n        RenameIdentifier     = require(\"RenameIdentifier\");\n    const testFolder = SpecRunnerUtils.getTestPath(\"/spec/js-refactor-ext-test-files/\");\n\n    var testPath        = testFolder + \"test.js\",\n        testDoc         = null,\n        testEditor;\n\n    describe(\"extension:Javascript Refactoring \", function () {\n        let savedGetAllFiles = ProjectManager.getAllFiles,\n            savedGetProjectRoot = ProjectManager.getProjectRoot;\n        beforeAll(function () {\n            ProjectManager.getAllFiles = function () {\n                var files = new $.Deferred();\n                files.resolve([FileSystem.getFileForPath(testPath)]);\n                return files.promise();\n            };\n        });\n\n        afterAll(function () {\n            ProjectManager.getAllFiles = savedGetAllFiles;\n            ProjectManager.getProjectRoot = savedGetProjectRoot;\n        });\n\n        async function setupTest(path, primePump) { // FIXME: primePump argument ignored even though used below\n            DocumentManager.getDocumentForPath(path).done(function (doc) {\n                testDoc = doc;\n            });\n\n            await awaitsFor(function () {\n                return testDoc !== null;\n            }, \"Unable to open test document\", 10000);\n\n            // create Editor instance (containing a CodeMirror instance)\n            testEditor = SpecRunnerUtils.createMockEditorForDocument(testDoc);\n            ScopeManager.handleProjectOpen(testFolder);\n            await awaits(100); // wait for code indexing workers to prime\n            let session = new Session(testEditor);\n            ScopeManager.handleEditorChange(session, testEditor.document, null);\n        }\n\n        function tearDownTest() {\n            // The following call ensures that the document is reloaded\n            // from disk before each test\n            MainViewManager._closeAll(MainViewManager.ALL_PANES);\n            SpecRunnerUtils.destroyMockEditor(testDoc);\n            testEditor = null;\n            testDoc = null;\n        }\n\n        async function _waitForRefactoring(prevDocLength, numberOfLines, callback) {\n            if (!callback || numberOfLines instanceof Function) {\n                callback = numberOfLines;\n                numberOfLines = null;\n            }\n            await awaitsFor(function() {\n                return (testDoc.getText().length !== prevDocLength || (numberOfLines && testDoc.getText().split(\"\\n\").length !== numberOfLines));\n            }, 500);\n            callback();\n        }\n\n        async function _waitForRename(prevSelections, callback) {\n            await awaitsFor(function() {\n                return testEditor.getSelections().length !== prevSelections;\n            }, 3000);\n            callback();\n        }\n\n        describe(\"Extract to variable\", function () {\n            beforeEach(async function () {\n                await setupTest(testPath, false);\n            });\n\n            afterEach(function () {\n                tearDownTest();\n            });\n\n            it(\"should extract literal expression\", async function () {\n                testEditor.setSelection({line: 11, ch: 4}, {line: 11, ch: 7});\n\n                var prevDocLength = testDoc.getText().length;\n\n                ExtractToVariable.handleExtractToVariable();\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getLine(11)).toBe(\"var extracted1 = 923;\");\n                    expect(testDoc.getLine(12)).toBe(\"x = extracted1;\");\n                });\n            });\n\n            it(\"should extract array expression\", async function () {\n                testEditor.setSelection({line: 14, ch: 4}, {line: 14, ch: 13});\n\n                var prevDocLength = testDoc.getText().length;\n\n                ExtractToVariable.handleExtractToVariable();\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getLine(14)).toBe(\"var extracted1 = [1, 2, 3];\");\n                    expect(testDoc.getLine(15)).toBe(\"x = extracted1;\");\n                });\n            });\n\n            it(\"should extract object expression\", async function () {\n                testEditor.setSelection({line: 17, ch: 4}, {line: 20, ch: 1});\n\n                var prevDocLength = testDoc.getText().length;\n\n                ExtractToVariable.handleExtractToVariable();\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getRange({line: 17, ch: 0}, {line: 20, ch: 2}))\n                        .toBe(\n                            \"var extracted1 = {\\n\" +\n                            \"    test1: 12,\\n\"     +\n                            \"    test2: 45\\n\"      +\n                            \"};\"\n                        );\n                    expect(testDoc.getLine(21)).toBe(\"x = extracted1;\");\n                });\n            });\n\n            it(\"should extract property expression\", async function () {\n                testEditor.setSelection({line: 23, ch: 4}, {line: 23, ch: 11});\n\n                var prevDocLength = testDoc.getText().length;\n\n                ExtractToVariable.handleExtractToVariable();\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getLine(23)).toBe(\"var extracted1 = x.test1;\");\n                    expect(testDoc.getLine(24)).toBe(\"x = extracted1;\");\n                });\n            });\n\n            it(\"should extract function expression\", async function () {\n                testEditor.setSelection({line: 26, ch: 4}, {line: 28, ch: 1});\n\n                var prevDocLength = testDoc.getText().length;\n\n                ExtractToVariable.handleExtractToVariable();\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getRange({line: 26, ch: 0}, {line: 28, ch: 2}))\n                        .toBe(\n                            \"var extracted1 = function() {\\n\"      +\n                            \"    console.log(\\\"hello world\\\");\\n\"  +\n                            \"};\"\n                        );\n                    expect(testDoc.getLine(29)).toBe(\"x = extracted1;\");\n                });\n            });\n\n            it(\"should extract unary expression\", async function () {\n                testEditor.setSelection({line: 31, ch: 4}, {line: 31, ch: 7});\n\n                var prevDocLength = testDoc.getText().length;\n\n                ExtractToVariable.handleExtractToVariable();\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getLine(31)).toBe(\"var extracted1 = ++y;\");\n                    expect(testDoc.getLine(32)).toBe(\"x = extracted1;\");\n                });\n            });\n\n            it(\"should extract binary expression\", async function () {\n                testEditor.setSelection({line: 34, ch: 4}, {line: 34, ch: 13});\n\n                var prevDocLength = testDoc.getText().length;\n\n                ExtractToVariable.handleExtractToVariable();\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getLine(34)).toBe(\"var extracted1 = 1 + 2 + 3;\");\n                    expect(testDoc.getLine(35)).toBe(\"x = extracted1;\");\n                });\n            });\n\n            it(\"should extract assignment expression\", async function () {\n                testEditor.setSelection({line: 38, ch: 0}, {line: 38, ch: 6});\n\n                var prevDocLength = testDoc.getText().length;\n\n                ExtractToVariable.handleExtractToVariable();\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getLine(38)).toBe(\"var extracted1 = x = 23;\");\n                });\n            });\n\n            it(\"should extract assignment expression\", async function () {\n                testEditor.setSelection({line: 41, ch: 3}, {line: 41, ch: 17});\n\n                var prevDocLength = testDoc.getText().length;\n\n                ExtractToVariable.handleExtractToVariable();\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getLine(41)).toBe(\"var extracted1 = true || false;\");\n                    expect(testDoc.getLine(42)).toBe(\"x = extracted1;\");\n                });\n            });\n\n            it(\"should extract conditional expression\", async function () {\n                testEditor.setSelection({line: 44, ch: 4}, {line: 44, ch: 19});\n\n                var prevDocLength = testDoc.getText().length;\n\n                ExtractToVariable.handleExtractToVariable();\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getLine(44)).toBe(\"var extracted1 = (2 < 3)? 34: 45;\");\n                    expect(testDoc.getLine(45)).toBe(\"x = extracted1;\");\n                });\n            });\n\n            it(\"should extract new expression\", async function () {\n                testEditor.setSelection({line: 50, ch: 4}, {line: 50, ch: 16});\n\n                var prevDocLength = testDoc.getText().length;\n\n                ExtractToVariable.handleExtractToVariable();\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getLine(50)).toBe(\"var extracted1 = new Square();\");\n                    expect(testDoc.getLine(51)).toBe(\"x = extracted1;\");\n                });\n            });\n\n            it(\"should extract arrow function\", async function () {\n                testEditor.setSelection({line: 56, ch: 4}, {line: 56, ch: 16});\n\n                var prevDocLength = testDoc.getText().length;\n\n                ExtractToVariable.handleExtractToVariable();\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getLine(56)).toBe(\"var extracted1 = y => y ** 2;\");\n                    expect(testDoc.getLine(57)).toBe(\"x = extracted1;\");\n                });\n            });\n\n            it(\"should extract template literal\", async function () {\n                testEditor.setSelection({line: 62, ch: 4}, {line: 62, ch: 22});\n\n                var prevDocLength = testDoc.getText().length;\n\n                ExtractToVariable.handleExtractToVariable();\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getLine(62)).toBe(\"var extracted1 = `Template Literal`;\");\n                    expect(testDoc.getLine(63)).toBe(\"x = extracted1;\");\n                });\n            });\n\n            it(\"should extract tagged template literal\", async function () {\n                testEditor.setSelection({line: 65, ch: 4}, {line: 65, ch: 29});\n\n                var prevDocLength = testDoc.getText().length;\n\n                ExtractToVariable.handleExtractToVariable();\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getLine(65)).toBe(\"var extracted1 = String.raw`Hi${2 + 3}!`;\");\n                    expect(testDoc.getLine(66)).toBe(\"x = extracted1;\");\n                });\n            });\n\n            it(\"should extract await expression\", async function () {\n                testEditor.setSelection({line: 77, ch: 12}, {line: 77, ch: 42});\n\n                var prevDocLength = testDoc.getText().length;\n\n                ExtractToVariable.handleExtractToVariable();\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getLine(77)).toBe(\"    var extracted1 = await resolveAfter2Seconds(10);\");\n                    expect(testDoc.getLine(78)).toBe(\"    var x = extracted1;\");\n                });\n            });\n\n            it(\"should extract yield expression\", async function () {\n                testEditor.setSelection({line: 84, ch: 8}, {line: 84, ch: 26});\n\n                var prevDocLength = testDoc.getText().length;\n\n                ExtractToVariable.handleExtractToVariable();\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getLine(84)).toBe(\"        var extracted1 = yield saleList[i];\");\n                });\n            });\n\n            it(\"should extract super expression\", async function () {\n                testEditor.setSelection({line: 103, ch: 8}, {line: 103, ch: 29});\n\n                var prevDocLength = testDoc.getText().length;\n\n                ExtractToVariable.handleExtractToVariable();\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getLine(103)).toBe(\"        var extracted1 = super(length, length);\");\n                });\n            });\n\n            it(\"should extract class expression\", async function () {\n                testEditor.setSelection({line: 109, ch: 4}, {line: 114, ch: 1});\n\n                var prevDocLength = testDoc.getText().length;\n\n                ExtractToVariable.handleExtractToVariable();\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getRange({line: 109, ch: 0}, {line: 114, ch: 2}))\n                    .toBe(\n                        \"var extracted1 = class {\\n\"          +\n                        \"    constructor (height, width) {\\n\" +\n                        \"        this.a = height;\\n\"          +\n                        \"        this.b = width;\\n\"           +\n                        \"    }\\n\"                            +\n                        \"};\"\n                    );\n                    expect(testDoc.getLine(115)).toBe(\"x = extracted1;\");\n                });\n            });\n\n            it(\"should extract all the references of expression in a scope\", async function() {\n                testEditor.setSelection({line: 118, ch: 12}, {line: 118, ch: 14});\n\n                var prevDocLength = testDoc.getText().length;\n\n                ExtractToVariable.handleExtractToVariable();\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getLine(118)).toBe(\"    var extracted1 = 34;\");\n                    expect(testDoc.getLine(119)).toBe(\"    var x = extracted1;\");\n                    expect(testDoc.getLine(120)).toBe(\"    var y = extracted1;\");\n                    expect(testDoc.getLine(121)).toBe(\"    var z = extracted1;\");\n                });\n            });\n\n            it(\"should create variable with unique name\", async function() {\n                testEditor.setSelection({line: 126, ch: 12}, {line: 126, ch: 14});\n\n                var prevDocLength = testDoc.getText().length;\n\n                ExtractToVariable.handleExtractToVariable();\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getLine(126)).toBe(\"    var extracted2 = 45;\");\n                    expect(testDoc.getLine(127)).toBe(\"    var x = extracted2;\");\n                });\n            });\n        });\n\n        describe(\"Extract to function\", function () {\n            beforeEach(async function () {\n                await setupTest(testPath, false);\n            });\n\n            afterEach(function () {\n                tearDownTest();\n            });\n\n            it(\"should display correct scopes for line inside a function declaration\", async function () {\n                testEditor.setSelection({line: 7, ch: 4}, {line: 7, ch: 28});\n\n                var result = ExtractToFunction.handleExtractToFunction();\n                var scopeMenu;\n\n                await awaitsForDone(result.then(function(inlineMenu) {\n                    scopeMenu = inlineMenu;\n                }), \"Scope not displayed in extract to function\", 3000);\n\n                expect(scopeMenu.items.length).toBe(2);\n                expect(scopeMenu.items[0].name).toBe(\"test\");\n                expect(scopeMenu.items[1].name).toBe(\"global\");\n            });\n\n            it(\"should display correct scopes for line inside a function expression\", async function () {\n                testEditor.setSelection({line: 27, ch: 4}, {line: 27, ch: 31});\n\n                var result = ExtractToFunction.handleExtractToFunction();\n                var scopeMenu;\n\n                await awaitsForDone(result.then(function(inlineMenu) {\n                    scopeMenu = inlineMenu;\n                }), \"Scope not displayed in extract to function\", 3000);\n\n                expect(scopeMenu.items.length).toBe(2);\n                expect(scopeMenu.items[0].name).toBe(\"x\");\n                expect(scopeMenu.items[1].name).toBe(\"global\");\n            });\n\n            it(\"should display correct scopes for line inside a arrow function\", async function () {\n                testEditor.setSelection({line: 58, ch: 4}, {line: 58, ch: 17});\n\n                var result = ExtractToFunction.handleExtractToFunction();\n                var scopeMenu;\n\n                await awaitsForDone(result.then(function(inlineMenu) {\n                    scopeMenu = inlineMenu;\n                }), \"Scope not displayed in extract to function\", 3000);\n\n                expect(scopeMenu.items.length).toBe(2);\n                expect(scopeMenu.items[0].name).toBe(\"x\");\n                expect(scopeMenu.items[1].name).toBe(\"global\");\n            });\n\n            it(\"should display correct scopes for line inside a nested function\", async function () {\n                testEditor.setSelection({line: 71, ch: 12}, {line: 71, ch: 23});\n\n                var result = ExtractToFunction.handleExtractToFunction();\n                var scopeMenu;\n\n                await awaitsForDone(result.then(function(inlineMenu) {\n                    scopeMenu = inlineMenu;\n                }), \"Scope not displayed in extract to function\", 3000);\n\n                expect(scopeMenu.items.length).toBe(4);\n                expect(scopeMenu.items[0].name).toBe(\"function starting with {\\n            resolve(x);\\n    \");\n                expect(scopeMenu.items[1].name).toBe(\"function starting with {\\n        setTimeout(() => {\\n \");\n                expect(scopeMenu.items[2].name).toBe(\"resolveAfter2Seconds\");\n                expect(scopeMenu.items[3].name).toBe(\"global\");\n            });\n\n            it(\"should display correct scopes for line inside a class declaration\", async function () {\n                testEditor.setSelection({line: 93, ch: 8}, {line: 93, ch: 27});\n\n                var result = ExtractToFunction.handleExtractToFunction();\n                var scopeMenu;\n\n                await awaitsForDone(result.then(function(inlineMenu) {\n                    scopeMenu = inlineMenu;\n                }), \"Scope not displayed in extract to function\", 3000);\n\n                expect(scopeMenu.items.length).toBe(3);\n                expect(scopeMenu.items[0].name).toBe(\"constructor\");\n                expect(scopeMenu.items[1].name).toBe(\"class Polygon\");\n                expect(scopeMenu.items[2].name).toBe(\"global\");\n            });\n\n            it(\"should display correct scopes for line inside a class expression\", async function () {\n                testEditor.setSelection({line: 112, ch: 8}, {line: 112, ch: 23});\n\n                var result = ExtractToFunction.handleExtractToFunction();\n                var scopeMenu;\n\n                await awaitsForDone(result.then(function(inlineMenu) {\n                    scopeMenu = inlineMenu;\n                }), \"Scope not displayed in extract to function\", 3000);\n\n                expect(scopeMenu.items.length).toBe(3);\n                expect(scopeMenu.items[0].name).toBe(\"constructor\");\n                expect(scopeMenu.items[1].name).toBe(\"class x\");\n                expect(scopeMenu.items[2].name).toBe(\"global\");\n            });\n\n            it(\"should extract line in global scope without displaying scopes\", async function () {\n                testEditor.setSelection({line: 4, ch: 0}, {line: 4, ch: 11});\n\n                var result = ExtractToFunction.handleExtractToFunction();\n                var scopeMenu;\n\n                await awaitsForDone(result.then(function(inlineMenu) {\n                    scopeMenu = inlineMenu;\n                }), \"Scope not displayed in extract to function\", 3000);\n\n                expect(scopeMenu).toBeUndefined();\n                expect(testDoc.getRange({line: 4, ch: 0}, {line: 7, ch: 1}))\n                    .toBe(\n                        \"function extracted1() {\\n\" +\n                        \"    var y = 34;\\n\"     +\n                        \"    return y;\\n\"      +\n                        \"}\"\n                    );\n                expect(testDoc.getLine(9)).toBe(\"var y = extracted1();\");\n            });\n\n            it(\"should extract a line inside a function declaration\", async function () {\n                testEditor.setSelection({line: 7, ch: 4}, {line: 7, ch: 27});\n\n                var prevDocLength = testDoc.getText().length;\n                var result = ExtractToFunction.handleExtractToFunction();\n                var scopeMenu;\n\n                await awaitsForDone(result.then(function(inlineMenu) {\n                    scopeMenu = inlineMenu;\n                }), \"Scope not displayed in extract to function\", 3000);\n\n                expect(scopeMenu).toBeDefined();\n                var scopeElement = scopeMenu.$menu.find(\".inlinemenu-item\")[0];\n                expect(scopeElement).toBeDefined();\n                $(scopeElement).trigger(\"click\");\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getRange({line: 7, ch: 0}, {line: 9, ch: 6}))\n                        .toBe(\n                            \"    function extracted1() {\\n\"       +\n                            \"        console.log(\\\"Testing\\\");\\n\" +\n                            \"    }\"\n                        );\n                });\n            });\n\n            it(\"should extract a line inside a class to a class method\", async function () {\n                testEditor.setSelection({line: 104, ch: 8}, {line: 104, ch: 29});\n\n                var prevDocLength = testDoc.getText().length;\n                var result = ExtractToFunction.handleExtractToFunction();\n                var scopeMenu;\n\n                await awaitsForDone(result.then(function(inlineMenu) {\n                    scopeMenu = inlineMenu;\n                }), \"Scope not displayed in extract to function\", 3000);\n\n                expect(scopeMenu).toBeDefined();\n                var scopeElement = scopeMenu.$menu.find(\".inlinemenu-item\")[1];\n                expect(scopeElement).toBeDefined();\n                $(scopeElement).trigger(\"click\");\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getRange({line: 101, ch: 0}, {line: 103, ch: 6}))\n                        .toBe(\n                            \"    extracted1() {\\n\"            +\n                            \"        this.name = 'Square';\\n\" +\n                            \"    }\"\n                        );\n                    expect(testDoc.getLine(108)).toBe(\"        this.extracted1();\");\n                });\n            });\n\n            it(\"should extract a line inside a class to global scope\", async function () {\n                testEditor.setSelection({line: 104, ch: 8}, {line: 104, ch: 29});\n\n                var prevDocLength = testDoc.getText().length;\n                var result = ExtractToFunction.handleExtractToFunction();\n                var scopeMenu;\n\n                await awaitsForDone(result.then(function(inlineMenu) {\n                    scopeMenu = inlineMenu;\n                }), \"Scope not displayed in extract to function\", 3000);\n\n                expect(scopeMenu).toBeDefined();\n                var scopeElement = scopeMenu.$menu.find(\".inlinemenu-item\")[2];\n                expect(scopeElement).toBeDefined();\n                $(scopeElement).trigger(\"click\");\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getRange({line: 100, ch: 0}, {line: 102, ch: 2}))\n                        .toBe(\n                            \"function extracted1() {\\n\"            +\n                            \"    this.name = 'Square';\\n\" +\n                            \"}\"\n                        );\n                    expect(testDoc.getLine(108)).toBe(\"        extracted1.call(this);\");\n                });\n            });\n        });\n\n\n        describe(\"Rename\", function () {\n            beforeEach(async function () {\n                await setupTest(testPath, false);\n            });\n\n            afterEach(function () {\n                tearDownTest();\n            });\n\n            it(\"should rename function name\", async function() {\n                testEditor.setSelection({line: 140, ch: 17}, {line: 140, ch: 17});\n\n                var selections = testEditor.getSelections();\n\n                RenameIdentifier.handleRename();\n\n\n                await _waitForRename(selections.length, function() {\n                    var selections = testEditor.getSelections(),\n                        token1 = TokenUtils.getTokenAt(testEditor._codeMirror, {line: 132, ch: 14}, {line: 132, ch: 14}),\n                        token2 = TokenUtils.getTokenAt(testEditor._codeMirror, {line: 140, ch: 17}, {line: 140, ch: 17});\n\n                    expect(selections[0].start.line).toEqual(132);\n                    expect(selections[1].start.line).toEqual(140);\n                });\n            });\n\n            it(\"should rename variable name\", async function() {\n                testEditor.setSelection({line: 165, ch: 6}, {line: 165, ch: 6});\n\n                var selections = testEditor.getSelections();\n\n                RenameIdentifier.handleRename();\n\n\n                await _waitForRename(selections.length, function() {\n                    var selections = testEditor.getSelections(),\n                        token1 = TokenUtils.getTokenAt(testEditor._codeMirror, {line: 149, ch: 6}, {line: 149, ch: 6}),\n                        token2 = TokenUtils.getTokenAt(testEditor._codeMirror, {line: 150, ch: 13}, {line: 150, ch: 13});\n\n                    expect(selections[0].start.line).toEqual(165);\n                    expect(selections[1].start.line).toEqual(168);\n                });\n            });\n        });\n\n        describe(\"Wrap Selection\", function () {\n            beforeEach(async function () {\n                await setupTest(testPath, false);\n            });\n\n            afterEach(function () {\n                tearDownTest();\n            });\n\n            it(\"should wrap selection in Try-Catch block\", async function() {\n                testEditor.setSelection({line: 140, ch: 17}, {line: 140, ch: 17});\n\n                var prevDocLength = testDoc.getText().length;\n\n                WrapSelection.wrapInTryCatch();\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getLine(140)).toBe(\"    try {\");\n                    expect(testDoc.getLine(141)).toBe(\"        return addNumbers(a, c) * b;\");\n                    expect(testDoc.getLine(142)).toBe(\"    } catch (e) {\");\n                    expect(testDoc.getLine(143)).toBe(\"        //Catch Statement\");\n                    expect(testDoc.getLine(144)).toBe(\"    }\");\n                });\n            });\n\n            it(\"should wrap selection in Condition block\", async function() {\n                testEditor.setSelection({line: 140, ch: 17}, {line: 140, ch: 17});\n\n                var prevDocLength = testDoc.getText().length;\n\n                WrapSelection.wrapInCondition();\n\n                await _waitForRefactoring(prevDocLength, function() {\n                    expect(testDoc.getLine(140)).toBe(\"    if (Condition) {\");\n                    expect(testDoc.getLine(141)).toBe(\"        return addNumbers(a, c) * b;\");\n                    expect(testDoc.getLine(142)).toBe(\"    }\");\n                });\n            });\n        });\n\n        describe(\"Arrow Function\", function () {\n            beforeEach(async function () {\n                await setupTest(testPath, false);\n            });\n\n            afterEach(function () {\n                tearDownTest();\n            });\n\n            it(\"should convert selected function to arrow function with two param and one return statement\", async function() {\n                testEditor.setSelection({line: 146, ch: 6}, {line: 146, ch: 6});\n\n                var prevDoc = testDoc.getText();\n\n                WrapSelection.convertToArrowFunction();\n\n                await _waitForRefactoring(prevDoc.length, prevDoc.split(\"\\n\").length, function() {\n                    expect(testDoc.getLine(145)).toBe(\"var sum = (a, b) => a+b;\");\n                });\n            });\n\n            it(\"should convert selected function to arrow function with one param and one return statement\", async function() {\n                testEditor.setSelection({line: 150, ch: 6}, {line: 150, ch: 6});\n\n                var prevDoc = testDoc.getText();\n\n                WrapSelection.convertToArrowFunction();\n\n                await _waitForRefactoring(prevDoc.length, prevDoc.split(\"\\n\").length, function() {\n                    expect(testDoc.getLine(149)).toBe(\"var num = a => a;\");\n                });\n            });\n\n            it(\"should convert selected function to arrow function with two param and two statements\", async function() {\n                testEditor.setSelection({line: 154, ch: 6}, {line: 154, ch: 6});\n\n                var prevDoc = testDoc.getText();\n\n                WrapSelection.convertToArrowFunction();\n\n                await _waitForRefactoring(prevDoc.length, prevDoc.split(\"\\n\").length, function() {\n                    expect(testDoc.getLine(153)).toBe(\"var sumAll = (a, b) => {\");\n                });\n            });\n        });\n\n        describe(\"Getters-Setters\", function () {\n            beforeEach(async function () {\n                await setupTest(testPath, false);\n            });\n\n            afterEach(function () {\n                tearDownTest();\n            });\n\n            it(\"should create Getters Setters for selected property\", async function() {\n                testEditor.setSelection({line: 161, ch: 12}, {line: 161, ch: 12});\n\n                var prevDoc = testDoc.getText();\n\n                WrapSelection.createGettersAndSetters();\n\n                await _waitForRefactoring(prevDoc.length, prevDoc.split(\"\\n\").length, function() {\n                    expect(testDoc.getLine(162)).toBe(\"    get docCurrent() {\");\n                    expect(testDoc.getLine(163)).toBe(\"        return this.docCurrent;\");\n                    expect(testDoc.getLine(164)).toBe(\"    },\");\n                    expect(testDoc.getLine(166)).toBe(\"    set docCurrent(val) {\");\n                    expect(testDoc.getLine(167)).toBe(\"        this.docCurrent = val;\");\n                    expect(testDoc.getLine(168)).toBe(\"    },\");\n                });\n            });\n\n            it(\"should create Getters Setters for last property in context\", async function() {\n                testEditor.setSelection({line: 162, ch: 12}, {line: 162, ch: 12});\n\n                var prevDoc = testDoc.getText();\n\n                WrapSelection.createGettersAndSetters();\n\n                await _waitForRefactoring(prevDoc.length, prevDoc.split(\"\\n\").length, function() {\n                    expect(testDoc.getLine(162)).toBe(\"    isReadOnly  : false,\");\n                    expect(testDoc.getLine(163)).toBe(\"    get isReadOnly() {\");\n                    expect(testDoc.getLine(164)).toBe(\"        return this.isReadOnly;\");\n                    expect(testDoc.getLine(165)).toBe(\"    },\");\n                    expect(testDoc.getLine(167)).toBe(\"    set isReadOnly(val) {\");\n                    expect(testDoc.getLine(168)).toBe(\"        this.isReadOnly = val;\");\n                    expect(testDoc.getLine(169)).toBe(\"    }\");\n                });\n            });\n        });\n    });\n\n});\n"],"file":"unittests.js"}