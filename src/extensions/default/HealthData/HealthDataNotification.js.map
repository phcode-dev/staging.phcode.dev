{"version":3,"sources":["extensions/default/HealthData/HealthDataNotification.js"],"names":["define","require","exports","module","PreferencesManager","brackets","getModule","ExtensionInterface","HealthDataPreview","HealthDataPopup","NEW_PROJECT_EXTENSION_INTERFACE","POPUP_FIRST_LAUNCH_SHOW_DELAY","Phoenix","firstBoot","newProjectExtension","handleHealthDataStatistics","previewHealthData","_showFirstLaunchPopup","off","EVENT_NEW_PROJECT_DIALOGUE_CLOSED","window","testEnvironment","alreadyShown","getViewState","prefs","getExtensionPrefs","get","showFirstLaunchTooltip","done","setViewState","waitAndGetExtensionInterface","then","interfaceObj","on","setTimeout"],"mappings":"AA0BAA,OAAO,SAAUC,QAASC,QAASC,QAE/B,IAAIC,mBAA+BC,SAASC,UAAU,kCAClDC,mBAA+BF,SAASC,UAAU,4BAClDE,kBAA+BP,QAAQ,qBACvCQ,gBAA+BR,QAAQ,mBAE3C,MAAMS,gCAAkC,0BAMpCC,8BAAgCC,QAAQC,UAAY,KAAS,IAEjE,IAAIC,oBASJ,SAASC,6BACLP,kBAAkBQ,oBAGtB,SAASC,wBAIL,GADAH,oBAAoBI,IAAIJ,oBAAoBK,kCAAmCF,wBAC3EG,OAAOC,gBAAgB,CACvB,MAAMC,aAAelB,mBAAmBmB,aAAa,+BAC/CC,MAAQpB,mBAAmBqB,kBAAkB,eAC9CH,cAAgBE,MAAME,IAAI,uBAC3BjB,gBAAgBkB,yBACXC,KAAK,WACFxB,mBAAmByB,aAAa,+BAA+B,MAtBnFtB,mBAAmBuB,6BATqB,2BAUnCC,KAAKC,eACFlB,oBAAsBkB,aACtBA,aAAaC,GAAGD,aAAab,kCAAmC,KAC5De,WAAWjB,sBAAuBN,mCAwB9CT,QAAQa,2BAAmCA","sourcesContent":["/*\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2015 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n *\n */\n\n/*global Phoenix*/\n\ndefine(function (require, exports, module) {\n\n    var PreferencesManager           = brackets.getModule(\"preferences/PreferencesManager\"),\n        ExtensionInterface           = brackets.getModule(\"utils/ExtensionInterface\"),\n        HealthDataPreview            = require(\"HealthDataPreview\"),\n        HealthDataPopup              = require(\"HealthDataPopup\");\n\n    const NEW_PROJECT_EXTENSION_INTERFACE = \"Extn.Phoenix.newProject\",\n        // Since we don't have any user accounts or trackable ID to uniquely identify a user on first launch,\n        // we should be ok GDPR wise to delay showing the health data popup to 3 minutes after launch.\n        // The popup will show immediately if the user launches app again and, popup not shown before.\n        // This will also give time for the user to actually read the popup instead of having to dismiss a\n        // bunch of popups at startup.\n        POPUP_FIRST_LAUNCH_SHOW_DELAY = Phoenix.firstBoot ? 180000 : 5000;\n\n    let newProjectExtension;\n    ExtensionInterface.waitAndGetExtensionInterface(NEW_PROJECT_EXTENSION_INTERFACE)\n        .then(interfaceObj => {\n            newProjectExtension = interfaceObj;\n            interfaceObj.on(interfaceObj.EVENT_NEW_PROJECT_DIALOGUE_CLOSED, ()=>{\n                setTimeout(_showFirstLaunchPopup, POPUP_FIRST_LAUNCH_SHOW_DELAY);\n            });\n        });\n\n    function handleHealthDataStatistics() {\n        HealthDataPreview.previewHealthData();\n    }\n\n    function _showFirstLaunchPopup() {\n        // call this only after newProjectExtn interface is available\n        // Check whether the notification dialog should be shown. It will be shown only one time.\n        newProjectExtension.off(newProjectExtension.EVENT_NEW_PROJECT_DIALOGUE_CLOSED, _showFirstLaunchPopup);\n        if(!window.testEnvironment){\n            const alreadyShown = PreferencesManager.getViewState(\"healthDataNotificationShown\");\n            const prefs = PreferencesManager.getExtensionPrefs(\"healthData\");\n            if (!alreadyShown && prefs.get(\"healthDataTracking\")) {\n                HealthDataPopup.showFirstLaunchTooltip()\n                    .done(function () {\n                        PreferencesManager.setViewState(\"healthDataNotificationShown\", true);\n                    });\n            }\n        }\n    }\n\n    exports.handleHealthDataStatistics       = handleHealthDataStatistics;\n});\n"],"file":"HealthDataNotification.js"}