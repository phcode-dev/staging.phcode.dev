{"version":3,"sources":["view/MainViewManager.js"],"names":["define","require","exports","module","_","EventDispatcher","Strings","AppInit","CommandManager","MainViewFactory","ViewStateManager","Commands","EditorManager","FileSystemError","DocumentManager","PreferencesManager","ProjectManager","WorkspaceManager","AsyncUtils","ViewUtils","Resizer","Pane","KeyBindingManager","brackets","getModule","PREFS_NAME","OLD_PREFS_NAME","ALL_PANES","ACTIVE_PANE","FIRST_PANE","SECOND_PANE","VERTICAL","HORIZONTAL","MIN_PANE_SIZE","_orientation","_activePaneId","_$el","_panes","_paneScrollStates","_traversingFileList","_mruList","_paneTitles","_makeMRUListEntry","file","paneId","_findFileInMRUList","findIndex","record","fullPath","isExclusiveToPane","index","getActivePaneId","_resolvePaneId","_getPane","focusActivePane","focus","_isSpecialPaneId","_makeFileMostRecent","entry","pane","makeViewMostRecent","id","splice","console","log","unshift","_makePaneMostRecent","getCurrentlyViewedFile","setActivePaneId","newPaneId","oldPaneId","oldPane","newPane","Error","trigger","_getPaneFromElement","$el","find","getCurrentlyViewedPath","_activeEditorChange","e","current","$container","parent","parents","length","$","_forEachPaneOrPanes","callback","forEach","cacheScrollState","getScrollState","restoreAdjustedScrollState","heightDelta","restoreAndAdjustScrollState","getWorkingSet","result","viewList","getViewList","union","getAllOpenFiles","getPaneIdList","Object","keys","getWorkingSetSize","getViewListSize","getPaneTitle","getPaneCount","_doFindInWorkingSet","method","call","findInAllWorkingSets","findInViewList","push","findInWorkingSet","findInWorkingSetByAddedOrder","findInWorkingSetByMRUOrder","_getPaneIdForPath","info","shift","LEFT","TOP","RIGHT","BOTTOM","_viewStateSaveScheduled","_scheduleViewStateSave","_saveViewStateAndResetScheduler","_saveViewState","window","setTimeout","addToWorkingSet","force","reorderItem","ITEM_FOUND_NEEDS_SORT","warn","ITEM_NOT_FOUND","addToViewList","addListToWorkingSet","fileList","uniqueFileList","addListToViewList","unsolvedList","filter","item","_removeFileFromMRU","compare","_removeView","suppressRedraw","removeView","_moveView","sourcePaneId","destinationPaneId","destinationIndex","Deferred","sourcePane","destinationPane","moveView","done","every","resolve","promise","switchPaneFocus","$firstPane","$secondPane","hasClass","click","_removeDeletedFileFromMRU","_sortWorkingSet","compareFn","sortViewList","_moveWorkingSetItem","fromIndex","toIndex","moveWorkingSetItem","_swapWorkingSetListIndexes","index1","index2","swapViewListIndexes","traverseToNextViewByMRU","direction","traverseViewArray","traverseToNextViewInListOrder","curPaneId","allFiles","paneFiles","map","concat","beginTraversal","endTraversal","_synchronizePaneSize","forceRefresh","available","innerWidth","innerHeight","resyncSizer","data","updateLayout","_updateLayout","event","viewAreaHeight","percentage","height","css","_initialLayout","panes","size","width","float","_updatePaneHeaders","updateHeaderText","_createPaneIfNecessary","hasOwnProperty","on","newView","oldView","getFile","view","_makeFirstPaneResizable","firstPane","makeResizable","DIRECTION_VERTICAL","DIRECTION_HORIZONTAL","POSITION_BOTTOM","POSITION_RIGHT","undefined","_doSplit","orientation","removeSizable","removeClass","toLowerCase","addClass","_edit","doc","optionsIn","options","isUntitled","isWithinProject","openDocument","noPaneActivate","_open","doPostOpenActivation","reject","factory","findSuitableFactoryForPath","exists","fileError","fileExists","openFile","fail","NOT_FOUND","getDocumentForPath","extend","_mergePanes","secondPane","lastViewed","mergeFrom","off","destroy","_close","noOpenNextFile","_closeList","closedList","removeViews","_closeAll","_reset","_findPaneForDocument","document","_masterEditor","_destroyEditorIfNotNeeded","Document","destroyViewIfNotNeeded","_loadViewState","promises","context","location","scope","layer","state","getViewState","convertViewState","files","activePaneId","first-pane","value","reset","paneState","loadState","waitForAll","then","opensList","prop","isNumeric","splitPercentage","openData","execute","FILE_OPEN","_computeSplitPercentage","used","projectRoot","getProjectRoot","layerID","saveState","setViewState","_initialize","_handleActivePaneChange","register","CMD_SWITCH_PANE_FOCUS","addBinding","key","setLayoutScheme","rows","columns","error","getLayoutScheme","htmlReady","on_duringInit","makeEventDispatcher","setLeakThresholdForEvent","findInGlobalMRUList"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2014 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n// jshint ignore: start\n\n/**\n * MainViewManager manages the arrangement of all open panes as well as provides the controller\n * logic behind all views in the MainView (e.g. ensuring that a file doesn't appear in 2 lists)\n *\n * Each pane contains one or more views wich are created by a view factory and inserted into a pane list.\n * There may be several panes managed by the MainViewManager with each pane containing a list of views.\n * The panes are always visible and the layout is determined by the MainViewManager and the user.\n *\n * Currently we support only 2 panes.\n *\n * All of the WorkingSet APIs take a paneId Argument.  This can be an actual pane Id, ALL_PANES (in most cases)\n * or ACTIVE_PANE. ALL_PANES may not be supported for some APIs.  See the API for details.\n *\n * This module dispatches several events:\n *\n *    - activePaneChange - When the active pane changes.  There will always be an active pane.\n *          (e, newPaneId:string, oldPaneId:string)\n *    - currentFileChange -- When the user has switched to another pane, file, document. When the user closes a view\n *      and there are no other views to show the current file will be null.\n *          (e, newFile:File, newPaneId:string, oldFile:File, oldPaneId:string)\n *    - paneLayoutChange -- When Orientation changes.\n *          (e, orientation:string)\n *    - paneCreate -- When a pane is created\n *          (e, paneId:string)\n *    - paneDestroy -- When a pane is destroyed\n *          (e, paneId:string)\n *\n *\n *    To listen for working set changes, you must listen to *all* of these events:\n *    - workingSetAdd -- When a file is added to the working set\n *          (e, fileAdded:File, index:number, paneId:string)\n *    - workingSetAddList -- When multiple files are added to the working set\n *          (e, fileAdded:Array.<File>, paneId:string)\n *    - workingSetMove - When a File has moved to a different working set\n *          (e, File:FILE, sourcePaneId:string, destinationPaneId:string)\n *    - workingSetRemove -- When a file is removed from the working set\n *          (e, fileRemoved:File, suppressRedraw:boolean, paneId:string)\n *    - workingSetRemoveList -- When multiple files are removed from the working set\n *          (e, filesRemoved:Array.<File>, paneId:string)\n *    - workingSetSort -- When a pane's view array is reordered without additions or removals.\n *          (e, paneId:string)\n *    - workingSetUpdate -- When changes happen due to system events such as a file being deleted.\n *                              listeners should discard all working set info and rebuilt it from the pane\n *                              by calling getWorkingSet()\n *          (e, paneId:string)\n *    - _workingSetDisableAutoSort -- When the working set is reordered by manually dragging a file.\n *          (e, paneId:string) For Internal Use Only.\n *\n * To listen for events, do something like this: (see EventDispatcher for details on this pattern)\n *    `MainViewManager.on(\"eventname\", handler);`\n */\ndefine(function (require, exports, module) {\n\n\n    var _                   = require(\"thirdparty/lodash\"),\n        EventDispatcher     = require(\"utils/EventDispatcher\"),\n        Strings             = require(\"strings\"),\n        AppInit             = require(\"utils/AppInit\"),\n        CommandManager      = require(\"command/CommandManager\"),\n        MainViewFactory     = require(\"view/MainViewFactory\"),\n        ViewStateManager    = require(\"view/ViewStateManager\"),\n        Commands            = require(\"command/Commands\"),\n        EditorManager       = require(\"editor/EditorManager\"),\n        FileSystemError     = require(\"filesystem/FileSystemError\"),\n        DocumentManager     = require(\"document/DocumentManager\"),\n        PreferencesManager  = require(\"preferences/PreferencesManager\"),\n        ProjectManager      = require(\"project/ProjectManager\"),\n        WorkspaceManager    = require(\"view/WorkspaceManager\"),\n        AsyncUtils          = require(\"utils/Async\"),\n        ViewUtils           = require(\"utils/ViewUtils\"),\n        Resizer             = require(\"utils/Resizer\"),\n        Pane                = require(\"view/Pane\").Pane,\n        KeyBindingManager   = brackets.getModule(\"command/KeyBindingManager\");\n\n    /**\n     * Preference setting name for the MainView Saved State\n     * @const\n     * @private\n     */\n    var PREFS_NAME          = \"mainView.state\";\n\n    /**\n     * Legacy Preference setting name used to migrate old preferences\n     * @const\n     * @private\n     */\n    var OLD_PREFS_NAME      = \"project.files\";\n\n    /**\n     * Special paneId shortcut that can be used to specify that\n     * all panes should be targeted by the API.\n     * Not all APIs support this constnant.\n     * Check the API documentation before use.\n     * @const\n     */\n    var ALL_PANES           = \"ALL_PANES\";\n\n    /**\n     * Special paneId shortcut that can be used to specify that\n     * the API should target the focused pane only.\n     * All APIs support this shortcut.\n     * @const\n     */\n    var ACTIVE_PANE        = \"ACTIVE_PANE\";\n\n    /**\n     * Internal pane id\n     * @const\n     * @private\n     */\n    var FIRST_PANE          = \"first-pane\";\n\n    /**\n     * Internal pane id\n     * @const\n     * @private\n     */\n    var SECOND_PANE         = \"second-pane\";\n\n    /*\n     * NOTE: The following commands and constants will change\n     *        when implementing the UX UI Treatment @larz0\n     */\n\n    /**\n     * Vertical layout state name\n     * @const\n     * @private\n     */\n    var VERTICAL            = \"VERTICAL\";\n\n    /**\n     * Horizontal layout state name\n     * @const\n     * @private\n     */\n    var HORIZONTAL          = \"HORIZONTAL\";\n\n    /**\n     * The minimum width or height that a pane can be\n     * @const\n     * @private\n     */\n    var MIN_PANE_SIZE      = 75;\n\n    /**\n     * current orientation (null, VERTICAL or HORIZONTAL)\n     * @type {string=}\n     * @private\n     */\n    var _orientation = null;\n\n    /**\n     * current pane id. May not be null\n     * @type {!string}\n     * @private\n     */\n    var _activePaneId = null;\n\n    /**\n     * DOM element hosting the Main View.\n     * @type {jQuery}\n     * @private\n     */\n    var _$el;\n\n    /**\n     * Maps paneId to Pane objects\n     * @type {Object.<string, Pane>}\n     * @private\n     */\n    var _panes = {};\n\n\n    /**\n     * map of pane scroll states\n     * @type {Object.map<string, *>}\n     * @private\n     */\n    var _paneScrollStates = {};\n\n\n    /**\n     * flag indicating if traversing is currently taking place\n     * When True, changes the current pane's MRU list will not be updated.\n     * Useful for next/previous keyboard navigation (until Ctrl is released)\n     * or for incremental-search style document preview like Quick Open will eventually have.\n     * @type {!boolean}\n     * @private\n     */\n    var _traversingFileList = false;\n\n    /**\n     * The global MRU list (for traversing)\n     * @type {Array.<file:File, paneId:string>}\n     */\n    var _mruList = [];\n\n    /**\n     * localized pane titles\n     * @type {Object.<FIRST_PANE|SECOND_PANE, <VERTICAL.string, HORIZONTAL.string>}}\n     *  Localized string for first and second panes in the current orientation.\n     * @see {@link #getPaneTitle} for more information\n     * @private\n     */\n    var _paneTitles  = {};\n\n    /*\n     * Initialize _paneTitles\n     */\n    _paneTitles[FIRST_PANE] = {};\n    _paneTitles[SECOND_PANE] = {};\n\n    _paneTitles[FIRST_PANE][VERTICAL]     = Strings.LEFT;\n    _paneTitles[FIRST_PANE][HORIZONTAL]   = Strings.TOP;\n    _paneTitles[SECOND_PANE][VERTICAL]    = Strings.RIGHT;\n    _paneTitles[SECOND_PANE][HORIZONTAL]  = Strings.BOTTOM;\n\n    /**\n     * Makes a MRU List Entry\n     * @param {!File} File - the file\n     * @param {!string} paneId - the paneId\n     * @return {{file:File, paneId:string}}\n     * @private\n     */\n    function _makeMRUListEntry(file, paneId) {\n        return {file: file, paneId: paneId};\n    }\n\n    /**\n     * Locates the first  MRU entry of a file for the requested pane\n     * @param {!string} paneId - the paneId\n     * @param {!File} File - the file\n     * @return {{file:File, paneId:string}}\n     * @private\n     */\n    function _findFileInMRUList(paneId, file) {\n        return _.findIndex(_mruList, function (record) {\n            return (record.file.fullPath === file.fullPath && record.paneId === paneId);\n        });\n    }\n\n    /**\n     * Checks whether a file is listed exclusively in the provided pane\n     * @param {!File} File - the file\n     * @return {{file:File, paneId:string}}\n     */\n    function isExclusiveToPane(file, paneId) {\n        paneId = paneId === ACTIVE_PANE && _activePaneId ? _activePaneId : paneId;\n        var index = _.findIndex(_mruList, function (record) {\n            return (record.file.fullPath === file.fullPath && record.paneId !== paneId);\n        });\n        return index === -1;\n    }\n\n\n    /**\n     * Retrieves the currently active Pane Id\n     * @return {!string} Active Pane's ID.\n     */\n    function getActivePaneId() {\n        return _activePaneId;\n    }\n\n    /**\n     * Resolve paneId to actual pane.\n     * @param {?string} paneId - id of the desired pane. May be symbolic or null (to indicate current pane)\n     * @return {string} id of the pane in which to open the document\n     */\n    function _resolvePaneId(paneId) {\n        if (!paneId || paneId === ACTIVE_PANE) {\n            return getActivePaneId();\n        }\n        return paneId;\n    }\n\n    /**\n     * Retrieves the Pane object for the given paneId\n     * @param {!string} paneId - id of the pane to retrieve\n     * @return {?Pane} the Pane object or null if a pane object doesn't exist for the pane\n     * @private\n     */\n    function _getPane(paneId) {\n        paneId = _resolvePaneId(paneId);\n\n        if (_panes[paneId]) {\n            return _panes[paneId];\n        }\n\n        return null;\n    }\n\n    /**\n     * Focuses the current pane. If the current pane has a current view, then the pane will focus the view.\n     */\n    function focusActivePane() {\n        _getPane(ACTIVE_PANE).focus();\n    }\n\n    /**\n     * Determines if the pane id is a special pane id\n     * @param {!string} paneId - the id to test\n     * @return {boolean} true if the pane id is a special identifier, false if not\n     */\n    function _isSpecialPaneId(paneId) {\n        return paneId === ACTIVE_PANE || paneId === ALL_PANES;\n    }\n\n    /**\n     * Makes the file the most recent for the pane and the global mru lists\n     * @param {!string} paneId - id of the pane to mae th file most recent or ACTIVE_PANE\n     * @param {!File} file - File object to make most recent\n     * @private\n     */\n    function _makeFileMostRecent(paneId, file) {\n        var index,\n            entry,\n            pane = _getPane(paneId);\n\n        if (!_traversingFileList) {\n            pane.makeViewMostRecent(file);\n\n            index = _findFileInMRUList(pane.id, file);\n\n            entry = _makeMRUListEntry(file, pane.id);\n\n            if (index !== -1) {\n                _mruList.splice(index, 1);\n            }\n\n            if (_findFileInMRUList(pane.id, file) !== -1) {\n                console.log(file.fullPath + \" duplicated in mru list\");\n            }\n\n            // add it to the front of the list\n            _mruList.unshift(entry);\n        }\n    }\n\n    /**\n     * Makes the Pane's current file the most recent\n     * @param {!string} paneId - id of the pane to make the file most recent, or ACTIVE_PANE\n     * @param {!File} file - File object to make most recent\n     * @private\n     */\n    function _makePaneMostRecent(paneId) {\n        var pane = _getPane(paneId);\n\n        if (pane.getCurrentlyViewedFile()) {\n            _makeFileMostRecent(paneId, pane.getCurrentlyViewedFile());\n        }\n    }\n\n    /**\n     * Switch active pane to the specified pane id (or ACTIVE_PANE/ALL_PANES, in which case this\n     * call does nothing).\n     * @param {!string} paneId - the id of the pane to activate\n     */\n    function setActivePaneId(newPaneId) {\n        if (!_isSpecialPaneId(newPaneId) && newPaneId !== _activePaneId) {\n            var oldPaneId = _activePaneId,\n                oldPane = _getPane(ACTIVE_PANE),\n                newPane = _getPane(newPaneId);\n\n            if (!newPane) {\n                throw new Error(\"invalid pane id: \" + newPaneId);\n            }\n\n            _activePaneId = newPaneId;\n\n            exports.trigger(\"activePaneChange\", newPaneId, oldPaneId);\n            exports.trigger(\"currentFileChange\", _getPane(ACTIVE_PANE).getCurrentlyViewedFile(),\n                                                            newPaneId,\n                                                            oldPane.getCurrentlyViewedFile(),\n                                                            oldPaneId);\n\n            _makePaneMostRecent(_activePaneId);\n            focusActivePane();\n        }\n    }\n\n    /**\n     * Retrieves the Pane ID for the specified container\n     * @param {!jQuery} $el - the element of the pane to fetch\n     * @return {?string} the id of the pane that matches the container or undefined if a pane doesn't exist for that container\n     */\n    function _getPaneFromElement($el) {\n        return _.find(_panes, function (pane) {\n            if (pane.$el[0] === $el[0]) {\n                return pane;\n            }\n        });\n    }\n\n    /**\n     * Retrieves the currently viewed file of the specified paneId\n     * @param {?string} paneId - the id of the pane in which to retrieve the currently viewed file\n     * @return {?File} File object of the currently viewed file, or null if there isn't one or there's no such pane\n     */\n    function getCurrentlyViewedFile(paneId) {\n        var pane = _getPane(paneId);\n        return pane ? pane.getCurrentlyViewedFile() : null;\n    }\n\n    /**\n     * Retrieves the currently viewed path of the pane specified by paneId\n     * @param {?string} paneId - the id of the pane in which to retrieve the currently viewed path\n     * @return {?string} the path of the currently viewed file or null if there isn't one\n     */\n    function getCurrentlyViewedPath(paneId) {\n        var file = getCurrentlyViewedFile(paneId);\n        return file ? file.fullPath : null;\n    }\n\n    /**\n     * EditorManager.activeEditorChange handler\n     *   This event is triggered when an visible editor gains focus\n     *   Therefore we need to Activate the pane that the active editor belongs to\n     * @private\n     * @param {!jQuery.Event} e - jQuery Event object\n     * @param {Editor=} current - editor being made the current editor\n     */\n    function _activeEditorChange(e, current) {\n        if (current) {\n            var $container = current.$el.parent().parent(),\n                pane = _getPaneFromElement($container);\n\n            if (pane) {\n                // Editor is a full editor\n                if (pane.id !== _activePaneId) {\n                    // we just need to set the active pane in this case\n                    //  it will dispatch the currentFileChange message as well\n                    //  as dispatching other events when the active pane changes\n                    setActivePaneId(pane.id);\n                }\n            } else {\n                // Editor is an inline editor, find the parent pane\n                var parents = $container.parents(\".view-pane\");\n                if (parents.length === 1) {\n                    $container = $(parents[0]);\n                    pane = _getPaneFromElement($container);\n                    if (pane) {\n                        if (pane.id !== _activePaneId) {\n                            // activate the pane which will put focus in the pane's doc\n                            setActivePaneId(pane.id);\n                            // reset the focus to the inline editor\n                            current.focus();\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n\n    /**\n     * Iterates over the pane or ALL_PANES and calls the callback function for each.\n     * @param {!string} paneId - id of the pane in which to adjust the scroll state, ALL_PANES or ACTIVE_PANE\n     * @param {!function(!pane:Pane):boolean} callback - function to callback on to perform work.\n     * The callback will receive a Pane and should return false to stop iterating.\n     * @private\n     */\n    function _forEachPaneOrPanes(paneId, callback) {\n        if (paneId === ALL_PANES) {\n            _.forEach(_panes, callback);\n        } else {\n            callback(_getPane(paneId));\n        }\n    }\n\n    /**\n     * Caches the specified pane's current scroll state\n     * If there was already cached state for the specified pane, it is discarded and overwritten\n     * @param {!string} paneId - id of the pane in which to cache the scroll state,\n     *                            ALL_PANES or ACTIVE_PANE\n     */\n    function cacheScrollState(paneId) {\n        _forEachPaneOrPanes(paneId, function (pane) {\n            _paneScrollStates[pane.id] = pane.getScrollState();\n        });\n    }\n\n\n    /**\n     * Restores the scroll state from cache and applies the heightDelta\n     * The view implementation is responsible for applying or ignoring the heightDelta.\n     * This is used primarily when a modal bar opens to keep the editor from scrolling the current\n     * page out of view in order to maintain the appearance.\n     * The state is removed from the cache after calling this function.\n     * @param {!string} paneId - id of the pane in which to adjust the scroll state,\n     *                              ALL_PANES or ACTIVE_PANE\n     * @param {!number} heightDelta - delta H to apply to the scroll state\n     */\n    function restoreAdjustedScrollState(paneId, heightDelta) {\n        _forEachPaneOrPanes(paneId, function (pane) {\n            pane.restoreAndAdjustScrollState(_paneScrollStates[pane.id], heightDelta);\n            delete _paneScrollStates[pane.id];\n        });\n    }\n\n\n    /**\n     * Retrieves the WorkingSet for the given paneId not including temporary views\n     * @param {!string} paneId - id of the pane in which to get the view list, ALL_PANES or ACTIVE_PANE\n     * @return {Array.<File>}\n     */\n    function getWorkingSet(paneId) {\n        var result = [];\n\n        _forEachPaneOrPanes(paneId, function (pane) {\n            var viewList = pane.getViewList();\n            result = _.union(result, viewList);\n        });\n\n        return result;\n    }\n\n\n    /**\n     * Retrieves the list of all open files including temporary views\n     * @return {array.<File>} the list of all open files in all open panes\n     */\n    function getAllOpenFiles() {\n        var result = getWorkingSet(ALL_PANES);\n        _.forEach(_panes, function (pane) {\n            var file = pane.getCurrentlyViewedFile();\n            if (file) {\n                result = _.union(result, [file]);\n            }\n        });\n        return result;\n    }\n\n    /**\n     * Retrieves the list of all open pane ids\n     * @return {array.<string>} the list of all open panes\n     */\n    function getPaneIdList() {\n        return Object.keys(_panes);\n    }\n\n    /**\n     * Retrieves the size of the selected pane's view list\n     * @param {!string} paneId - id of the pane in which to get the workingset size.\n     *      Can use `ALL_PANES` or `ACTIVE_PANE`\n     * @return {!number} the number of items in the specified pane\n     */\n    function getWorkingSetSize(paneId) {\n        var result = 0;\n        _forEachPaneOrPanes(paneId, function (pane) {\n            result += pane.getViewListSize();\n        });\n        return result;\n    }\n\n    /**\n     * Retrieves the title to display in the workingset view\n     * @param {!string} paneId - id of the pane in which to get the title\n     * @return {?string} title\n     */\n    function getPaneTitle(paneId) {\n        return _paneTitles[paneId][_orientation];\n    }\n\n    /**\n     * Retrieves the number of panes\n     * @return {number}\n     */\n    function getPaneCount() {\n        return Object.keys(_panes).length;\n    }\n\n    /**\n     * Helper to abastract the common working set search functions\n     * @param {!string} paneId - id of the pane to search or ALL_PANES to search all panes\n     * @param {!string} fullPath - path of the file to locate\n     * @param {!string} method - name of the method to use for searching\n     *       \"findInViewList\", \"findInViewListAddedOrder\" or \"FindInViewListMRUOrder\"\n     *\n     * @private\n     */\n    function _doFindInWorkingSet(paneId, fullPath, method) {\n        var result = -1;\n        _forEachPaneOrPanes(paneId, function (pane) {\n            var index = pane[method].call(pane, fullPath);\n            if (index >= 0) {\n                result = index;\n                return false;\n            }\n        });\n        return result;\n    }\n\n    /**\n     * Finds all instances of the specified file in all working sets.\n     * If there is a temporary view of the file, it is not part of the result set\n     * @param {!string} fullPath - path of the file to find views of\n     * @return {Array.<{pane:string, index:number}>} an array of paneId/index records\n     */\n    function findInAllWorkingSets(fullPath) {\n        var index,\n            result = [];\n\n        _.forEach(_panes, function (pane) {\n            index = pane.findInViewList(fullPath);\n            if (index >= 0) {\n                result.push({paneId: pane.id, index: index});\n            }\n        });\n\n        return result;\n    }\n\n    /**\n     * Gets the index of the file matching fullPath in the workingset\n     * @param {!string} paneId - id of the pane in which to search or ALL_PANES or ACTIVE_PANE\n     * @param {!string} fullPath - full path of the file to search for\n     * @return {number} index, -1 if not found.\n     */\n    function findInWorkingSet(paneId, fullPath) {\n        return _doFindInWorkingSet(paneId, fullPath, \"findInViewList\");\n    }\n\n    /**\n     * Gets the index of the file matching fullPath in the added order workingset\n     * @param {!string} paneId - id of the pane in which to search or ALL_PANES or ACTIVE_PANE\n     * @param {!string} fullPath - full path of the file to search for\n     * @return {number} index, -1 if not found.\n     */\n    function findInWorkingSetByAddedOrder(paneId, fullPath) {\n        return _doFindInWorkingSet(paneId, fullPath, \"findInViewListAddedOrder\");\n    }\n\n    /**\n     * Gets the index of the file matching fullPath in the MRU order workingset\n     * @param {!string} paneId - id of the pane in which to search or ALL_PANES or ACTIVE_PANE\n     * @param {!string} fullPath - full path of the file to search for\n     * @return {number} index, -1 if not found.\n     */\n    function findInWorkingSetByMRUOrder(paneId, fullPath) {\n        return _doFindInWorkingSet(paneId, fullPath, \"findInViewListMRUOrder\");\n    }\n\n    /**\n     * @private\n     * Retrieves pane id where the specified file has been opened. Used to ensure that a file\n     *  is open in only one pane so this will change once support for multiple views is added\n     * The result includes panes with a temporary view of the file not just working set instances\n     * @param {!string} fullPath - full path of the file to search for\n     * @return {?string} pane id where the file has been opened or null if it wasn't found\n     */\n    function _getPaneIdForPath(fullPath) {\n        // Search all working sets and pull off the first one\n        var info = findInAllWorkingSets(fullPath).shift();\n\n        // Look for a view that has not been added to a working set\n        if (!info) {\n            _.forEach(_panes, function (pane) {\n                if (pane.getCurrentlyViewedPath() === fullPath) {\n                    info = {paneId: pane.id};\n                    return false;\n                }\n            });\n        }\n\n        if (!info) {\n            return null;\n        }\n\n        return info.paneId;\n    }\n\n    /**\n     * View states are only saved once every second max.\n     * @type {boolean}\n     * @private\n     */\n    let _viewStateSaveScheduled = false;\n    function _scheduleViewStateSave() {\n        function _saveViewStateAndResetScheduler() {\n            _saveViewState();\n            _viewStateSaveScheduled = false;\n        }\n        if(!_viewStateSaveScheduled){\n            _viewStateSaveScheduled = true;\n            window.setTimeout(_saveViewStateAndResetScheduler, 1000);\n        }\n    }\n\n    /**\n     * Adds the given file to the end of the workingset, if it is not already there.\n     *  This API does not create a view of the file, it just adds it to the working set\n     * Views of files in the working set are persisted and are not destroyed until the user\n     *  closes the file using FILE_CLOSE; Views are created using FILE_OPEN and, when opened, are\n     *  made the current view. If a File is already opened then the file is just made current\n     *  and its view is shown.\n     * @param {!string} paneId - The id of the pane in which to add the file object to or ACTIVE_PANE\n     * @param {!File} file - The File object to add to the workingset\n     * @param {number=} index - Position to add to list (defaults to last); -1 is ignored\n     * @param {boolean=} forceRedraw - If true, a workingset change notification is always sent\n     *    (useful if suppressRedraw was used with removeView() earlier)\n     */\n    function addToWorkingSet(paneId, file, index, force) {\n        // look for the file to have already been added to another pane\n        var pane = _getPane(paneId);\n        if (!pane) {\n            throw new Error(\"invalid pane id: \" + paneId);\n        }\n\n        var result = pane.reorderItem(file, index, force),\n            entry = _makeMRUListEntry(file, pane.id);\n\n\n        // handles the case of save as so that the file remains in the\n        //  the same location in the working set as the file that was renamed\n        if (result === pane.ITEM_FOUND_NEEDS_SORT) {\n            console.warn(\"pane.reorderItem returned pane.ITEM_FOUND_NEEDS_SORT which shouldn't happen \" + file);\n            exports.trigger(\"workingSetSort\", pane.id);\n        } else if (result === pane.ITEM_NOT_FOUND) {\n            index = pane.addToViewList(file, index);\n\n            if (_findFileInMRUList(pane.id, file) === -1) {\n                // Add to or update the position in MRU\n                if (pane.getCurrentlyViewedFile() === file) {\n                    _mruList.unshift(entry);\n                } else {\n                    _mruList.push(entry);\n                }\n            }\n\n            exports.trigger(\"workingSetAdd\", file, index, pane.id);\n        }\n    }\n\n    /**\n     * Adds the given file list to the end of the workingset.\n     * @param {!string} paneId - The id of the pane in which to add the file object to or ACTIVE_PANE\n     * @param {!Array.<File>} fileList - Array of files to add to the pane\n     */\n    function addListToWorkingSet(paneId, fileList) {\n        var uniqueFileList,\n            pane = _getPane(paneId);\n\n        uniqueFileList = pane.addListToViewList(fileList);\n\n        uniqueFileList.forEach(function (file) {\n            if (_findFileInMRUList(pane.id, file) !== -1) {\n                console.log(file.fullPath + \" duplicated in mru list\");\n            }\n            _mruList.push(_makeMRUListEntry(file, pane.id));\n        });\n\n        exports.trigger(\"workingSetAddList\", uniqueFileList, pane.id);\n\n        //  find all of the files that could be added but were not\n        var unsolvedList = fileList.filter(function (item) {\n            // if the file open in another pane, then add it to the list of unsolvedList\n            return (pane.findInViewList(item.fullPath) === -1 && _getPaneIdForPath(item.fullPath));\n        });\n\n        // Use the pane id of the first one in the list for pane id and recurse\n        //  if we add more panes, then this will recurse until all items in the list are satisified\n        if (unsolvedList.length) {\n            addListToWorkingSet(_getPaneIdForPath(unsolvedList[0].fullPath), unsolvedList);\n        }\n    }\n\n    /**\n     * Removes a file from the global MRU list. Future versions of this\n     *  implementation may support the ALL_PANES constant but FOCUS_PANE is not allowed\n     * @param {!string} paneId - Must be a valid paneId (not a shortcut e.g. ALL_PANES)\n     @ @param {File} file The file object to remove.\n     * @private\n     */\n    function _removeFileFromMRU(paneId, file) {\n        var index,\n            compare = function (record) {\n                return (record.file === file && record.paneId === paneId);\n            };\n\n        // find and remove all instances\n        do {\n            index = _.findIndex(_mruList, compare);\n            if (index !== -1) {\n                _mruList.splice(index, 1);\n            }\n        } while (index !== -1);\n    }\n\n    /**\n     * Removes a file the specified pane\n     * @param {!string} paneId - Must be a valid paneId (not a shortcut e.g. ALL_PANES)\n     * @param {!File} file - the File to remove\n     * @param {boolean=} suppressRedraw - true to tell listeners not to redraw\n     *          Use the suppressRedraw flag when calling this function along with many changes to prevent flicker\n     * @private\n     */\n    function _removeView(paneId, file, suppressRedraw) {\n        var pane = _getPane(paneId);\n\n        if (pane.removeView(file)) {\n            _removeFileFromMRU(pane.id, file);\n            exports.trigger(\"workingSetRemove\", file, suppressRedraw, pane.id);\n        }\n    }\n\n    /**\n     * moves a view from one pane to another\n     * @param {!string} sourcePaneId - id of the source pane\n     * @param {!string} destinationPaneId - id of the destination pane\n     * @param {!File} file - the File to move\n     * @param {Number} destinationIndex - the working set index of the file in the destination pane\n     * @return {jQuery.Promise} a promise that resolves when the move has completed.\n     * @private\n     */\n    function _moveView(sourcePaneId, destinationPaneId, file, destinationIndex) {\n        var result = new $.Deferred(),\n            sourcePane = _getPane(sourcePaneId),\n            destinationPane = _getPane(destinationPaneId);\n\n        sourcePane.moveView(file, destinationPane, destinationIndex)\n            .done(function () {\n                // remove existing entry from mrulist for the same document if present\n                _removeFileFromMRU(destinationPane.id, file);\n                // update the mru list\n                _mruList.every(function (record) {\n                    if (record.file === file && record.paneId === sourcePane.id) {\n                        record.paneId = destinationPane.id;\n                        return false;\n                    }\n                    return true;\n                });\n                exports.trigger(\"workingSetMove\", file, sourcePane.id, destinationPane.id);\n                result.resolve();\n            });\n\n        return result.promise();\n    }\n\n    /**\n     * Switch between panes\n     */\n    function switchPaneFocus() {\n        var $firstPane = $('#first-pane'), $secondPane = $('#second-pane');\n        if($firstPane.hasClass('active-pane')) {\n            $secondPane.click();\n        }        else {\n            $firstPane.click();\n        }\n    }\n\n    /**\n     * DocumentManager.pathDeleted Event handler to remove a file\n     * from the MRU list\n     * @param {!jQuery.event} e -\n     * @param {!string} fullPath - path of the file to remove\n     * @private\n     */\n    function _removeDeletedFileFromMRU(e, fullPath) {\n        var index,\n            compare = function (record) {\n                return (record.file.fullPath === fullPath);\n            };\n\n        // find and remove all instances\n        do {\n            index = _.findIndex(_mruList, compare);\n            if (index !== -1) {\n                _mruList.splice(index, 1);\n            }\n        } while (index !== -1);\n    }\n\n    /**\n     * sorts the pane's view list\n     * @param {!string} paneId - id of the pane to sort, ALL_PANES or ACTIVE_PANE\n     * @param {sortFunctionCallback} compareFn - callback to determine sort order (called on each item)\n     * @see {@link Pane#sortViewList} for more information\n     * @see {@link https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/sort|Sort Array - MDN}\n     * @private\n     */\n    function _sortWorkingSet(paneId, compareFn) {\n        _forEachPaneOrPanes(paneId, function (pane) {\n            pane.sortViewList(compareFn);\n            exports.trigger(\"workingSetSort\", pane.id);\n        });\n    }\n\n    /**\n     * moves a working set item from one index to another shifting the items\n     * after in the working set up and reinserting it at the desired location\n     * @param {!string} paneId - id of the pane to sort\n     * @param {!number} fromIndex - the index of the item to move\n     * @param {!number} toIndex - the index to move to\n     * @private\n     */\n    function _moveWorkingSetItem(paneId, fromIndex, toIndex) {\n        var pane = _getPane(paneId);\n\n        pane.moveWorkingSetItem(fromIndex, toIndex);\n        exports.trigger(\"workingSetSort\", pane.id);\n        exports.trigger(\"_workingSetDisableAutoSort\", pane.id);\n    }\n\n    /**\n     * Mutually exchanges the files at the indexes passed by parameters.\n     * @param {!string} paneId - id of the pane to swap indices or ACTIVE_PANE\n     * @param {!number} index1 - the index on the left\n     * @param {!number} index2 - the index on the rigth\n     * @private\n     */\n    function _swapWorkingSetListIndexes(paneId, index1, index2) {\n        var pane = _getPane(paneId);\n\n        pane.swapViewListIndexes(index1, index2);\n        exports.trigger(\"workingSetSort\", pane.id);\n        exports.trigger(\"_workingSetDisableAutoSort\", pane.id);\n    }\n\n    /**\n     * Get the next or previous file in the MRU list.\n     * @param {!number} direction - Must be 1 or -1 to traverse forward or backward\n     * @return {?{file:File, paneId:string}} The File object of the next item in the traversal order or null if there aren't any files to traverse.\n     *                                       May return current file if there are no other files to traverse.\n     */\n    function traverseToNextViewByMRU(direction) {\n        var file = getCurrentlyViewedFile(),\n            paneId = getActivePaneId(),\n            index = _.findIndex(_mruList, function (record) {\n                return (record.file === file && record.paneId === paneId);\n            });\n\n        return ViewUtils.traverseViewArray(_mruList, index, direction);\n    }\n\n    /**\n     * Get the next or previous file in list order.\n     * @param {!number} direction - Must be 1 or -1 to traverse forward or backward\n     * @return {?{file:File, paneId:string}} The File object of the next item in the traversal order or null if there aren't any files to traverse.\n     *                                       May return current file if there are no other files to traverse.\n     */\n    function traverseToNextViewInListOrder(direction) {\n        var file = getCurrentlyViewedFile(),\n            curPaneId = getActivePaneId(),\n            allFiles = [],\n            index;\n\n        getPaneIdList().forEach(function (paneId) {\n            var paneFiles = getWorkingSet(paneId).map(function (file) {\n                return { file: file, pane: paneId };\n            });\n            allFiles = allFiles.concat(paneFiles);\n        });\n\n        index = _.findIndex(allFiles, function (record) {\n            return (record.file === file && record.pane === curPaneId);\n        });\n\n        return ViewUtils.traverseViewArray(allFiles, index, direction);\n    }\n\n    /**\n     * Indicates that traversal has begun.\n     * Can be called any number of times.\n     */\n    function beginTraversal() {\n        _traversingFileList = true;\n    }\n\n    /**\n     * Un-freezes the MRU list after one or more beginTraversal() calls.\n     * Whatever file is current is bumped to the front of the MRU list.\n     */\n    function endTraversal() {\n        var pane = _getPane(ACTIVE_PANE);\n\n        if (_traversingFileList) {\n            _traversingFileList = false;\n\n            _makeFileMostRecent(pane.id, pane.getCurrentlyViewedFile());\n        }\n    }\n\n    /**\n     * Synchronizes the pane's sizer element, updates the pane's resizer maxsize value\n     *   and tells the pane to update its layout\n     * @param {boolean} forceRefresh - true to force a resize and refresh of the entire view\n     * @private\n     */\n    function _synchronizePaneSize(pane, forceRefresh) {\n        var available;\n\n        if (_orientation === VERTICAL) {\n            available = _$el.innerWidth();\n        } else {\n            available = _$el.innerHeight();\n        }\n\n        // Update the pane's sizer element if it has one and update the max size\n        Resizer.resyncSizer(pane.$el);\n        pane.$el.data(\"maxsize\", available - MIN_PANE_SIZE);\n        pane.updateLayout(forceRefresh);\n    }\n\n\n    /**\n     * Event handler for \"workspaceUpdateLayout\" to update the layout\n     * @param {jQuery.Event} event - jQuery event object\n     * @param {number} viewAreaHeight - unused\n     * @param {boolean} forceRefresh - true to force a resize and refresh of the entire view\n     * @private\n     */\n    function _updateLayout(event, viewAreaHeight, forceRefresh) {\n        var available;\n\n        if (_orientation === VERTICAL) {\n            available = _$el.innerWidth();\n        } else {\n            available = _$el.innerHeight();\n        }\n\n        _.forEach(_panes, function (pane) {\n            // For VERTICAL orientation, we set the second pane to be width: auto\n            //  so that it resizes to fill the available space in the containing div\n            // unfortunately, that doesn't work in the HORIZONTAL orientation so we\n            //  must update the height and convert it into a percentage\n            if (pane.id === SECOND_PANE && _orientation === HORIZONTAL) {\n                var percentage = ((_panes[FIRST_PANE].$el.height() + 1) / available);\n                pane.$el.css(\"height\", 100 - (percentage * 100) + \"%\");\n            }\n\n            _synchronizePaneSize(pane, forceRefresh);\n        });\n    }\n\n    /**\n     * Sets up the initial layout so panes are evenly distributed\n     * This also sets css properties that aid in the layout when _updateLayout is called\n     * @param {boolean} forceRefresh - true to force a resize and refresh of the entire view\n     * @private\n     */\n    function _initialLayout(forceRefresh) {\n        var panes = Object.keys(_panes),\n            size = 100 / panes.length;\n\n        _.forEach(_panes, function (pane) {\n            if (pane.id === FIRST_PANE) {\n                if (_orientation === VERTICAL) {\n                    pane.$el.css({height: \"100%\",\n                        width: size + \"%\",\n                        float: \"left\"\n                    });\n                } else {\n                    pane.$el.css({ height: size + \"%\",\n                        width: \"100%\"\n                    });\n                }\n            } else {\n                if (_orientation === VERTICAL) {\n                    pane.$el.css({  height: \"100%\",\n                        width: \"auto\",\n                        float: \"none\"\n                    });\n                } else {\n                    pane.$el.css({ width: \"100%\",\n                        height: \"50%\"\n                    });\n                }\n            }\n\n            _synchronizePaneSize(pane, forceRefresh);\n        });\n    }\n\n    /**\n     * Updates the header text for all panes\n     */\n    function _updatePaneHeaders() {\n        _forEachPaneOrPanes(ALL_PANES, function (pane) {\n            pane.updateHeaderText();\n        });\n\n    }\n\n    /**\n     * Creates a pane for paneId if one doesn't already exist\n     * @param {!string} paneId - id of the pane to create\n     * @private\n     * @return {?Pane} - the pane object of the new pane, or undefined if no pane created\n     */\n    function _createPaneIfNecessary(paneId) {\n        var newPane;\n\n        if (!_panes.hasOwnProperty(paneId)) {\n            newPane = new Pane(paneId, _$el);\n            _panes[paneId] = newPane;\n\n            exports.trigger(\"paneCreate\", newPane.id);\n\n            newPane.$el.on(\"click.mainview dragover.mainview\", function () {\n                setActivePaneId(newPane.id);\n            });\n\n            newPane.on(\"viewListChange.mainview\", function () {\n                _updatePaneHeaders();\n                exports.trigger(\"workingSetUpdate\", newPane.id);\n            });\n            newPane.on(\"currentViewChange.mainview\", function (e, newView, oldView) {\n                _updatePaneHeaders();\n                if (_activePaneId === newPane.id) {\n                    exports.trigger(\"currentFileChange\",\n                                               newView && newView.getFile(),\n                                               newPane.id, oldView && oldView.getFile(),\n                                               newPane.id);\n                }\n            });\n            newPane.on(\"viewDestroy.mainView\", function (e, view) {\n                _removeFileFromMRU(newPane.id, view.getFile());\n            });\n        }\n\n        return newPane;\n    }\n\n    /**\n     * Makes the first pane resizable\n     * @private\n     */\n    function _makeFirstPaneResizable() {\n        var firstPane = _panes[FIRST_PANE];\n        Resizer.makeResizable(firstPane.$el,\n                              _orientation === HORIZONTAL ? Resizer.DIRECTION_VERTICAL : Resizer.DIRECTION_HORIZONTAL,\n                              _orientation === HORIZONTAL ? Resizer.POSITION_BOTTOM : Resizer.POSITION_RIGHT,\n                              MIN_PANE_SIZE, false, false, false,\n            true, undefined, true);\n\n        firstPane.$el.on(\"panelResizeUpdate\", function () {\n            _updateLayout();\n        });\n    }\n\n\n    /**\n     * Creates a split for the specified orientation\n     * @private\n     * @param {!string} orientation (VERTICAL|HORIZONTAL)\n     */\n    function _doSplit(orientation) {\n        var firstPane, newPane;\n\n        if (orientation === _orientation) {\n            return;\n        }\n\n        firstPane = _panes[FIRST_PANE];\n        Resizer.removeSizable(firstPane.$el);\n\n        if (_orientation) {\n            _$el.removeClass(\"split-\" + _orientation.toLowerCase());\n        }\n        _$el.addClass(\"split-\" + orientation.toLowerCase());\n\n        _orientation = orientation;\n        newPane = _createPaneIfNecessary(SECOND_PANE);\n        _makeFirstPaneResizable();\n\n        // reset the layout to 50/50 split\n        // if we changed orientation then\n        //  the percentages are reset as well\n        _initialLayout();\n\n        exports.trigger(\"paneLayoutChange\", _orientation);\n\n        // if new pane was created, and original pane is not empty, make new pane the active pane\n        if (newPane && getCurrentlyViewedFile(firstPane.id)) {\n            setActivePaneId(newPane.id);\n        }\n    }\n\n    /**\n     * Edits a document in the specified pane.\n     * This function is only used by:\n     *  - Unit Tests (which construct Mock Document objects),\n     *  - by File > New  because there is yet to be an established File object\n     *  - by Find In Files which needs to open documents synchronously in some cases\n     * Do not use this API it is for internal use only\n     * @param {!string} paneId - id of the pane in which to open the document\n     * @param {!Document} doc - document to edit\n     * @param {{noPaneActivate:boolean=}=} optionsIn - options\n     * @private\n     */\n    function _edit(paneId, doc, optionsIn) {\n        var options = optionsIn || {};\n\n        var pane = _getPane(paneId);\n\n        // If file is untitled or otherwise not within project tree, add it to\n        // working set right now (don't wait for it to become dirty)\n        if (doc.isUntitled() || !ProjectManager.isWithinProject(doc.file.fullPath)) {\n            addToWorkingSet(paneId, doc.file);\n        }\n\n        // open document will show the editor if there is one already\n        EditorManager.openDocument(doc, pane, options);\n        _makeFileMostRecent(paneId, doc.file);\n\n        if (!options.noPaneActivate) {\n            setActivePaneId(paneId);\n        }\n    }\n\n    /**\n     * Opens a file in the specified pane this can be used to open a file with a custom viewer\n     * or a document for editing.  If it's a document for editing, edit is called on the document\n     * @param {!string} paneId - id of the pane in which to open the document\n     * @param {!File} file - file to open\n     * @param {{noPaneActivate:boolean=}=} optionsIn - options\n     * @return {jQuery.Promise}  promise that resolves to a File object or\n     *                           rejects with a File error or string\n     */\n    function _open(paneId, file, optionsIn) {\n        var result = new $.Deferred(),\n            options = optionsIn || {};\n\n        function doPostOpenActivation() {\n            if (!options.noPaneActivate) {\n                setActivePaneId(paneId);\n            }\n        }\n\n        if (!file || !_getPane(paneId)) {\n            return result.reject(\"bad argument\").promise();\n        }\n\n\n        // See if there is already a view for the file\n        var pane = _getPane(paneId);\n\n        // See if there is a factory to create a view for this file\n        //  we want to do this first because, we don't want our internal\n        //  editor to edit files for which there are suitable viewfactories\n        var factory = MainViewFactory.findSuitableFactoryForPath(file.fullPath);\n\n        if (factory) {\n            file.exists(function (fileError, fileExists) {\n                if (fileExists) {\n                    // let the factory open the file and create a view for it\n                    factory.openFile(file, pane)\n                        .done(function () {\n                            // if we opened a file that isn't in the project\n                            //  then add the file to the working set\n                            if (!ProjectManager.isWithinProject(file.fullPath)) {\n                                addToWorkingSet(paneId, file);\n                            }\n                            doPostOpenActivation();\n                            result.resolve(file);\n                        })\n                        .fail(function (fileError) {\n                            result.reject(fileError);\n                        });\n                } else {\n                    result.reject(fileError || FileSystemError.NOT_FOUND);\n                }\n            });\n        } else {\n            DocumentManager.getDocumentForPath(file.fullPath, file)\n                .done(function (doc) {\n                    if (doc) {\n                        _edit(paneId, doc, $.extend({}, options, {\n                            noPaneActivate: true\n                        }));\n                        doPostOpenActivation();\n                        result.resolve(doc.file);\n                    } else {\n                        result.resolve(null);\n                    }\n                })\n                .fail(function (fileError) {\n                    result.reject(fileError);\n                });\n        }\n\n        result.done(function () {\n            _makeFileMostRecent(paneId, file);\n        });\n\n        return result;\n    }\n\n    /**\n     * Merges second pane into first pane and opens the current file\n     * @private\n     */\n    function _mergePanes() {\n        if (_panes.hasOwnProperty(SECOND_PANE)) {\n\n            var firstPane = _panes[FIRST_PANE],\n                secondPane = _panes[SECOND_PANE],\n                fileList = secondPane.getViewList(),\n                lastViewed = getCurrentlyViewedFile();\n\n            Resizer.removeSizable(firstPane.$el);\n            firstPane.mergeFrom(secondPane);\n\n            exports.trigger(\"workingSetRemoveList\", fileList, secondPane.id);\n\n            setActivePaneId(firstPane.id);\n\n            secondPane.$el.off(\".mainview\");\n            secondPane.off(\".mainview\");\n\n            secondPane.destroy();\n            delete _panes[SECOND_PANE];\n            exports.trigger(\"paneDestroy\", secondPane.id);\n            exports.trigger(\"workingSetAddList\", fileList, firstPane.id);\n\n            _mruList.forEach(function (record) {\n                if (record.paneId === secondPane.id) {\n                    record.paneId = firstPane.id;\n                }\n            });\n\n            _$el.removeClass(\"split-\" + _orientation.toLowerCase());\n            _orientation = null;\n            // this will set the remaining pane to 100%\n            _initialLayout();\n\n            exports.trigger(\"paneLayoutChange\", _orientation);\n\n            // if the current view before the merger was in the pane\n            //  that went away then reopen it so that it's now the current view again\n            if (lastViewed && getCurrentlyViewedFile() !== lastViewed) {\n                exports._open(firstPane.id, lastViewed);\n            }\n        }\n    }\n\n    /**\n     * Closes a file in the specified pane or panes\n     * @param {!string} paneId - id of the pane in which to open the document\n     * @param {!File} file - file to close\n     * @param {Object={noOpenNextFile:boolean}} optionsIn - options\n     * This function does not fail if the file is not open\n     */\n    function _close(paneId, file, optionsIn) {\n        var options = optionsIn || {};\n        _forEachPaneOrPanes(paneId, function (pane) {\n            if (pane.removeView(file, options.noOpenNextFile) && (paneId === ACTIVE_PANE || pane.id === paneId)) {\n                _removeFileFromMRU(pane.id, file);\n                exports.trigger(\"workingSetRemove\", file, false, pane.id);\n                return false;\n            }\n        });\n    }\n\n    /**\n     * Closes a list of file in the specified pane or panes\n     * @param {!string} paneId - id of the pane in which to open the document\n     * @param {!Array.<File>} fileList - files to close\n     * This function does not fail if the file is not open\n     */\n    function _closeList(paneId, fileList) {\n        _forEachPaneOrPanes(paneId, function (pane) {\n            var closedList = pane.removeViews(fileList);\n            closedList.forEach(function (file) {\n                _removeFileFromMRU(pane.id, file);\n            });\n\n            exports.trigger(\"workingSetRemoveList\", closedList, pane.id);\n        });\n    }\n\n    /**\n     * Closes all files in the specified pane or panes\n     * @param {!string} paneId - id of the pane in which to open the document\n     * This function does not fail if the file is not open\n     */\n    function _closeAll(paneId) {\n        _forEachPaneOrPanes(paneId, function (pane) {\n            var closedList = pane.getViewList();\n            closedList.forEach(function (file) {\n                _removeFileFromMRU(pane.id, file);\n            });\n\n            pane._reset();\n            exports.trigger(\"workingSetRemoveList\", closedList, pane.id);\n        });\n    }\n\n\n    /**\n     * Finds which pane a document belongs to\n     * @param {!Document} document - the document to locate\n     * @return {?Pane} the pane where the document lives or NULL if it isn't in a pane\n     * @private\n     */\n    function _findPaneForDocument(document) {\n        // First check for an editor view of the document\n        var pane = _getPaneFromElement($(document._masterEditor.$el.parent().parent()));\n\n        if (!pane) {\n            // No view of the document, it may be in a working set and not yet opened\n            var info = findInAllWorkingSets(document.file.fullPath).shift();\n            if (info) {\n                pane = _panes[info.paneId];\n            }\n        }\n\n        return pane;\n    }\n\n    /**\n     * Destroys an editor object if a document is no longer referenced\n     * @param {!Document} doc - document to destroy\n     */\n    function _destroyEditorIfNotNeeded(document) {\n        if (!(document instanceof DocumentManager.Document)) {\n            throw new Error(\"_destroyEditorIfUnneeded() should be passed a Document\");\n        }\n        if (document._masterEditor) {\n            // findPaneForDocument tries to locate the pane in which the document\n            //  is either opened or will be opened (in the event that the document is\n            //  in a working set but has yet to be opened) and then asks the pane\n            //  to destroy the view if it doesn't need it anymore\n            var pane = _findPaneForDocument(document);\n\n            if (pane) {\n                // let the pane deceide if it wants to destroy the view if it's no needed\n                pane.destroyViewIfNotNeeded(document._masterEditor);\n            } else {\n                // in this case, the document isn't referenced at all so just destroy it\n                document._masterEditor.destroy();\n            }\n        }\n    }\n\n\n    /**\n     * Loads the workingset state\n     * @private\n     */\n    function _loadViewState(e) {\n        // file root is appended for each project\n        var panes,\n            promises = [],\n            context = { location: { scope: \"user\",\n                layer: \"project\" } },\n            state = PreferencesManager.getViewState(PREFS_NAME, context);\n\n        function convertViewState() {\n            var context = { location: { scope: \"user\",\n                    layer: \"project\" } },\n                files = PreferencesManager.getViewState(OLD_PREFS_NAME, context);\n\n            if (!files) {\n                // nothing to convert\n                return;\n            }\n\n            var result = {\n                orientation: null,\n                activePaneId: FIRST_PANE,\n                panes: {\n                    \"first-pane\": []\n                }\n            };\n\n            // Add all files to the workingset without verifying that\n            // they still exist on disk (for faster project switching)\n            files.forEach(function (value) {\n                result.panes[FIRST_PANE].push(value);\n            });\n\n            return result;\n        }\n\n        if (!state) {\n            // not converted yet\n            state = convertViewState();\n        }\n\n        // reset\n        _mergePanes();\n        _mruList = [];\n        ViewStateManager.reset();\n\n        if (state) {\n\n            panes = Object.keys(state.panes);\n            _orientation = (panes.length > 1) ? state.orientation : null;\n\n            _.forEach(state.panes, function (paneState, paneId) {\n                _createPaneIfNecessary(paneId);\n                promises.push(_panes[paneId].loadState(paneState));\n            });\n\n            AsyncUtils.waitForAll(promises).then(function (opensList) {\n\n                // this will set the default layout of 50/50 or 100\n                //  based on the number of panes\n                _initialLayout();\n\n                // More than 1 pane, then make it resizable\n                //  and layout the panes from serialized state\n                if (panes.length > 1) {\n                    _makeFirstPaneResizable();\n\n                    // If the split state was serialized correctly\n                    //  then setup the splits according to was serialized\n                    // Avoid a zero and negative split percentages\n                    if ($.isNumeric(state.splitPercentage) && state.splitPercentage > 0) {\n                        var prop;\n                        if (_orientation === VERTICAL) {\n                            prop = \"width\";\n                        } else {\n                            prop = \"height\";\n                        }\n\n                        _panes[FIRST_PANE].$el.css(prop, state.splitPercentage * 100 + \"%\");\n                        _updateLayout();\n                    }\n                }\n\n                if (_orientation) {\n                    _$el.addClass(\"split-\" + _orientation.toLowerCase());\n                    exports.trigger(\"paneLayoutChange\", _orientation);\n                }\n\n                _.forEach(_panes, function (pane) {\n                    var fileList = pane.getViewList();\n\n                    fileList.forEach(function (file) {\n                        if (_findFileInMRUList(pane.id, file) !== -1) {\n                            console.log(file.fullPath + \" duplicated in mru list\");\n                        }\n                        _mruList.push(_makeMRUListEntry(file, pane.id));\n                    });\n                    exports.trigger(\"workingSetAddList\", fileList, pane.id);\n                });\n\n                promises = [];\n\n                opensList.forEach(function (openData) {\n                    if (openData) {\n                        promises.push(CommandManager.execute(Commands.FILE_OPEN, openData));\n                    }\n                });\n\n                // finally set the active pane\n                AsyncUtils.waitForAll(promises).then(function () {\n                    setActivePaneId(state.activePaneId);\n                });\n            });\n        }\n    }\n\n    /**\n     * Saves the workingset state\n     * @private\n     */\n    function _saveViewState() {\n        function _computeSplitPercentage() {\n            var available,\n                used;\n\n            if (getPaneCount() === 1) {\n                // just short-circuit here and\n                //  return 100% to avoid any rounding issues\n                return 1;\n            }\n            if (_orientation === VERTICAL) {\n                available = _$el.innerWidth();\n                used = _panes[FIRST_PANE].$el.width();\n            } else {\n                available = _$el.innerHeight();\n                used = _panes[FIRST_PANE].$el.height();\n            }\n\n            return used / available;\n\n        }\n\n        let projectRoot     = ProjectManager.getProjectRoot();\n        if (!projectRoot) {\n            return;\n        }\n\n        let context         = { location: { scope: \"user\",\n                layer: \"project\",\n                layerID: projectRoot.fullPath } },\n\n            state = {\n                orientation: _orientation,\n                activePaneId: getActivePaneId(),\n                splitPercentage: _computeSplitPercentage(),\n                panes: {\n                }\n            };\n\n        _.forEach(_panes, function (pane) {\n            state.panes[pane.id] = pane.saveState();\n        });\n\n        PreferencesManager.setViewState(PREFS_NAME, state, context);\n    }\n\n    /**\n     * Initializes the MainViewManager's view state\n     * @param {jQuery} $container - the container where the main view will live\n     * @private\n     */\n    function _initialize($container) {\n        if (_activePaneId) {\n            throw new Error(\"MainViewManager has already been initialized\");\n        }\n\n        _$el = $container;\n        _createPaneIfNecessary(FIRST_PANE);\n        _activePaneId = FIRST_PANE;\n        // One-time init so the pane has the \"active\" appearance\n        _panes[FIRST_PANE]._handleActivePaneChange(undefined, _activePaneId);\n        _initialLayout();\n\n        // This ensures that unit tests that use this function\n        //  get an event handler for workspace events and we don't listen\n        //  to the event before we've been initialized\n        WorkspaceManager.on(\"workspaceUpdateLayout\", _updateLayout);\n\n        exports.on(\"currentFileChange\", _scheduleViewStateSave);\n        exports.on(\"paneLayoutChange\", _scheduleViewStateSave);\n\n        // Listen to key Alt-W to toggle between panes\n        CommandManager.register(Strings.CMD_SWITCH_PANE_FOCUS, Commands.CMD_SWITCH_PANE_FOCUS, switchPaneFocus);\n        KeyBindingManager.addBinding(Commands.CMD_SWITCH_PANE_FOCUS, {key: 'Alt-P'});\n    }\n\n    /**\n     * Changes the layout scheme\n     * @param {!number} rows (may be 1 or 2)\n     * @param {!number} columns (may be 1 or 2)\n     * @summay Rows or Columns may be 1 or 2 but both cannot be 2. 1x2, 2x1 or 1x1 are the legal values\n     */\n    function setLayoutScheme(rows, columns) {\n        if ((rows < 1) || (rows > 2) || (columns < 1) || (columns > 2) || (columns === 2 && rows === 2)) {\n            console.error(\"setLayoutScheme unsupported layout \" + rows + \", \" + columns);\n            return false;\n        }\n\n        if (rows === columns) {\n            _mergePanes();\n        } else if (rows > columns) {\n            _doSplit(HORIZONTAL);\n        } else {\n            _doSplit(VERTICAL);\n        }\n        return true;\n    }\n\n    /**\n     * Retrieves the current layout scheme\n     * @return {!{rows: number, columns: number>}}\n     */\n    function getLayoutScheme() {\n        var result = {\n            rows: 1,\n            columns: 1\n        };\n\n        if (_orientation === HORIZONTAL) {\n            result.rows = 2;\n        } else if (_orientation === VERTICAL) {\n            result.columns = 2;\n        }\n\n        return result;\n    }\n\n\n    /**\n     * Setup a ready event to initialize ourself\n     */\n    AppInit.htmlReady(function () {\n        _initialize($(\"#editor-holder\"));\n    });\n\n    // Event handlers - not safe to call on() directly, due to circular dependencies\n    EventDispatcher.on_duringInit(ProjectManager, \"projectOpen\",                       _loadViewState);\n    EventDispatcher.on_duringInit(ProjectManager, \"beforeProjectClose beforeAppClose\", _saveViewState);\n    EventDispatcher.on_duringInit(EditorManager, \"activeEditorChange\",                 _activeEditorChange);\n    EventDispatcher.on_duringInit(DocumentManager, \"pathDeleted\",                      _removeDeletedFileFromMRU);\n\n\n    EventDispatcher.makeEventDispatcher(exports);\n    // currentFileChange has a large number of listeners. so we raise warning threshold to 25\n    EventDispatcher.setLeakThresholdForEvent(\"currentFileChange\", 25);\n\n    // Unit Test Helpers\n    exports._initialize                   = _initialize;\n    exports._getPane                      = _getPane;\n\n    // Private Helpers\n    exports._removeView                   = _removeView;\n    exports._moveView                     = _moveView;\n\n    // Private API\n    exports._sortWorkingSet               = _sortWorkingSet;\n    exports._moveWorkingSetItem           = _moveWorkingSetItem;\n    exports._swapWorkingSetListIndexes    = _swapWorkingSetListIndexes;\n    exports._destroyEditorIfNotNeeded     = _destroyEditorIfNotNeeded;\n    exports._edit                         = _edit;\n    exports._open                         = _open;\n    exports._close                        = _close;\n    exports._closeAll                     = _closeAll;\n    exports._closeList                    = _closeList;\n    exports._getPaneIdForPath             = _getPaneIdForPath;\n\n    // WorkingSet Management\n    exports.addToWorkingSet               = addToWorkingSet;\n    exports.addListToWorkingSet           = addListToWorkingSet;\n    exports.getWorkingSetSize             = getWorkingSetSize;\n    exports.getWorkingSet                 = getWorkingSet;\n\n    // Pane state\n    exports.cacheScrollState              = cacheScrollState;\n    exports.restoreAdjustedScrollState    = restoreAdjustedScrollState;\n\n    // Searching\n    exports.findInWorkingSet              = findInWorkingSet;\n    exports.findInWorkingSetByAddedOrder  = findInWorkingSetByAddedOrder;\n    exports.findInWorkingSetByMRUOrder    = findInWorkingSetByMRUOrder;\n    exports.findInAllWorkingSets          = findInAllWorkingSets;\n    exports.findInGlobalMRUList           = _findFileInMRUList;\n\n    // Traversal\n    exports.beginTraversal                = beginTraversal;\n    exports.endTraversal                  = endTraversal;\n    exports.traverseToNextViewByMRU       = traverseToNextViewByMRU;\n    exports.traverseToNextViewInListOrder = traverseToNextViewInListOrder;\n\n    // PaneView Attributes\n    exports.getActivePaneId               = getActivePaneId;\n    exports.setActivePaneId               = setActivePaneId;\n    exports.getPaneIdList                 = getPaneIdList;\n    exports.getPaneTitle                  = getPaneTitle;\n    exports.getPaneCount                  = getPaneCount;\n    exports.isExclusiveToPane             = isExclusiveToPane;\n\n    exports.getAllOpenFiles               = getAllOpenFiles;\n    exports.focusActivePane               = focusActivePane;\n    exports.switchPaneFocus               = switchPaneFocus;\n\n    // Layout\n    exports.setLayoutScheme               = setLayoutScheme;\n    exports.getLayoutScheme               = getLayoutScheme;\n\n    // Convenience\n    exports.getCurrentlyViewedFile        = getCurrentlyViewedFile;\n    exports.getCurrentlyViewedPath        = getCurrentlyViewedPath;\n\n    // Constants\n    exports.ALL_PANES                     = ALL_PANES;\n    exports.ACTIVE_PANE                   = ACTIVE_PANE;\n    exports.FIRST_PANE                    = FIRST_PANE;\n    exports.SECOND_PANE                   = SECOND_PANE;\n});\n"],"file":"MainViewManager.js"}