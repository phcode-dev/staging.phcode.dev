{"version":3,"sources":["extensibility/ExtensionManagerDialog.js"],"names":["define","require","exports","module","_","Mustache","Dialogs","DefaultDialogs","FileSystem","FileUtils","Package","Strings","StringUtils","Commands","CommandManager","InstallExtensionDialog","AppInit","Async","KeyEvent","ExtensionManager","ExtensionManagerView","ExtensionManagerViewModel","PreferencesManager","dialogTemplate","_activeTabIndex","_stopEvent","event","stopPropagation","preventDefault","_performChanges","hasRemovedExtensions","hasExtensionsToRemove","hasUpdatedExtensions","hasExtensionsToUpdate","hasDisabledExtensions","hasExtensionsToDisable","buttonLabel","CHANGE_AND_RELOAD","DISABLE_AND_RELOAD","UPDATE_AND_RELOAD","REMOVE_AND_RELOAD","dlg","showModalDialog","DIALOG_ID_CHANGE_EXTENSIONS","CHANGE_AND_RELOAD_TITLE","CHANGE_AND_RELOAD_MESSAGE","className","DIALOG_BTN_CLASS_NORMAL","id","DIALOG_BTN_CANCEL","text","CANCEL","DIALOG_BTN_CLASS_PRIMARY","DIALOG_BTN_OK","$dlg","getElement","one","e","buttonId","removeExtensionsPromise","updateExtensionsPromise","disableExtensionsPromise","removeErrors","updateErrors","disableErrors","find","prop","hide","PROCESSING_EXTENSIONS","append","removeMarkedExtensions","fail","errorArray","updateExtensions","disableMarkedExtensions","waitForAll","always","close","done","execute","APP_RELOAD","ids","dialogs","nextDialog","dialog","shift","title","message","forEach","errorObj","push","item","DIALOG_ID_ERROR","EXTENSION_MANAGER_REMOVE","format","EXTENSION_MANAGER_REMOVE_ERROR","join","length","error","console","formatError","EXTENSION_MANAGER_UPDATE","EXTENSION_MANAGER_UPDATE_ERROR","EXTENSION_MANAGER_DISABLE","EXTENSION_MANAGER_DISABLE_ERROR","cleanupUpdates","unmarkAllForRemoval","unmarkAllForDisabling","_installUsingDragAndDrop","installZips","updateZips","deferred","$","Deferred","validatePromise","brackets","app","getDroppedFiles","err","paths","resolve","doInParallel_aggregateErrors","path","result","file","extension","getFileExtension","isZip","isFile","errStr","getFileErrorString","INVALID_ZIP_FILE","reject","validate","requirePackageJSON","info","errors","map","extensionName","metadata","name","extensionInfo","extensions","isUpdate","installInfo","promise","installPromise","updatePromise","doSequentially","installUsingDialog","then","updateUsingDialog","updateFromDownload","_showDialog","window","alert","views","$search","$searchClear","$modalDlg","context","showRegistry","config","extension_registry","models","modelInitPromise","updateSearchDisabled","model","searchDisabled","val","filterSet","clearSearch","view","index","filter","scrollTop","focus","setActiveTab","$tab","scrollPos","tab","show","updateNotificationIcon","$notificationIcon","eq","notifyCount","RegistryViewModel","ThemesViewModel","InstalledViewModel","DefaultViewModel","showModalDialogUsingTemplate","render","document","off","dispose","on","this","keyCode","DOM_VK_TAB","ctrlKey","$tabs","tabIndex","shiftKey","doInParallel","initialize","lastNotifyCount","searchTimeoutID","remove","$el","appendTo","each","tabElement","clearTimeout","query","setTimeout","sortBy","set","_setSortedExtensionList","$activeTab","parent","removeClass","hasClass","click","showDialog","$dropzone","$dropmask","originalEvent","dataTransfer","files","items","isValidDrop","every","kind","entry","webkitGetAsEntry","fullPath","width","addClass","dropEffect","INSTALL_EXTENSION_DROP_ERROR","breakableUrl","EXTENSION_MANAGER_TITLE","register","CMD_EXTENSION_MANAGER","FILE_EXTENSION_MANAGER","appReady"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2013 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\ndefine(function (require, exports, module) {\n\n\n    var _                           = require(\"thirdparty/lodash\"),\n        Mustache                    = require(\"thirdparty/mustache/mustache\"),\n        Dialogs                     = require(\"widgets/Dialogs\"),\n        DefaultDialogs              = require(\"widgets/DefaultDialogs\"),\n        FileSystem                  = require(\"filesystem/FileSystem\"),\n        FileUtils                   = require(\"file/FileUtils\"),\n        Package                     = require(\"extensibility/Package\"),\n        Strings                     = require(\"strings\"),\n        StringUtils                 = require(\"utils/StringUtils\"),\n        Commands                    = require(\"command/Commands\"),\n        CommandManager              = require(\"command/CommandManager\"),\n        InstallExtensionDialog      = require(\"extensibility/InstallExtensionDialog\"),\n        AppInit                     = require(\"utils/AppInit\"),\n        Async                       = require(\"utils/Async\"),\n        KeyEvent                    = require(\"utils/KeyEvent\"),\n        ExtensionManager            = require(\"extensibility/ExtensionManager\"),\n        ExtensionManagerView        = require(\"extensibility/ExtensionManagerView\").ExtensionManagerView,\n        ExtensionManagerViewModel   = require(\"extensibility/ExtensionManagerViewModel\"),\n        PreferencesManager          = require(\"preferences/PreferencesManager\");\n\n    var dialogTemplate    = require(\"text!htmlContent/extension-manager-dialog.html\");\n\n    // bootstrap tabs component\n    require(\"widgets/bootstrap-tab\");\n\n    var _activeTabIndex;\n\n    function _stopEvent(event) {\n        event.stopPropagation();\n        event.preventDefault();\n    }\n\n    /**\n     * @private\n     * Triggers changes requested by the dialog UI.\n     */\n    function _performChanges() {\n        // If an extension was removed or updated, prompt the user to quit Brackets.\n        var hasRemovedExtensions    = ExtensionManager.hasExtensionsToRemove(),\n            hasUpdatedExtensions    = ExtensionManager.hasExtensionsToUpdate(),\n            hasDisabledExtensions   = ExtensionManager.hasExtensionsToDisable();\n        if (!hasRemovedExtensions && !hasUpdatedExtensions && !hasDisabledExtensions) {\n            return;\n        }\n\n        var buttonLabel = Strings.CHANGE_AND_RELOAD;\n        if (hasRemovedExtensions && !hasUpdatedExtensions && !hasDisabledExtensions) {\n            buttonLabel = Strings.REMOVE_AND_RELOAD;\n        } else if (hasUpdatedExtensions && !hasRemovedExtensions && !hasDisabledExtensions) {\n            buttonLabel = Strings.UPDATE_AND_RELOAD;\n        } else if (hasDisabledExtensions && !hasRemovedExtensions && !hasUpdatedExtensions) {\n            buttonLabel = Strings.DISABLE_AND_RELOAD;\n        }\n\n        var dlg = Dialogs.showModalDialog(\n            DefaultDialogs.DIALOG_ID_CHANGE_EXTENSIONS,\n            Strings.CHANGE_AND_RELOAD_TITLE,\n            Strings.CHANGE_AND_RELOAD_MESSAGE,\n            [\n                {\n                    className: Dialogs.DIALOG_BTN_CLASS_NORMAL,\n                    id: Dialogs.DIALOG_BTN_CANCEL,\n                    text: Strings.CANCEL\n                },\n                {\n                    className: Dialogs.DIALOG_BTN_CLASS_PRIMARY,\n                    id: Dialogs.DIALOG_BTN_OK,\n                    text: buttonLabel\n                }\n            ],\n            false\n        ),\n            $dlg = dlg.getElement();\n\n        $dlg.one(\"buttonClick\", function (e, buttonId) {\n            if (buttonId === Dialogs.DIALOG_BTN_OK) {\n                // Disable the dialog buttons so the user can't dismiss it,\n                // and show a message indicating that we're doing the updates,\n                // in case it takes a long time.\n                $dlg.find(\".dialog-button\").prop(\"disabled\", true);\n                $dlg.find(\".close\").hide();\n                $dlg.find(\".dialog-message\")\n                    .text(Strings.PROCESSING_EXTENSIONS)\n                    .append(\"<span class='spinner inline spin'/>\");\n\n                var removeExtensionsPromise,\n                    updateExtensionsPromise,\n                    disableExtensionsPromise,\n                    removeErrors,\n                    updateErrors,\n                    disableErrors;\n\n                removeExtensionsPromise = ExtensionManager.removeMarkedExtensions()\n                    .fail(function (errorArray) {\n                        removeErrors = errorArray;\n                    });\n                updateExtensionsPromise = ExtensionManager.updateExtensions()\n                    .fail(function (errorArray) {\n                        updateErrors = errorArray;\n                    });\n                disableExtensionsPromise = ExtensionManager.disableMarkedExtensions()\n                    .fail(function (errorArray) {\n                        disableErrors = errorArray;\n                    });\n\n                Async.waitForAll([removeExtensionsPromise, updateExtensionsPromise, disableExtensionsPromise], true)\n                    .always(function () {\n                        dlg.close();\n                    })\n                    .done(function () {\n                        CommandManager.execute(Commands.APP_RELOAD);\n                    })\n                    .fail(function () {\n                        var ids = [],\n                            dialogs = [];\n\n                        function nextDialog() {\n                            var dialog = dialogs.shift();\n                            if (dialog) {\n                                Dialogs.showModalDialog(dialog.dialog, dialog.title, dialog.message)\n                                    .done(nextDialog);\n                            } else {\n                                // Even in case of error condition, we still have to reload\n                                CommandManager.execute(Commands.APP_RELOAD);\n                            }\n                        }\n\n                        if (removeErrors) {\n                            removeErrors.forEach(function (errorObj) {\n                                ids.push(errorObj.item);\n                            });\n                            dialogs.push({\n                                dialog: DefaultDialogs.DIALOG_ID_ERROR,\n                                title: Strings.EXTENSION_MANAGER_REMOVE,\n                                message: StringUtils.format(Strings.EXTENSION_MANAGER_REMOVE_ERROR, ids.join(\", \"))\n                            });\n                        }\n\n                        if (updateErrors) {\n                            // This error case should be very uncommon.\n                            // Just let the user know that we couldn't update\n                            // this extension and log the errors to the console.\n                            ids.length = 0;\n                            updateErrors.forEach(function (errorObj) {\n                                ids.push(errorObj.item);\n                                if (errorObj.error && errorObj.error.forEach) {\n                                    console.error(\"Errors for\", errorObj.item);\n                                    errorObj.error.forEach(function (error) {\n                                        console.error(Package.formatError(error));\n                                    });\n                                } else {\n                                    console.error(\"Error for\", errorObj.item, errorObj);\n                                }\n                            });\n                            dialogs.push({\n                                dialog: DefaultDialogs.DIALOG_ID_ERROR,\n                                title: Strings.EXTENSION_MANAGER_UPDATE,\n                                message: StringUtils.format(Strings.EXTENSION_MANAGER_UPDATE_ERROR, ids.join(\", \"))\n                            });\n                        }\n\n                        if (disableErrors) {\n                            ids.length = 0;\n                            disableErrors.forEach(function (errorObj) {\n                                ids.push(errorObj.item);\n                            });\n                            dialogs.push({\n                                dialog: DefaultDialogs.DIALOG_ID_ERROR,\n                                title: Strings.EXTENSION_MANAGER_DISABLE,\n                                message: StringUtils.format(Strings.EXTENSION_MANAGER_DISABLE_ERROR, ids.join(\", \"))\n                            });\n                        }\n\n                        nextDialog();\n                    });\n            } else {\n                dlg.close();\n                ExtensionManager.cleanupUpdates();\n                ExtensionManager.unmarkAllForRemoval();\n                ExtensionManager.unmarkAllForDisabling();\n            }\n        });\n    }\n\n\n    /**\n     * @private\n     * Install extensions from the local file system using the install dialog.\n     * @return {$.Promise}\n     */\n    function _installUsingDragAndDrop() {\n        var installZips = [],\n            updateZips = [],\n            deferred = new $.Deferred(),\n            validatePromise;\n\n        brackets.app.getDroppedFiles(function (err, paths) {\n            if (err) {\n                // Only possible error is invalid params, silently ignore\n                console.error(err);\n                deferred.resolve();\n                return;\n            }\n\n            // Parse zip files and separate new installs vs. updates\n            validatePromise = Async.doInParallel_aggregateErrors(paths, function (path) {\n                var result = new $.Deferred();\n\n                FileSystem.resolve(path, function (err, file) {\n                    var extension = FileUtils.getFileExtension(path),\n                        isZip = file.isFile && (extension === \"zip\"),\n                        errStr;\n\n                    if (err) {\n                        errStr = FileUtils.getFileErrorString(err);\n                    } else if (!isZip) {\n                        errStr = Strings.INVALID_ZIP_FILE;\n                    }\n\n                    if (errStr) {\n                        result.reject(errStr);\n                        return;\n                    }\n\n                    // Call validate() so that we open the local zip file and parse the\n                    // package.json. We need the name to detect if this zip will be a\n                    // new install or an update.\n                    Package.validate(path, { requirePackageJSON: true }).done(function (info) {\n                        if (info.errors.length) {\n                            result.reject(info.errors.map(Package.formatError).join(\" \"));\n                            return;\n                        }\n\n                        var extensionName = info.metadata.name,\n                            extensionInfo = ExtensionManager.extensions[extensionName],\n                            isUpdate = extensionInfo && !!extensionInfo.installInfo;\n\n                        if (isUpdate) {\n                            updateZips.push(file);\n                        } else {\n                            installZips.push(file);\n                        }\n\n                        result.resolve();\n                    }).fail(function (err) {\n                        result.reject(Package.formatError(err));\n                    });\n                });\n\n                return result.promise();\n            });\n\n            validatePromise.done(function () {\n                var installPromise = Async.doSequentially(installZips, function (file) {\n                    return InstallExtensionDialog.installUsingDialog(file);\n                });\n\n                var updatePromise = installPromise.then(function () {\n                    return Async.doSequentially(updateZips, function (file) {\n                        return InstallExtensionDialog.updateUsingDialog(file).done(function (result) {\n                            ExtensionManager.updateFromDownload(result);\n                        });\n                    });\n                });\n\n                // InstallExtensionDialog displays it's own errors, always\n                // resolve the outer promise\n                updatePromise.always(deferred.resolve);\n            }).fail(function (errorArray) {\n                deferred.reject(errorArray);\n            });\n        });\n\n        return deferred.promise();\n    }\n\n    /**\n     * @private\n     * Show a dialog that allows the user to browse and manage extensions.\n     */\n    function _showDialog() {\n        window.alert(\"coming soon: extensions support.\");\n\n        var dialog,\n            $dlg,\n            views   = [],\n            $search,\n            $searchClear,\n            $modalDlg,\n            context = { Strings: Strings, showRegistry: !!brackets.config.extension_registry },\n            models  = [];\n\n        // Load registry only if the registry URL exists\n        if (context.showRegistry) {\n            models.push(new ExtensionManagerViewModel.RegistryViewModel());\n            models.push(new ExtensionManagerViewModel.ThemesViewModel());\n        }\n\n        models.push(new ExtensionManagerViewModel.InstalledViewModel());\n        models.push(new ExtensionManagerViewModel.DefaultViewModel());\n\n        function updateSearchDisabled() {\n            var model           = models[_activeTabIndex],\n                searchDisabled  = ($search.val() === \"\") &&\n                                  (!model.filterSet || model.filterSet.length === 0);\n\n            $search.prop(\"disabled\", searchDisabled);\n            $searchClear.prop(\"disabled\", searchDisabled);\n\n            return searchDisabled;\n        }\n\n        function clearSearch() {\n            $search.val(\"\");\n            views.forEach(function (view, index) {\n                view.filter(\"\");\n                $modalDlg.scrollTop(0);\n            });\n\n            if (!updateSearchDisabled()) {\n                $search.focus();\n            }\n        }\n\n        // Open the dialog\n        dialog = Dialogs.showModalDialogUsingTemplate(Mustache.render(dialogTemplate, context));\n\n        // On dialog close: clean up listeners & models, and commit changes\n        dialog.done(function () {\n            $(window.document).off(\".extensionManager\");\n\n            models.forEach(function (model) {\n                model.dispose();\n            });\n\n            _performChanges();\n        });\n\n        // Create the view.\n        $dlg = dialog.getElement();\n        $search = $(\".search\", $dlg);\n        $searchClear = $(\".search-clear\", $dlg);\n        $modalDlg = $(\".modal-body\", $dlg);\n\n        function setActiveTab($tab) {\n            if (models[_activeTabIndex]) {\n                models[_activeTabIndex].scrollPos = $modalDlg.scrollTop();\n            }\n            $tab.tab(\"show\");\n            if (models[_activeTabIndex]) {\n                $modalDlg.scrollTop(models[_activeTabIndex].scrollPos || 0);\n                clearSearch();\n                if (_activeTabIndex === 2) {\n                    $(\".ext-sort-group\").hide();\n                } else {\n                    $(\".ext-sort-group\").show();\n                }\n            }\n        }\n\n        // Dialog tabs\n        $dlg.find(\".nav-tabs a\")\n            .on(\"click\", function (event) {\n                setActiveTab($(this));\n            });\n\n        // Navigate through tabs via Ctrl-(Shift)-Tab\n        // (focus may be on document.body if text in extension listing clicked - see #9511)\n        $(window.document).on(\"keyup.extensionManager\", function (event) {\n            if (event.keyCode === KeyEvent.DOM_VK_TAB && event.ctrlKey) {\n                var $tabs = $(\".nav-tabs a\", $dlg),\n                    tabIndex = _activeTabIndex;\n\n                if (event.shiftKey) {\n                    tabIndex--;\n                } else {\n                    tabIndex++;\n                }\n                tabIndex %= $tabs.length;\n                setActiveTab($tabs.eq(tabIndex));\n            }\n        });\n\n        // Update & hide/show the notification overlay on a tab's icon, based on its model's notifyCount\n        function updateNotificationIcon(index) {\n            var model = models[index],\n                $notificationIcon = $dlg.find(\".nav-tabs li\").eq(index).find(\".notification\");\n            if (model.notifyCount) {\n                $notificationIcon.text(model.notifyCount);\n                $notificationIcon.show();\n            } else {\n                $notificationIcon.hide();\n            }\n        }\n\n        // Initialize models and create a view for each model\n        var modelInitPromise = Async.doInParallel(models, function (model, index) {\n            var view    = new ExtensionManagerView(),\n                promise = view.initialize(model),\n                lastNotifyCount;\n\n            promise.always(function () {\n                views[index] = view;\n\n                lastNotifyCount = model.notifyCount;\n                updateNotificationIcon(index);\n            });\n\n            model.on(\"change\", function () {\n                if (lastNotifyCount !== model.notifyCount) {\n                    lastNotifyCount = model.notifyCount;\n                    updateNotificationIcon(index);\n                }\n            });\n\n            return promise;\n        }, true);\n\n        modelInitPromise.always(function () {\n            $(\".spinner\", $dlg).remove();\n\n            views.forEach(function (view) {\n                view.$el.appendTo($modalDlg);\n            });\n\n            // Update search UI before new tab is shown\n            $(\"a[data-toggle='tab']\", $dlg).each(function (index, tabElement) {\n                $(tabElement).on(\"show\", function (event) {\n                    _activeTabIndex = index;\n\n                    // Focus the search input\n                    if (!updateSearchDisabled()) {\n                        $dlg.find(\".search\").focus();\n                    }\n                });\n            });\n\n            // Filter the views when the user types in the search field.\n            var searchTimeoutID;\n            $dlg.on(\"input\", \".search\", function (e) {\n                clearTimeout(searchTimeoutID);\n                var query = $(this).val();\n                searchTimeoutID = setTimeout(function () {\n                    views[_activeTabIndex].filter(query);\n                    $modalDlg.scrollTop(0);\n                }, 200);\n            }).on(\"click\", \".search-clear\", clearSearch);\n\n            // Sort the extension list based on the current selected sorting criteria\n            $dlg.on(\"change\", \".sort-extensions\", function (e) {\n                var sortBy = $(this).val();\n                PreferencesManager.set(\"extensions.sort\", sortBy);\n                models.forEach(function (model, index) {\n                    if (index <= 1) {\n                        model._setSortedExtensionList(ExtensionManager.extensions, index === 1);\n                        views[index].filter($(\".search\").val());\n                    }\n                });\n            });\n\n            // Disable the search field when there are no items in the model\n            models.forEach(function (model, index) {\n                model.on(\"change\", function () {\n                    if (_activeTabIndex === index) {\n                        updateSearchDisabled();\n                    }\n                });\n            });\n\n            var $activeTab = $dlg.find(\".nav-tabs li.active a\");\n            if ($activeTab.length) { // If there's already a tab selected, show it\n                $activeTab.parent().removeClass(\"active\"); // workaround for bootstrap-tab\n                $activeTab.tab(\"show\");\n            } else if ($(\"#toolbar-extension-manager\").hasClass('updatesAvailable')) {\n                // Open dialog to Installed tab if extension updates are available\n                $dlg.find(\".nav-tabs a.installed\").tab(\"show\");\n            } else { // Otherwise show the first tab\n                $dlg.find(\".nav-tabs a:first\").tab(\"show\");\n            }\n            // If activeTab was explicitly selected by user,\n            // then check for the selection\n            // Or if there was an update available since activeTab.length would be 0,\n            // then check for updatesAvailable class in toolbar-extension-manager\n            if (($activeTab.length && $activeTab.hasClass(\"installed\")) || (!$activeTab.length && $(\"#toolbar-extension-manager\").hasClass('updatesAvailable'))) {\n                $(\".ext-sort-group\").hide();\n            } else {\n                $(\".ext-sort-group\").show();\n            }\n        });\n\n        // Handle the 'Install from URL' button.\n        $(\".extension-manager-dialog .install-from-url\")\n            .click(function () {\n                InstallExtensionDialog.showDialog().done(ExtensionManager.updateFromDownload);\n            });\n\n        // Handle the drag/drop zone\n        var $dropzone = $(\"#install-drop-zone\"),\n            $dropmask = $(\"#install-drop-zone-mask\");\n\n        $dropzone\n            .on(\"dragover\", function (event) {\n                _stopEvent(event);\n\n                if (!event.originalEvent.dataTransfer.files) {\n                    return;\n                }\n\n                var items = event.originalEvent.dataTransfer.items,\n                    isValidDrop = false;\n\n                isValidDrop = _.every(items, function (item) {\n                    if (item.kind === \"file\") {\n                        var entry = item.webkitGetAsEntry(),\n                            extension = FileUtils.getFileExtension(entry.fullPath);\n\n                        return entry.isFile && extension === \"zip\";\n                    }\n\n                    return false;\n                });\n\n                if (isValidDrop) {\n                    // Set an absolute width to stabilize the button size\n                    $dropzone.width($dropzone.width());\n\n                    // Show drop styling and message\n                    $dropzone.removeClass(\"drag\");\n                    $dropzone.addClass(\"drop\");\n                } else {\n                    event.originalEvent.dataTransfer.dropEffect = \"none\";\n                }\n            })\n            .on(\"drop\", _stopEvent);\n\n        $dropmask\n            .on(\"dragover\", function (event) {\n                _stopEvent(event);\n                event.originalEvent.dataTransfer.dropEffect = \"copy\";\n            })\n            .on(\"dragleave\", function () {\n                $dropzone.removeClass(\"drop\");\n                $dropzone.addClass(\"drag\");\n            })\n            .on(\"drop\", function (event) {\n                _stopEvent(event);\n\n                if (event.originalEvent.dataTransfer.files) {\n                    // Attempt install\n                    _installUsingDragAndDrop().fail(function (errorArray) {\n                        var message = Strings.INSTALL_EXTENSION_DROP_ERROR;\n\n                        message += \"<ul class='dialog-list'>\";\n                        errorArray.forEach(function (info) {\n                            message += \"<li><span class='dialog-filename'>\";\n                            message += StringUtils.breakableUrl(info.item);\n                            message += \"</span>: \" + info.error + \"</li>\";\n                        });\n                        message += \"</ul>\";\n\n                        Dialogs.showModalDialog(\n                            DefaultDialogs.DIALOG_ID_ERROR,\n                            Strings.EXTENSION_MANAGER_TITLE,\n                            message\n                        );\n                    }).always(function () {\n                        $dropzone.removeClass(\"validating\");\n                        $dropzone.addClass(\"drag\");\n                    });\n\n                    // While installing, show validating message\n                    $dropzone.removeClass(\"drop\");\n                    $dropzone.addClass(\"validating\");\n                }\n            });\n\n        return new $.Deferred().resolve(dialog).promise();\n    }\n\n    CommandManager.register(Strings.CMD_EXTENSION_MANAGER, Commands.FILE_EXTENSION_MANAGER, _showDialog);\n\n    AppInit.appReady(function () {\n        //$(\"#toolbar-extension-manager\").click(_showDialog);\n    });\n\n    // Unit tests\n    exports._performChanges = _performChanges;\n});\n"],"file":"ExtensionManagerDialog.js"}