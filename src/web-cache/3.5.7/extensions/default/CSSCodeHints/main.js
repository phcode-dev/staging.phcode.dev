define(function(require,exports,module){var AppInit=brackets.getModule("utils/AppInit"),ExtensionUtils=brackets.getModule("utils/ExtensionUtils"),CodeHintManager=brackets.getModule("editor/CodeHintManager"),CSSUtils=brackets.getModule("language/CSSUtils"),HTMLUtils=brackets.getModule("language/HTMLUtils"),LanguageManager=brackets.getModule("language/LanguageManager"),PreferencesManager=brackets.getModule("preferences/PreferencesManager"),TokenUtils=brackets.getModule("utils/TokenUtils"),StringMatch=brackets.getModule("utils/StringMatch"),ColorUtils=brackets.getModule("utils/ColorUtils"),Strings=brackets.getModule("strings"),CSSProperties=require("text!CSSProperties.json"),properties=JSON.parse(CSSProperties);PreferencesManager.definePreference("codehint.CssPropHints","boolean",!0,{description:Strings.DESCRIPTION_CSS_PROP_HINTS});var lastContext,stringMatcherOptions={preferPrefixMatches:!0};function CssPropHints(){this.primaryTriggerKeys="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-()",this.secondaryTriggerKeys=":",this.exclusion=null}function formatHints(hints,query){var hasColorSwatch=hints.some(function(token){return token.color});return StringMatch.basicMatchSort(hints),hints.map(function(token){var $hintObj=$("<span>").addClass("brackets-css-hints");return token.stringRanges?token.stringRanges.forEach(function(item){item.matched?$hintObj.append($("<span>").text(item.text).addClass("matched-hint")):$hintObj.append(item.text)}):$hintObj.text(token.value),hasColorSwatch&&($hintObj=ColorUtils.formatColorHint($hintObj,token.color)),$hintObj})}CssPropHints.prototype.getCssStyleText=function(){if("html"===LanguageManager.getLanguageForPath(this.editor.document.file.fullPath).getId()){var text="",styleBlocks;return HTMLUtils.findBlocks(this.editor,"css").forEach(function(styleBlock){text+=styleBlock.text}),text}return this.editor.document.getText()},CssPropHints.prototype.getNamedFlows=function(){return this.namedFlowsCache&&this.namedFlowsCache.cursor.line!==this.cursor.line&&(this.namedFlowsCache=null),this.namedFlowsCache||(this.namedFlowsCache={},this.namedFlowsCache.flows=CSSUtils.extractAllNamedFlows(this.getCssStyleText()),this.namedFlowsCache.cursor={line:this.cursor.line,ch:this.cursor.ch}),this.namedFlowsCache.flows},CssPropHints.prototype.updateExclusion=function(propNameOnly){var textAfterCursor;this.exclusion&&this.info&&(this.info.context===CSSUtils.PROP_NAME?textAfterCursor=this.info.name.substr(this.info.offset):propNameOnly||this.info.context!==CSSUtils.PROP_VALUE||(textAfterCursor=this.info.value.substr(this.info.offset)),CodeHintManager.hasValidExclusion(this.exclusion,textAfterCursor)||(this.exclusion=null))},CssPropHints.prototype.hasHints=function(editor,implicitChar){this.editor=editor;var cursor=this.editor.getCursorPos();return lastContext=null,this.info=CSSUtils.getInfoAtPos(editor,cursor),(this.info.context===CSSUtils.PROP_NAME||this.info.context===CSSUtils.PROP_VALUE)&&(implicitChar?(this.updateExclusion(!1),this.info.context===CSSUtils.PROP_NAME&&(this.exclusion||1!==this.info.offset||implicitChar!==this.info.name[0]||(this.exclusion=this.info.name.substr(this.info.offset))),-1!==this.primaryTriggerKeys.indexOf(implicitChar)||-1!==this.secondaryTriggerKeys.indexOf(implicitChar)):(this.info.context===CSSUtils.PROP_NAME&&(0===this.info.offset?this.exclusion=this.info.name:this.updateExclusion(!0)),!0))},CssPropHints.prototype.getHints=function(implicitChar){this.cursor=this.editor.getCursorPos(),this.info=CSSUtils.getInfoAtPos(this.editor,this.cursor);var needle=this.info.name,valueNeedle="",context=this.info.context,valueArray,type,namedFlows,result,selectInitial=!1;return this.updateExclusion(!0),context===CSSUtils.PROP_VALUE?(selectInitial=!0,"("===implicitChar||(lastContext===CSSUtils.PROP_NAME||(lastContext=CSSUtils.PROP_VALUE,properties[needle]?(this.info.isNewItem||-1===this.info.index||(valueNeedle=(valueNeedle=this.info.values[this.info.index].trim()).substr(0,this.info.offset)),valueArray=properties[needle].values,"named-flow"===(type=properties[needle].type)?(namedFlows=this.getNamedFlows(),valueNeedle.length===this.info.offset&&-1!==namedFlows.indexOf(valueNeedle)&&namedFlows.splice(namedFlows.indexOf(valueNeedle),1),valueArray=valueArray.concat(namedFlows)):"color"===type&&(valueArray=valueArray.concat(ColorUtils.COLOR_NAMES.map(function(color){return{text:color,color:color}}))).push("transparent","currentColor"),{hints:formatHints(result=$.map(valueArray,function(pvalue){var result=StringMatch.stringMatch(pvalue.text||pvalue,valueNeedle,stringMatcherOptions);if(result)return pvalue.color&&(result.color=pvalue.color),result}),valueNeedle),match:null,selectInitial:selectInitial}):null))):context===CSSUtils.PROP_NAME?(-1===this.primaryTriggerKeys.indexOf(implicitChar)&&""===needle||(selectInitial=!0),lastContext===CSSUtils.PROP_VALUE?null:(lastContext=CSSUtils.PROP_NAME,needle=needle.substr(0,this.info.offset),{hints:formatHints(result=$.map(properties,function(pvalues,pname){var result=StringMatch.stringMatch(pname,needle,stringMatcherOptions);if(result)return result}),needle),match:null,selectInitial:selectInitial,handleWideResults:!1})):null},CssPropHints.prototype.insertHint=function(hint){var offset=this.info.offset,cursor=this.editor.getCursorPos(),start={line:-1,ch:-1},end={line:-1,ch:-1},keepHints=!1,adjustCursor=!1,newCursor,ctx;if(hint.jquery&&(hint=hint.text()),this.info.context!==CSSUtils.PROP_NAME&&this.info.context!==CSSUtils.PROP_VALUE)return!1;if(start.line=end.line=cursor.line,start.ch=cursor.ch-offset,this.info.context===CSSUtils.PROP_NAME){keepHints=!0;var textAfterCursor=this.info.name.substr(this.info.offset);0===this.info.name.length||CodeHintManager.hasValidExclusion(this.exclusion,textAfterCursor)?(hint+=": ",end.ch=start.ch,end.ch+=offset,this.exclusion&&(hint+=" ",adjustCursor=!0,newCursor={line:cursor.line,ch:start.ch+hint.length-1},this.exclusion=null)):(end.ch=start.ch+this.info.name.length,(ctx=TokenUtils.getInitialContext(this.editor._codeMirror,cursor)).token.string.length>0&&!/\S/.test(ctx.token.string)&&TokenUtils.moveNextToken(ctx),TokenUtils.moveSkippingWhitespace(TokenUtils.moveNextToken,ctx)&&":"===ctx.token.string?(adjustCursor=!0,newCursor={line:cursor.line,ch:cursor.ch+(hint.length-this.info.name.length)},TokenUtils.moveNextToken(ctx)&&ctx.token.string.length>0&&!/\S/.test(ctx.token.string)&&(newCursor.ch+=ctx.token.string.length)):hint+=": ")}else{this.info.isNewItem||-1===this.info.index?end.ch=start.ch:end.ch=start.ch+this.info.values[this.info.index].length;var parenMatch=hint.match(/\(.*?\)/);parenMatch&&(adjustCursor=!0,newCursor={line:cursor.line,ch:start.ch+parenMatch.index+1},keepHints=!0)}return this.editor._codeMirror.replaceRange(hint,start,end),adjustCursor&&this.editor.setCursorPos(newCursor),keepHints},AppInit.appReady(function(){var cssPropHints=new CssPropHints;CodeHintManager.registerHintProvider(cssPropHints,["css","scss","less"],1),ExtensionUtils.loadStyleSheet(module,"styles/brackets-css-hints.css"),exports.cssPropHintProvider=cssPropHints})});
//# sourceMappingURL=main.js.map
