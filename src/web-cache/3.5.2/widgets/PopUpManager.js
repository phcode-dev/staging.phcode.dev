define(function(require,exports,module){let AppInit=require("utils/AppInit"),EventDispatcher=require("utils/EventDispatcher"),WorkspaceManager=require("view/WorkspaceManager"),CommandManager=require("command/CommandManager"),MainViewManager=require("view/MainViewManager"),KeyEvent=require("utils/KeyEvent"),_popUps=[];function addPopUp($popUp,removeHandler,autoRemove,options){autoRemove=autoRemove||!1;const popupManagesFocus=(options=options||{}).popupManagesFocus||!1;_popUps.push($popUp[0]),$popUp.data("PopUpManager-autoRemove",autoRemove),$popUp.data("PopUpManager-popupManagesFocus",popupManagesFocus),$popUp.data("PopUpManager-removeHandler",removeHandler)}function removePopUp($popUp){if($popUp.find(":visible").length>0){let removeHandler=$popUp.data("PopUpManager-removeHandler");removeHandler&&removeHandler()}let index=_popUps.indexOf($popUp[0]);if(index>=0){let autoRemove;$popUp.data("PopUpManager-autoRemove")&&($popUp.remove(),_popUps.splice(index,1))}}function removeCurrentPopUp(keyEvent){let $popUp,i,event=new $.Event("popUpClose");for(i=_popUps.length-1;i>=0;i--)if(($popUp=$(_popUps[i])).find(":visible").length>0){if($popUp.trigger(event),!event.isDefaultPrevented()){keyEvent&&keyEvent.stopImmediatePropagation();let popupManagesFocus=$popUp.data("PopUpManager-popupManagesFocus");removePopUp($popUp),popupManagesFocus||MainViewManager.focusActivePane()}break}}function _keydownCaptureListener(keyEvent){(keyEvent.keyCode===KeyEvent.DOM_VK_ESCAPE||keyEvent.keyCode===KeyEvent.DOM_VK_ALT&&"win"===brackets.platform)&&(keyEvent.keyCode===KeyEvent.DOM_VK_ALT&&keyEvent.ctrlKey||removeCurrentPopUp(keyEvent))}function _beforeMenuPopup(){removeCurrentPopUp()}function _dontToggleWorkspacePanel(){for(let popUp of _popUps){let $popUp;if($(popUp).find(":visible").length>0)return!0}return!1}function listenToContextMenu(contextMenu){contextMenu.on("beforeContextMenuOpen",_beforeMenuPopup)}AppInit.htmlReady(function(){window.document.body.addEventListener("keydown",_keydownCaptureListener,!0),exports.on("beforeMenuPopup",_beforeMenuPopup),CommandManager.on("beforeExecuteCommand",function(event,commandId){removeCurrentPopUp()}),WorkspaceManager.addEscapeKeyEventHandler("PopUpManager",_dontToggleWorkspacePanel)}),EventDispatcher.makeEventDispatcher(exports),exports.addPopUp=addPopUp,exports.removePopUp=removePopUp,exports.listenToContextMenu=listenToContextMenu});
//# sourceMappingURL=PopUpManager.js.map
