!function(global){const TRANSPORT_CONFIG={};function _debugLog(...args){window.LIVE_PREVIEW_DEBUG_ENABLED&&console.log(...args)}const clientID=""+Math.round(1e9*Math.random()),worker=new Worker(TRANSPORT_CONFIG.LIVE_DEV_REMOTE_WORKER_SCRIPTS_FILE_NAME);let _workerMessageProcessor,sentTitle,sentFavIconURL;function _postLivePreviewMessage(message){worker.postMessage({type:"livePreview",message:message})}function convertImgToBase64(url,callback){if(!url)return void callback(null);let canvas=document.createElement("CANVAS");const ctx=canvas.getContext("2d"),img=new Image;img.crossOrigin="Anonymous",img.onload=function(){canvas.height=img.height,canvas.width=img.width,ctx.drawImage(img,0,0);const dataURL=canvas.toDataURL();callback(dataURL),canvas=null},img.src=url}function getAbsoluteUrl(url){if(/^(?:[a-z]+:)?\/\//i.test(url))return url;const absoluteUrl=new URL(url,window.location.href);return absoluteUrl.href}worker.onmessage=(event=>{const type=event.data.type;switch(type){case"REDIRECT_PAGE":location.href=event.data.URL;break;default:if(_workerMessageProcessor)return _workerMessageProcessor(event);console.error("Live Preview page loader: received unknown message from worker:",event)}}),worker.postMessage({type:"setupPhoenixComm",livePreviewDebugModeEnabled:TRANSPORT_CONFIG.LIVE_PREVIEW_DEBUG_ENABLED,broadcastChannel:TRANSPORT_CONFIG.LIVE_PREVIEW_BROADCAST_CHANNEL_ID,websocketChannelURL:TRANSPORT_CONFIG.LIVE_PREVIEW_WEBSOCKET_CHANNEL_URL,clientID:clientID}),setInterval(()=>{const favIcon=document.querySelector("link[rel~='icon']"),faviconUrl=favIcon&&favIcon.href;sentFavIconURL!==faviconUrl&&(sentFavIconURL=faviconUrl,convertImgToBase64(faviconUrl,function(base64){base64||(base64="favicon.ico"),worker.postMessage({type:"updateTitleIcon",faviconBase64:base64})})),sentTitle!==document.title&&(sentTitle=document.title,worker.postMessage({type:"updateTitleIcon",title:document.title}))},1e3),global._Brackets_LiveDev_Transport={_channelOpen:!1,_callbacks:null,setCallbacks:function(callbacks){this._callbacks=callbacks},connect:function(){const self=this;_workerMessageProcessor=(event=>{_debugLog("Live Preview: Browser received event from Phoenix: ",JSON.stringify(event.data));const type=event.data.type;switch(type){case"BROWSER_CONNECT":case"BROWSER_MESSAGE":case"BROWSER_CLOSE":break;case"MESSAGE_FROM_PHOENIX":if(self._callbacks&&self._callbacks.message){const clientIDs=event.data.clientIDs,message=event.data.message;(clientIDs.includes(clientID)||0===clientIDs.length)&&self._callbacks.message(message)}break;case"PHOENIX_CLOSE":self._channelOpen=!1,self._callbacks&&self._callbacks.close&&self._callbacks.close()}}),_postLivePreviewMessage({type:"BROWSER_CONNECT",url:global.location.href,clientID:clientID}),self._channelOpen=!0,self._callbacks&&self._callbacks.connect&&self._callbacks.connect(),addEventListener("beforeunload",function(){self._channelOpen&&(self._channelOpen=!1,_postLivePreviewMessage({type:"BROWSER_CLOSE",clientID:clientID}))})},send:function(msgStr){_postLivePreviewMessage({type:"BROWSER_MESSAGE",clientID:clientID,message:msgStr})},enable:function(){this.connect()}},document.addEventListener("click",function(event){let targetElement=event.target;if(null!==targetElement&&"A"!==targetElement.tagName&&(targetElement=targetElement.parentElement),targetElement&&"A"===targetElement.tagName&&"_blank"===targetElement.target){const href=getAbsoluteUrl(targetElement.getAttribute("href"));window.parent.postMessage({handlerName:"ph-liveServer",eventName:"embeddedIframeHrefClick",href:href},"*")}}),document.addEventListener("contextmenu",function(event){(document.activeElement||document.body).focus()}),document.addEventListener("keydown",function(event){"Escape"!==event.key&&"Esc"!==event.key||window.parent.postMessage({handlerName:"ph-liveServer",eventName:"embeddedEscapeKeyPressed"},"*")})}(this);
//# sourceMappingURL=LivePreviewTransportRemote.js.map
