!function(mod){"object"==typeof exports&&"object"==typeof module?mod(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],mod):mod(CodeMirror)}(function(CodeMirror){"use strict";var Pos=CodeMirror.Pos;function matches(hint,typed,matchInMiddle){return matchInMiddle?hint.indexOf(typed)>=0:0==hint.lastIndexOf(typed,0)}function getHints(cm,options){var tags=options&&options.schemaInfo,quote=options&&options.quoteChar||'"',matchInMiddle=options&&options.matchInMiddle;if(tags){var cur=cm.getCursor(),token=cm.getTokenAt(cur),inner;if(token.end>cur.ch&&(token.end=cur.ch,token.string=token.string.slice(0,cur.ch-token.start)),(inner=CodeMirror.innerMode(cm.getMode(),token.state)).mode.xmlCurrentTag){var result=[],replaceToken=!1,prefix,tag=/\btag\b/.test(token.type)&&!/>$/.test(token.string),tagName=tag&&/^\w/.test(token.string),tagStart;if(tagName){var before=cm.getLine(cur.line).slice(Math.max(0,token.start-2),token.start),tagType=/<\/$/.test(before)?"close":/<$/.test(before)?"open":null;tagType&&(tagStart=token.start-("close"==tagType?2:1))}else tag&&"<"==token.string?tagType="open":tag&&"</"==token.string&&(tagType="close");var tagInfo=inner.mode.xmlCurrentTag(inner.state);if(!tag&&!tagInfo||tagType){tagName&&(prefix=token.string),replaceToken=tagType;var context=inner.mode.xmlCurrentContext?inner.mode.xmlCurrentContext(inner.state):[],inner,curTag=(inner=context.length&&context[context.length-1])&&tags[inner],childList=inner?curTag&&curTag.children:tags["!top"];if(childList&&"close"!=tagType)for(var i=0;i<childList.length;++i)prefix&&!matches(childList[i],prefix,matchInMiddle)||result.push("<"+childList[i]);else if("close"!=tagType)for(var name in tags)!tags.hasOwnProperty(name)||"!top"==name||"!attrs"==name||prefix&&!matches(name,prefix,matchInMiddle)||result.push("<"+name);inner&&(!prefix||"close"==tagType&&matches(inner,prefix,matchInMiddle))&&result.push("</"+inner+">")}else{var curTag,attrs=(curTag=tagInfo&&tags[tagInfo.name])&&curTag.attrs,globalAttrs=tags["!attrs"];if(!attrs&&!globalAttrs)return;if(attrs){if(globalAttrs){var set={};for(var nm in globalAttrs)globalAttrs.hasOwnProperty(nm)&&(set[nm]=globalAttrs[nm]);for(var nm in attrs)attrs.hasOwnProperty(nm)&&(set[nm]=attrs[nm]);attrs=set}}else attrs=globalAttrs;if("string"==token.type||"="==token.string){var before,atName=(before=cm.getRange(Pos(cur.line,Math.max(0,cur.ch-60)),Pos(cur.line,"string"==token.type?token.start:token.end))).match(/([^\s\u00a0=<>\"\']+)=$/),atValues;if(!atName||!attrs.hasOwnProperty(atName[1])||!(atValues=attrs[atName[1]]))return;if("function"==typeof atValues&&(atValues=atValues.call(this,cm)),"string"==token.type){prefix=token.string;var n=0;/['"]/.test(token.string.charAt(0))&&(quote=token.string.charAt(0),prefix=token.string.slice(1),n++);var len=token.string.length;if(/['"]/.test(token.string.charAt(len-1))&&(quote=token.string.charAt(len-1),prefix=token.string.substr(n,len-2)),n){var line=cm.getLine(cur.line);line.length>token.end&&line.charAt(token.end)==quote&&token.end++}replaceToken=!0}var returnHintsFromAtValues=function(atValues){if(atValues)for(var i=0;i<atValues.length;++i)prefix&&!matches(atValues[i],prefix,matchInMiddle)||result.push(quote+atValues[i]+quote);return returnHints()};return atValues&&atValues.then?atValues.then(returnHintsFromAtValues):returnHintsFromAtValues(atValues)}for(var attr in"attribute"==token.type&&(prefix=token.string,replaceToken=!0),attrs)!attrs.hasOwnProperty(attr)||prefix&&!matches(attr,prefix,matchInMiddle)||result.push(attr)}return returnHints()}}function returnHints(){return{list:result,from:replaceToken?Pos(cur.line,null==tagStart?token.start:tagStart):cur,to:replaceToken?Pos(cur.line,token.end):cur}}}CodeMirror.registerHelper("hint","xml",getHints)});
//# sourceMappingURL=xml-hint.js.map
