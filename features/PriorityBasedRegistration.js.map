{"version":3,"sources":["features/PriorityBasedRegistration.js"],"names":["define","require","exports","module","PreferencesManager","_providerSort","a","b","priority","RegistrationHandler","this","_providers","all","prototype","registerProvider","providerInfo","languageIds","providerObj","provider","self","languageId","indexOf","hasOwnProperty","push","sort","forEach","Array","concat","removeProvider","targetLanguageId","index","providers","targetLanguageIdArr","isArray","Object","keys","length","splice","getProvidersForLanguageId","filter","prefKey","constructor","name","get"],"mappings":"AAwBAA,OAAO,SAAUC,QAASC,QAASC,QAG/B,IAAIC,mBAAqBH,QAAQ,kCAKjC,SAASI,cAAcC,EAAGC,GACtB,OAAOA,EAAEC,SAAWF,EAAEE,SAI1B,SAASC,sBACLC,KAAKC,WAAa,CACdC,IAAO,IAqBfH,oBAAoBI,UAAUC,iBAAmB,SAAUC,aAAcC,YAAaR,UAClF,IAAIS,YAAc,CACVC,SAAUH,aACVP,SAAUA,UAAY,GAE1BW,KAAOT,KAKHU,WAHR,IAAoC,IAAhCJ,YAAYK,QAAQ,OAIpB,IAAKD,cAAcD,KAAKR,WAChBQ,KAAKR,WAAWW,eAAeF,cAC/BD,KAAKR,WAAWS,YAAYG,KAAKN,aACjCE,KAAKR,WAAWS,YAAYI,KAAKnB,qBAIzCW,YAAYS,QAAQ,SAAUL,YACrBD,KAAKR,WAAWS,cAEjBD,KAAKR,WAAWS,YAAcM,MAAMb,UAAUc,OAAOR,KAAKR,WAAWC,MAEzEO,KAAKR,WAAWS,YAAYG,KAAKN,aACjCE,KAAKR,WAAWS,YAAYI,KAAKnB,kBAY7CI,oBAAoBI,UAAUe,eAAiB,SAAUV,SAAUW,kBAC/D,IAAIC,MACAC,UACAC,oBACAb,KAAOT,MAGPsB,oBADAN,MAAMO,QAAQJ,kBACQA,iBACfA,iBACe,CAACA,kBAEDK,OAAOC,KAAKhB,KAAKR,aAGvBc,QAAQ,SAAUL,YAGlC,IAFAW,UAAYZ,KAAKR,WAAWS,YAEvBU,MAAQ,EAAGA,MAAQC,UAAUK,OAAQN,QACtC,GAAIC,UAAUD,OAAOZ,WAAaA,SAAU,CACxCa,UAAUM,OAAOP,MAAO,GACxB,UAOhBrB,oBAAoBI,UAAUyB,0BAA4B,SAAUlB,YAChE,IAAIW,UAKJ,OALgBrB,KAAKC,WAAWS,aAAeV,KAAKC,WAAWC,KAK9C2B,OAAO,SAAUrB,UAC9B,IAAIsB,QAAU,WAAatB,SAASA,SAASuB,YAAYC,KACzD,OAA2C,IAApCtC,mBAAmBuC,IAAIH,YAKtCtC,QAAQO,oBAAsBA","sourcesContent":["/*\n * Copyright (c) 2019 - present Adobe. All rights reserved.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a\n * copy of this software and associated documentation files (the \"Software\"),\n * to deal in the Software without restriction, including without limitation\n * the rights to use, copy, modify, merge, publish, distribute, sublicense,\n * and/or sell copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\n * DEALINGS IN THE SOFTWARE.\n *\n */\n\n/* eslint-disable indent */\ndefine(function (require, exports, module) {\n\n\n    var PreferencesManager = require(\"preferences/PreferencesManager\");\n\n    /**\n     * Comparator to sort providers from high to low priority\n     */\n    function _providerSort(a, b) {\n        return b.priority - a.priority;\n    }\n\n\n    function RegistrationHandler() {\n        this._providers = {\n            \"all\": []\n        };\n    }\n\n    /**\n     * The method by which a Provider registers its willingness to\n     * providing tooling feature for editors in a given language.\n     *\n     * @param {!Provider} provider\n     * The provider to be registered, described below.\n     *\n     * @param {!Array.<string>} languageIds\n     * The set of language ids for which the provider is capable of\n     * providing tooling feature. If the special language id name \"all\" is included then\n     * the provider may be called for any language.\n     *\n     * @param {?number} priority\n     * Used to break ties among providers for a particular language.\n     * Providers with a higher number will be asked for tooling before those\n     * with a lower priority value. Defaults to zero.\n     */\n    RegistrationHandler.prototype.registerProvider = function (providerInfo, languageIds, priority) {\n        var providerObj = {\n                provider: providerInfo,\n                priority: priority || 0\n            },\n            self = this;\n\n        if (languageIds.indexOf(\"all\") !== -1) {\n            // Ignore anything else in languageIds and just register for every language. This includes\n            // the special \"all\" language since its key is in the hintProviders map from the beginning.\n            var languageId;\n            for (languageId in self._providers) {\n                if (self._providers.hasOwnProperty(languageId)) {\n                    self._providers[languageId].push(providerObj);\n                    self._providers[languageId].sort(_providerSort);\n                }\n            }\n        } else {\n            languageIds.forEach(function (languageId) {\n                if (!self._providers[languageId]) {\n                    // Initialize provider list with any existing all-language providers\n                    self._providers[languageId] = Array.prototype.concat(self._providers.all);\n                }\n                self._providers[languageId].push(providerObj);\n                self._providers[languageId].sort(_providerSort);\n            });\n        }\n    };\n\n    /**\n     * Remove a code hint provider\n     * @param {!CodeHintProvider} provider Code hint provider to remove\n     * @param {(string|Array.<string>)=} targetLanguageId Optional set of\n     *     language IDs for languages to remove the provider for. Defaults\n     *     to all languages.\n     */\n    RegistrationHandler.prototype.removeProvider = function (provider, targetLanguageId) {\n        var index,\n            providers,\n            targetLanguageIdArr,\n            self = this;\n\n        if (Array.isArray(targetLanguageId)) {\n            targetLanguageIdArr = targetLanguageId;\n        } else if (targetLanguageId) {\n            targetLanguageIdArr = [targetLanguageId];\n        } else {\n            targetLanguageIdArr = Object.keys(self._providers);\n        }\n\n        targetLanguageIdArr.forEach(function (languageId) {\n            providers = self._providers[languageId];\n\n            for (index = 0; index < providers.length; index++) {\n                if (providers[index].provider === provider) {\n                    providers.splice(index, 1);\n                    break;\n                }\n            }\n        });\n    };\n\n\n    RegistrationHandler.prototype.getProvidersForLanguageId = function (languageId) {\n        var providers = this._providers[languageId] || this._providers.all;\n\n        // Exclude providers that are explicitly disabled in the preferences.\n        // All providers that do not have their constructor\n        // names listed in the preferences are enabled by default.\n        return providers.filter(function (provider) {\n            var prefKey = \"tooling.\" + provider.provider.constructor.name;\n            return PreferencesManager.get(prefKey) !== false;\n        });\n    };\n\n\n    exports.RegistrationHandler = RegistrationHandler;\n});\n"],"file":"PriorityBasedRegistration.js"}